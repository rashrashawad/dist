
<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Al-Moazin Digital Clock - Ø³Ø§Ø¹Ø© Ø§Ù„Ù…Ø¤Ø°Ù†</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1b1e">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø³Ø§Ø¹Ø© Ø§Ù„Ù…Ø¤Ø°Ù†">
    <link rel="apple-touch-icon" href="backgrounds/150.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Literata:ital,opsz,wght@0,7..72,200..900;1,7..72,200..900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/adhan@4.4.0/dist/Adhan.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Literata', 'serif'],
                        body: ['Literata', 'serif'],
                        headline: ['Literata', 'serif'],
                        mono: ['monospace'],
                    },
                }
            }
        }
    </script>
    <style>
        :root {
            --background: 220 19% 14%;
            --foreground: 43 33% 92%;
            --card: 220 19% 18%;
            --card-foreground: 43 33% 92%;
            --popover: 220 19% 14%;
            --popover-foreground: 43 33% 92%;
            --primary: 240 71% 27%;
            --primary-foreground: 43 33% 92%;
            --secondary: 220 15% 30%;
            --secondary-foreground: 43 33% 92%;
            --muted: 220 15% 30%;
            --muted-foreground: 220 9% 65%;
            --accent: 43 74% 49%;
            --accent-foreground: 220 19% 14%;
            --destructive: 0 84% 60%;
            --destructive-foreground: 43 33% 92%;
            --border: 220 15% 30%;
            --input: 220 15% 30%;
            --ring: 43 74% 49%;
            --radius: 0.5rem;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            position: fixed;
            background-color: #1a1b1e; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ */
        }
        body {
            font-family: 'Literata', serif;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙ„ÙØ§Ø² */
            -webkit-font-smoothing: antialiased;
            transform: translateZ(0); 
            padding: 2vh 2vw; /* Ù…Ø³Ø§Ø­Ø© Ø£Ù…Ø§Ù† Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„ØªÙ„ÙØ§Ø² (Overscan) */
            box-sizing: border-box;
        }
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #app-container:empty::before {
            content: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #fbbf24;
            background: #1a1b1e;
            z-index: 100;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
        }
        .accordion-content.open {
            max-height: 2000px;
        }
        .sheet-overlay {
            position: fixed;
            inset: 0;
            z-index: 50;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .sheet-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }
        .sheet-content {
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            z-index: 50;
            width: 100%;
            max-width: 28rem;
            background-color: hsl(var(--card));
            box-shadow: -4px 0 24px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: transform 0.3s;
        }
        .sheet-content.open {
            transform: translateX(0);
        }
        .slider {
            position: relative;
            display: flex;
            width: 100%;
            touch-action: none;
            user-select: none;
            align-items: center;
        }
        .slider-track {
            position: relative;
            height: 2px;
            width: 100%;
            background-color: hsl(var(--muted));
            border-radius: 9999px;
        }
        .slider-range {
            position: absolute;
            height: 100%;
            background-color: hsl(var(--primary));
        }
        .slider-thumb {
            display: block;
            width: 20px;
            height: 20px;
            background-color: hsl(var(--primary));
            border-radius: 9999px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        /* Settings Panel Styles */
        #settings-panel {
            background-color: hsl(220, 19%, 18%) !important;
            color: hsl(43, 33%, 92%) !important;
        }
        #settings-content {
            background-color: hsl(220, 19%, 18%) !important;
            color: hsl(43, 33%, 92%) !important;
        }
        #settings-content input[type="text"],
        #settings-content input[type="number"],
        #settings-content input[type="time"],
        #settings-content input[type="file"],
        #settings-content select {
            background-color: hsl(220, 15%, 30%) !important;
            color: hsl(43, 33%, 92%) !important;
            border-color: hsl(220, 15%, 30%) !important;
        }
        #settings-content input[type="text"]:focus,
        #settings-content input[type="number"]:focus,
        #settings-content input[type="time"]:focus,
        #settings-content select:focus {
            outline: 2px solid hsl(43, 74%, 49%);
            outline-offset: 2px;
        }
        #settings-content label {
            color: hsl(43, 33%, 92%) !important;
        }
        #settings-content h3 {
            color: hsl(43, 33%, 92%) !important;
        }
        #settings-content .text-muted-foreground {
            color: hsl(220, 9%, 65%) !important;
        }
        #settings-content .border-b {
            border-color: hsl(220, 15%, 30%) !important;
        }
        #settings-content .border-t {
            border-color: hsl(220, 15%, 30%) !important;
        }
        #save-settings {
            background-color: hsl(240, 71%, 27%) !important;
            color: hsl(43, 33%, 92%) !important;
        }
        #save-settings:hover {
            background-color: hsl(240, 71%, 35%) !important;
        }
    </style>
</head>
<body class="font-sans antialiased">
    <audio id="audioRef" class="hidden"></audio>
    
    <!-- Splash Screen -->
    <div id="app-splash" style="position: fixed; inset: 0; background: #1a1b1e; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.5s;">
        <div style="width: 80px; height: 80px; border: 5px solid #333; border-top: 5px solid #fbbf24; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <h1 style="color: #fbbf24; margin-top: 20px; font-size: 2rem;">Ø³Ø§Ø¹Ø© Ø§Ù„Ù…Ø¤Ø°Ù†</h1>
        <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>
    </div>

    <!-- Main Container -->
    <div id="app-container"></div>
    
    <!-- Settings Panel -->
    <div id="settings-overlay" class="sheet-overlay"></div>
    <div id="settings-panel" class="sheet-content flex flex-col">
        <div class="p-6 border-b">
            <h2 class="text-2xl font-bold">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø§Ø¹Ø©</h2>
            <p class="text-sm text-muted-foreground mt-1">Ù‚Ù… Ø¨ØªØ®ØµÙŠØµ Ù…Ø¸Ù‡Ø± ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø§Ø´Ø© Ø§Ù„Ø³Ø§Ø¹Ø©.</p>
        </div>
        <div class="flex-1 overflow-y-auto p-6" id="settings-content">
            <!-- Settings content will be generated by JS -->
        </div>
        <div class="p-6 border-t space-y-3">
            <button id="save-settings" class="w-full bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90">Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
            <button id="update-prayer-times" class="w-full bg-secondary text-secondary-foreground px-4 py-2 rounded-md hover:bg-secondary/90">ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="remoteControl.js"></script>

    <script>
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Global Error:', msg, url, lineNo);
            const errorDiv = document.getElementById('error-display') || document.createElement('div');
            errorDiv.id = 'error-display';
            errorDiv.style.position = 'fixed';
            errorDiv.style.inset = '0';
            errorDiv.style.background = '#1a1b1e';
            errorDiv.style.color = 'white';
            errorDiv.style.padding = '20px';
            errorDiv.style.zIndex = '10000';
            errorDiv.style.display = 'flex';
            errorDiv.style.flexDirection = 'column';
            errorDiv.style.alignItems = 'center';
            errorDiv.style.justifyContent = 'center';
            errorDiv.style.textAlign = 'center';
            errorDiv.innerHTML = `
                <h2 style="color: #fbbf24; margin-bottom: 20px;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h2>
                <p dir="ltr" style="background: rgba(255,0,0,0.1); padding: 10px; border-radius: 5px;">${msg}</p>
                <button onclick="location.reload()" style="margin-top: 20px; background: #2563eb; color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 1.2rem; cursor: pointer">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
            `;
            if (!document.getElementById('error-display')) document.body.appendChild(errorDiv);
            return false;
        };

        // Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const splash = document.getElementById('app-splash');
                if (splash && splash.style.opacity !== '0') {
                    splash.innerHTML += '<p style="font-size: 1rem; color: #9ca3af; margin-top: 10px;">Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆÙ‚ØªØ§Ù‹ Ø£Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©...</p>';
                }
            }, 5000);
        });

        window.appInitialized = true;
        // ==================== CONSTANTS ====================
        const prayerNames = {
            fajr: 'Ø§Ù„ÙØ¬Ø±',
            dhuhr: 'Ø§Ù„Ø¸Ù‡Ø±',
            asr: 'Ø§Ù„Ø¹ØµØ±',
            maghrib: 'Ø§Ù„Ù…ØºØ±Ø¨',
            isha: 'Ø§Ù„Ø¹Ø´Ø§Ø¡',
        };

        const PRAYER_ORDER = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];

        const hadiths = [
            "Â«Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ø§Ù„Ø£ÙØ¹Ù’Ù…ÙØ§Ù„Ù Ø¨ÙØ§Ù„Ù†ÙÙ‘ÙŠÙÙ‘Ø§ØªÙØŒ ÙˆÙØ¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ù„ÙÙƒÙÙ„ÙÙ‘ Ø§Ù…Ù’Ø±ÙØ¦Ù Ù…ÙØ§ Ù†ÙÙˆÙÙ‰Â»",
            "Â«Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù Ø§Ù„Ù†ÙÙ‘ØµÙÙŠØ­ÙØ©ÙÂ»",
            "Â«Ù„Ø§ ÙŠÙØ¤Ù’Ù…ÙÙ†Ù Ø£ÙØ­ÙØ¯ÙÙƒÙÙ…Ù’ØŒ Ø­ÙØªÙÙ‘Ù‰ ÙŠÙØ­ÙØ¨ÙÙ‘ Ù„ÙØ£ÙØ®ÙÙŠÙ‡Ù Ù…ÙØ§ ÙŠÙØ­ÙØ¨ÙÙ‘ Ù„ÙÙ†ÙÙÙ’Ø³ÙÙ‡ÙÂ»",
            "Â«Ù…ÙÙ†Ù’ Ø³ÙÙ„ÙÙƒÙ Ø·ÙØ±ÙÙŠÙ‚Ù‹Ø§ ÙŠÙÙ„Ù’ØªÙÙ…ÙØ³Ù ÙÙÙŠÙ‡Ù Ø¹ÙÙ„Ù’Ù…Ù‹Ø§ØŒ Ø³ÙÙ‡ÙÙ‘Ù„Ù Ø§Ù„Ù„Ù‡Ù Ù„ÙÙ‡Ù Ø·ÙØ±ÙÙŠÙ‚Ù‹Ø§ Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©ÙÂ»",
            "Â«Ø§Ù„Ù’ÙƒÙÙ„ÙÙ…ÙØ©Ù Ø§Ù„Ø·ÙÙ‘ÙŠÙÙ‘Ø¨ÙØ©Ù ØµÙØ¯ÙÙ‚ÙØ©ÙŒÂ»",
            "Â«ØªÙØ¨ÙØ³ÙÙ‘Ù…ÙÙƒÙ ÙÙÙŠ ÙˆÙØ¬Ù’Ù‡Ù Ø£ÙØ®ÙÙŠÙƒÙ Ù„ÙÙƒÙ ØµÙØ¯ÙÙ‚ÙØ©ÙŒÂ»",
            "Â«Ø®ÙÙŠÙ’Ø±ÙÙƒÙÙ…Ù’ Ù…ÙÙ†Ù’ ØªÙØ¹ÙÙ„ÙÙ‘Ù…Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ÙˆÙØ¹ÙÙ„ÙÙ‘Ù…ÙÙ‡ÙÂ»"
        ];

        const azkarAfterPrayer = [
           
        
            "Ø£ÙØ³Ù’Ù€ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„Ù‡ØŒ Ø£ÙØ³Ù’Ù€ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„Ù‡ØŒ Ø£ÙØ³Ù’Ù€ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„Ù‡.\n\nØ§Ù„Ù„Ù‘Ù‡ÙÙ€Ù…ÙÙ‘ Ø£ÙÙ†Ù’Ù€ØªÙ Ø§Ù„Ø³ÙÙ‘Ù„Ø§Ù…Ù ØŒ ÙˆÙÙ…ÙÙ€Ù†Ù’ÙƒÙ Ø§Ù„Ø³ÙÙ‘Ù„Ø§Ù… ØŒ ØªÙØ¨Ø§Ø±ÙÙƒÙ’ØªÙ ÙŠØ§ Ø°Ø§ Ø§Ù„Ø¬ÙÙ€Ù„Ø§Ù„Ù ÙˆÙØ§Ù„Ø¥ÙÙƒÙ’Ù€Ø±Ø§Ù… .",
            "Ù„Ø§ Ø¥Ù„Ù‡Ù Ø¥Ù„Ø§Ù‘ Ø§Ù„Ù„Ù‘Ù‡Ù ÙˆØ­Ø¯ÙÙ‡Ù Ù„Ø§ Ø´Ø±ÙŠÙƒÙ Ù„Ù‡ÙØŒ Ù„Ù‡Ù Ø§Ù„Ù…ÙÙ€Ù„Ù’ÙƒÙ ÙˆÙ„Ù‡Ù Ø§Ù„Ø­ÙÙ…Ù’Ø¯ØŒ ÙˆÙ‡ÙˆÙ Ø¹Ù„Ù‰ ÙƒÙ„Ù‘ Ø´ÙÙŠØ¡Ù Ù‚ÙØ¯ÙŠØ±ØŒ\n\nØ§Ù„Ù„Ù‘Ù‡ÙÙ€Ù…ÙÙ‘ Ù„Ø§ Ù…Ø§Ù†ÙØ¹Ù Ù„ÙÙ…Ø§ Ø£ÙØ¹Ù’Ø·ÙÙ€ÙŠÙ’ØªØŒ ÙˆÙÙ„Ø§ Ù…ÙØ¹Ù’Ø·ÙÙ€ÙŠÙ Ù„ÙÙ…Ø§ Ù…ÙÙ†ÙÙ€Ø¹Ù’ØªØŒ ÙˆÙÙ„Ø§ ÙŠÙÙ†Ù’ÙÙÙ€Ø¹Ù Ø°Ø§ Ø§Ù„Ø¬ÙÙ€Ø¯ÙÙ‘ Ù…ÙÙ†Ù’Ù€ÙƒÙ Ø§Ù„Ø¬ÙÙ€Ø¯.",
            "Ù„Ø§ Ø¥Ù„Ù‡Ù Ø¥Ù„Ø§Ù‘ Ø§Ù„Ù„Ù‘Ù‡ØŒ ÙˆØ­Ø¯ÙÙ‡Ù Ù„Ø§ Ø´Ø±ÙŠÙƒÙ Ù„Ù‡ÙØŒ Ù„Ù‡Ù Ø§Ù„Ù…Ù„ÙƒÙ ÙˆÙ„Ù‡Ù Ø§Ù„Ø­ÙÙ…Ø¯ØŒ ÙˆÙ‡ÙˆÙ Ø¹Ù„Ù‰ ÙƒÙ„Ù‘ Ø´ÙŠØ¡Ù Ù‚Ø¯ÙŠØ±ØŒ\n\nÙ„Ø§ Ø­ÙÙ€ÙˆÙ’Ù„Ù ÙˆÙÙ„Ø§ Ù‚Ù€ÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„Ø§Ù‘ Ø¨ÙØ§Ù„Ù„Ù‡ÙØŒ Ù„Ø§ Ø¥Ù„Ù‡Ù Ø¥Ù„Ø§Ù‘ Ø§Ù„Ù„Ù‘Ù€Ù‡ØŒ ÙˆÙÙ„Ø§ Ù†ÙØ¹Ù’Ù€Ø¨ÙÙ€Ø¯Ù Ø¥ÙÙ„Ø§Ù‘ Ø¥ÙŠÙ‘Ù€Ø§Ù‡ØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù†ÙÙ‘Ø¹Ù’Ù€Ù…ÙØ©Ù ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„ÙÙØ¶Ù’Ù„ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ø«ÙÙ‘Ù€Ù†Ø§Ø¡Ù Ø§Ù„Ø­ÙÙ€Ø³ÙÙ†ØŒ Ù„Ø§ Ø¥Ù„Ù‡Ù Ø¥Ù„Ø§Ù‘ Ø§Ù„Ù„Ù‘Ù‡Ù Ù…Ø®Ù’Ù„ÙØµÙ€ÙŠÙ†Ù Ù„_Ù€Ù‡Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù ÙˆÙÙ„ÙÙˆÙ’ ÙƒÙÙ€Ø±ÙÙ‡Ù Ø§Ù„ÙƒÙ€Ø§ÙÙØ±ÙˆÙ†.",
            "Ù„Ø§ Ø¥Ù„Ù‡Ù Ø¥Ù„Ø§Ù‘ Ø§Ù„Ù„Ù‘Ù‡Ù ÙˆØ­Ù’Ù€Ø¯ÙÙ‡Ù Ù„Ø§ Ø´Ø±ÙŠÙƒÙ Ù„Ù‡ÙØŒ Ù„Ù‡Ù Ø§Ù„Ù…ÙÙ„ÙƒÙ ÙˆÙ„Ù‡Ù Ø§Ù„Ø­ÙÙ…Ù’Ø¯ØŒ ÙŠÙØ­ÙŠÙ€ÙŠ ÙˆÙÙŠÙÙ…Ù€ÙŠØªÙ ÙˆÙ‡ÙÙˆÙ Ø¹Ù„Ù‰ ÙƒÙÙ„Ù‘ Ø´ÙŠØ¡Ù Ù‚Ø¯ÙŠØ±.",
            "Ø§Ù„Ù„Ù‘Ù‡ÙÙ€Ù…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘Ù€ÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙ€ÙƒÙ Ø¹ÙÙ„Ù’Ù…Ù€Ø§Ù‹ Ù†Ø§ÙÙØ¹Ù€Ø§Ù‹ ÙˆÙØ±ÙØ²Ù’Ù‚Ù€Ø§Ù‹ Ø·ÙÙŠÙÙ‘Ù€Ø¨Ø§Ù‹ ØŒ ÙˆÙØ¹ÙÙ…ÙÙ€Ù„Ø§Ù‹ Ù…ÙØªÙÙ‚ÙÙ€Ø¨ÙÙ‘Ù„Ø§Ù‹.",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙØ¬ÙØ±Ù’Ù†ÙÙŠ Ù…ÙÙ†Ù’ Ø§Ù„Ù†ÙÙ‘Ø§Ø±.\n\n(Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„ØµØ¨Ø­ ÙˆØ§Ù„Ù…ØºØ±Ø¨)",
            "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙØ¹ÙÙ†ÙÙ‘ÙŠ Ø¹ÙÙ„ÙÙ‰ Ø°ÙÙƒÙ’Ø±ÙÙƒÙ ÙˆÙØ´ÙÙƒÙ’Ø±ÙÙƒÙ ÙˆÙØ­ÙØ³Ù’Ù†Ù Ø¹ÙØ¨ÙØ§Ø¯ÙØªÙÙƒÙ.\n\n(Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª Ø¨Ø¹Ø¯ ØµÙ„Ø§ØªÙŠ Ø§Ù„ÙØ¬Ø± ÙˆØ§Ù„Ù…ØºØ±Ø¨)",
            "Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ§Ù„Ù„Ù‡Ù Ù…ÙÙ†Ù’ Ø§Ù„Ø´ÙÙ‘ÙŠÙ’Ø·ÙØ§Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø¬ÙÙŠÙ…Ù\n\nØ§Ù„Ù„Ù‘Ù‡Ù Ù„Ø§Ù Ø¥ÙÙ„ÙÙ€Ù‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù Ù„Ø§Ù ØªÙØ£Ù’Ø®ÙØ°ÙÙ‡Ù Ø³ÙÙ†ÙØ©ÙŒ ÙˆÙÙ„Ø§Ù Ù†ÙÙˆÙ’Ù…ÙŒ Ù„ÙÙ‘Ù‡Ù Ù…ÙØ§ ÙÙÙŠ Ø§Ù„Ø³ÙÙ‘Ù…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙÙ…ÙØ§ ÙÙÙŠ Ø§Ù„Ø£ÙØ±Ù’Ø¶Ù Ù…ÙÙ† Ø°ÙØ§ Ø§Ù„ÙÙ‘Ø°ÙÙŠ ÙŠÙØ´Ù’ÙÙØ¹Ù Ø¹ÙÙ†Ù’Ø¯ÙÙ‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ø¨ÙØ¥ÙØ°Ù’Ù†ÙÙ‡Ù ÙŠÙØ¹Ù’Ù„ÙÙ…Ù Ù…ÙØ§ Ø¨ÙÙŠÙ’Ù†Ù Ø£ÙÙŠÙ’Ø¯ÙÙŠÙ‡ÙÙ…Ù’ ÙˆÙÙ…ÙØ§ Ø®ÙÙ„Ù’ÙÙÙ‡ÙÙ…Ù’ ÙˆÙÙ„Ø§Ù ÙŠÙØ­ÙÙŠØ·ÙÙˆÙ†Ù Ø¨ÙØ´ÙÙŠÙ’Ø¡Ù Ù…ÙÙ‘Ù†Ù’ Ø¹ÙÙ„Ù’Ù…ÙÙ‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ø¨ÙÙ…ÙØ§ Ø´ÙØ§Ø¡ ÙˆÙØ³ÙØ¹Ù ÙƒÙØ±Ù’Ø³ÙÙŠÙÙ‘Ù‡Ù Ø§Ù„Ø³ÙÙ‘Ù…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙØ§Ù„Ø£ÙØ±Ù’Ø¶Ù ÙˆÙÙ„Ø§Ù ÙŠÙØ¤ÙÙˆØ¯ÙÙ‡Ù Ø­ÙÙÙ’Ø¸ÙÙ‡ÙÙ…ÙØ§ ÙˆÙÙ‡ÙÙˆÙ Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù Ø«Ù„Ø§Ø«Ø© Ù…Ø±Ø§Øª Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± ÙˆØ§Ù„Ù…ØºØ±Ø¨ .\n\n[(Ø«Ù„Ø§Ø«Ø© Ù…Ø±Ø§Øª Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± ÙˆØ§Ù„Ù…ØºØ±Ø¨).Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³Ù‰ - Ø§Ù„Ø¨Ù‚Ø±Ø© .255]",
            "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…\n\nÙ‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ­ÙØ¯ÙŒØŒ Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„ØµÙÙ‘Ù…ÙØ¯ÙØŒ Ù„ÙÙ…Ù’ ÙŠÙÙ„ÙØ¯Ù’ ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙˆÙ„ÙØ¯Ù’ØŒ ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙƒÙÙ† Ù„ÙÙ‘Ù‡ÙÛ¥ ÙƒÙÙÙÙˆÙ‹Ø§ Ø£ÙØ­ÙØ¯ÙŒÛ¢ .\n\n[ Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª Ø¨Ø¹Ø¯ ØµÙ„Ø§ØªÙŠ Ø§Ù„ÙØ¬Ø± ÙˆØ§Ù„Ù…ØºØ±Ø¨).Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ø®Ù„Ø§Øµ]",
            "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…\n\nÙ‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ù±Ù„Ù’ÙÙÙ„ÙÙ‚ÙØŒ Ù…ÙÙ† Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ Ø®ÙÙ„ÙÙ‚ÙØŒ ÙˆÙÙ…ÙÙ† Ø´ÙØ±ÙÙ‘ ØºÙØ§Ø³ÙÙ‚Ù Ø¥ÙØ°ÙØ§ ÙˆÙÙ‚ÙØ¨ÙØŒ ÙˆÙÙ…ÙÙ† Ø´ÙØ±ÙÙ‘ Ù±Ù„Ù†ÙÙ‘ÙÙÙ‘Ù°Ø«ÙÙ°ØªÙ ÙÙÙ‰ Ù±Ù„Ù’Ø¹ÙÙ‚ÙØ¯ÙØŒ ÙˆÙÙ…ÙÙ† Ø´ÙØ±ÙÙ‘ Ø­ÙØ§Ø³ÙØ¯Ù Ø¥ÙØ°ÙØ§ Ø­ÙØ³ÙØ¯Ù.\n\n[Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª Ø¨Ø¹Ø¯ ØµÙ„Ø§ØªÙŠ Ø§Ù„ÙØ¬Ø± ÙˆØ§Ù„Ù…ØºØ±Ø¨).Ø³ÙˆØ±Ø© Ø§Ù„ÙÙ„Ù‚]",
            "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…\n\nÙ‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ù±Ù„Ù†ÙÙ‘Ø§Ø³ÙØŒ Ù…ÙÙ„ÙÙƒÙ Ù±Ù„Ù†ÙÙ‘Ø§Ø³ÙØŒ Ø¥ÙÙ„ÙÙ°Ù‡Ù Ù±Ù„Ù†ÙÙ‘Ø§Ø³ÙØŒ Ù…ÙÙ† Ø´ÙØ±ÙÙ‘ Ù±Ù„Ù’ÙˆÙØ³Ù’ÙˆÙØ§Ø³Ù Ù±Ù„Ù’Ø®ÙÙ†ÙÙ‘Ø§Ø³ÙØŒ Ù±Ù„ÙÙ‘Ø°ÙÙ‰ ÙŠÙÙˆÙØ³Ù’ÙˆÙØ³Ù ÙÙÙ‰ ØµÙØ¯ÙÙˆØ±Ù Ù±Ù„Ù†ÙÙ‘Ø§Ø³ÙØŒ Ù…ÙÙ†Ù Ù±Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù ÙˆÙÙ±Ù„Ù†ÙÙ‘Ø§Ø³Ù.\n\n[ (Ø«Ù„Ø§Ø«Ø© Ù…Ø±Ø§Øª Ø¨Ø¹Ø¯ ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± ÙˆØ§Ù„Ù…ØºØ±Ø¨ ).Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ø§Ø³.]\n\n(Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª Ø¨Ø¹Ø¯ ØµÙ„Ø§ØªÙŠ Ø§Ù„ÙØ¬Ø± ÙˆØ§Ù„Ù…ØºØ±Ø¨)"
        ];

        const countries = [
            'Ø§Ù„Ø£Ø±Ø¯Ù†', 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', 'Ù…ØµØ±', 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©', 'Ù‚Ø·Ø±', 'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†',
            'Ø§Ù„ÙƒÙˆÙŠØª', 'Ø¹Ù…Ø§Ù†', 'Ø§Ù„Ø¹Ø±Ø§Ù‚', 'Ø³ÙˆØ±ÙŠØ§', 'Ù„Ø¨Ù†Ø§Ù†', 'ÙÙ„Ø³Ø·ÙŠÙ†', 'Ø§Ù„ÙŠÙ…Ù†', 'Ù„ÙŠØ¨ÙŠØ§',
            'ØªÙˆÙ†Ø³', 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', 'Ø§Ù„Ù…ØºØ±Ø¨', 'Ø§Ù„Ø³ÙˆØ¯Ø§Ù†', 'ØªØ±ÙƒÙŠØ§', 'Ø¨Ø§ÙƒØ³ØªØ§Ù†', 'Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ§', 'Ù…Ø§Ù„ÙŠØ²ÙŠØ§'
        ];

        const citiesByCountry = {
            'Ø§Ù„Ø£Ø±Ø¯Ù†': ['Ø¹Ù…Ø§Ù†', 'Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡', 'Ø¥Ø±Ø¨Ø¯', 'Ø§Ù„Ø¹Ù‚Ø¨Ø©', 'Ø§Ù„Ø³Ù„Ø·', 'Ù…Ø£Ø¯Ø¨Ø§'],
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': ['Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ø¬Ø¯Ø©', 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©', 'Ø§Ù„Ø¯Ù…Ø§Ù…', 'Ø§Ù„Ø®Ø¨Ø±'],
            'Ù…ØµØ±': ['Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©', 'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©', 'Ø§Ù„Ø¬ÙŠØ²Ø©', 'Ø´Ø¨Ø±Ø§ Ø§Ù„Ø®ÙŠÙ…Ø©', 'Ø¨ÙˆØ± Ø³Ø¹ÙŠØ¯', 'Ø§Ù„Ø³ÙˆÙŠØ³'],
            'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©': ['Ø¯Ø¨ÙŠ', 'Ø£Ø¨Ùˆ Ø¸Ø¨ÙŠ', 'Ø§Ù„Ø´Ø§Ø±Ù‚Ø©', 'Ø§Ù„Ø¹ÙŠÙ†', 'Ø¹Ø¬Ù…Ø§Ù†'],
            'Ù‚Ø·Ø±': ['Ø§Ù„Ø¯ÙˆØ­Ø©', 'Ø§Ù„ÙˆÙƒØ±Ø©', 'Ø§Ù„Ø±ÙŠØ§Ù†'],
            'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†': ['Ø§Ù„Ù…Ù†Ø§Ù…Ø©', 'Ø§Ù„Ø±ÙØ§Ø¹', 'Ø§Ù„Ù…Ø­Ø±Ù‚'],
            'Ø§Ù„ÙƒÙˆÙŠØª': ['Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ÙƒÙˆÙŠØª', 'Ø­ÙˆÙ„ÙŠ', 'Ø§Ù„Ø³Ø§Ù„Ù…ÙŠØ©'],
            'Ø¹Ù…Ø§Ù†': ['Ù…Ø³Ù‚Ø·', 'ØµÙ„Ø§Ù„Ø©', 'ØµØ­Ø§Ø±'],
            'Ø§Ù„Ø¹Ø±Ø§Ù‚': ['Ø¨ØºØ¯Ø§Ø¯', 'Ø§Ù„Ù…ÙˆØµÙ„', 'Ø§Ù„Ø¨ØµØ±Ø©', 'Ø£Ø±Ø¨ÙŠÙ„'],
            'Ø³ÙˆØ±ÙŠØ§': ['Ø¯Ù…Ø´Ù‚', 'Ø­Ù„Ø¨', 'Ø­Ù…Øµ'],
            'Ù„Ø¨Ù†Ø§Ù†': ['Ø¨ÙŠØ±ÙˆØª', 'Ø·Ø±Ø§Ø¨Ù„Ø³', 'ØµÙŠØ¯Ø§'],
            'ÙÙ„Ø³Ø·ÙŠÙ†': ['Ø§Ù„Ù‚Ø¯Ø³', 'ØºØ²Ø©', 'Ø±Ø§Ù… Ø§Ù„Ù„Ù‡', 'Ø§Ù„Ø®Ù„ÙŠÙ„', 'Ù†Ø§Ø¨Ù„Ø³'],
            'Ø§Ù„ÙŠÙ…Ù†': ['ØµÙ†Ø¹Ø§Ø¡', 'Ø¹Ø¯Ù†', 'ØªØ¹Ø²'],
            'Ù„ÙŠØ¨ÙŠØ§': ['Ø·Ø±Ø§Ø¨Ù„Ø³', 'Ø¨Ù†ØºØ§Ø²ÙŠ', 'Ù…ØµØ±Ø§ØªØ©'],
            'ØªÙˆÙ†Ø³': ['ØªÙˆÙ†Ø³', 'ØµÙØ§Ù‚Ø³', 'Ø³ÙˆØ³Ø©'],
            'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±': ['Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©', 'ÙˆÙ‡Ø±Ø§Ù†', 'Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©'],
            'Ø§Ù„Ù…ØºØ±Ø¨': ['Ø§Ù„Ø±Ø¨Ø§Ø·', 'Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡', 'ÙØ§Ø³', 'Ù…Ø±Ø§ÙƒØ´'],
            'Ø§Ù„Ø³ÙˆØ¯Ø§Ù†': ['Ø§Ù„Ø®Ø±Ø·ÙˆÙ…', 'Ø£Ù… Ø¯Ø±Ù…Ø§Ù†'],
            'ØªØ±ÙƒÙŠØ§': ['Ø§Ø³Ø·Ù†Ø¨ÙˆÙ„', 'Ø£Ù†Ù‚Ø±Ø©', 'Ø¥Ø²Ù…ÙŠØ±', 'Ø¨ÙˆØ±ØµØ©', 'Ù‚ÙˆÙ†ÙŠØ©'],
            'Ø¨Ø§ÙƒØ³ØªØ§Ù†': ['ÙƒØ±Ø§ØªØ´ÙŠ', 'Ù„Ø§Ù‡ÙˆØ±', 'Ø¥Ø³Ù„Ø§Ù… Ø¢Ø¨Ø§Ø¯', 'ÙÙŠØµÙ„ Ø¢Ø¨Ø§Ø¯'],
            'Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ§': ['Ø¬Ø§ÙƒØ±ØªØ§', 'Ø³ÙˆØ±Ø§Ø¨Ø§ÙŠØ§', 'Ø¨Ø§Ù†Ø¯ÙˆÙ†Øº'],
            'Ù…Ø§Ù„ÙŠØ²ÙŠØ§': ['ÙƒÙˆØ§Ù„Ø§Ù„Ù…Ø¨ÙˆØ±', 'Ø¬ÙˆØ±Ø¬ ØªØ§ÙˆÙ†', 'Ø¬ÙˆÙ‡ÙˆØ± Ø¨Ø§Ù‡Ø±Ùˆ']
        };

        function resolveLocationMapping(countryAr, cityAr) {
            const normalize = (s) => (s || '').trim();
            const c = normalize(countryAr);
            const city = normalize(cityAr);

            const cityData = {
                'Ø§Ù„Ø£Ø±Ø¯Ù†': {
                    apiCountry: 'Jordan',
                    method: 23,
                    timeZone: 'Asia/Amman',
                    cities: {
                        'Ø¹Ù…Ø§Ù†': { apiCity: 'Amman', coords: [31.9454, 35.9284] },
                        'Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡': { apiCity: 'Zarqa', coords: [32.0608, 36.1030] },
                        'Ø¥Ø±Ø¨Ø¯': { apiCity: 'Irbid', coords: [32.5514, 35.8514] },
                        'Ø§Ù„Ø¹Ù‚Ø¨Ø©': { apiCity: 'Aqaba', coords: [29.5319, 35.0061] },
                        'Ø§Ù„Ø³Ù„Ø·': { apiCity: 'As Salt', coords: [32.0392, 35.7272] },
                        'Ù…Ø£Ø¯Ø¨Ø§': { apiCity: 'Madaba', coords: [31.7175, 35.7931] },
                    }
                },
                'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {
                    apiCountry: 'Saudi Arabia',
                    method: 4,
                    timeZone: 'Asia/Riyadh',
                    cities: {
                        'Ø§Ù„Ø±ÙŠØ§Ø¶': { apiCity: 'Riyadh', coords: [24.7136, 46.6753] },
                        'Ø¬Ø¯Ø©': { apiCity: 'Jeddah', coords: [21.5433, 39.1728] },
                        'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©': { apiCity: 'Makkah', coords: [21.3891, 39.8579] },
                        'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©': { apiCity: 'Madinah', coords: [24.4672, 39.6068] },
                        'Ø§Ù„Ø¯Ù…Ø§Ù…': { apiCity: 'Dammam', coords: [26.4207, 50.0888] },
                        'Ø§Ù„Ø®Ø¨Ø±': { apiCity: 'Khobar', coords: [26.2172, 50.1971] },
                    }
                },
                'Ù…ØµØ±': {
                    apiCountry: 'Egypt',
                    method: 5,
                    timeZone: 'Africa/Cairo',
                    cities: {
                        'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©': { apiCity: 'Cairo', coords: [30.0444, 31.2357] },
                        'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©': { apiCity: 'Alexandria', coords: [31.2001, 29.9187] },
                        'Ø§Ù„Ø¬ÙŠØ²Ø©': { apiCity: 'Giza', coords: [30.0131, 31.2089] },
                        'Ø´Ø¨Ø±Ø§ Ø§Ù„Ø®ÙŠÙ…Ø©': { apiCity: 'Shubra El-Kheima', coords: [30.1286, 31.2422] },
                        'Ø¨ÙˆØ± Ø³Ø¹ÙŠØ¯': { apiCity: 'Port Said', coords: [31.2653, 32.3019] },
                        'Ø§Ù„Ø³ÙˆÙŠØ³': { apiCity: 'Suez', coords: [29.9668, 32.5498] },
                    }
                },
                'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©': {
                    apiCountry: 'United Arab Emirates',
                    method: 16,
                    timeZone: 'Asia/Dubai',
                    cities: {
                        'Ø¯Ø¨ÙŠ': { apiCity: 'Dubai', coords: [25.2048, 55.2708] },
                        'Ø£Ø¨Ùˆ Ø¸Ø¨ÙŠ': { apiCity: 'Abu Dhabi', coords: [24.4539, 54.3773] },
                        'Ø§Ù„Ø´Ø§Ø±Ù‚Ø©': { apiCity: 'Sharjah', coords: [25.3463, 55.4209] },
                        'Ø§Ù„Ø¹ÙŠÙ†': { apiCity: 'Al Ain', coords: [24.2075, 55.7447] },
                        'Ø¹Ø¬Ù…Ø§Ù†': { apiCity: 'Ajman', coords: [25.4052, 55.5136] },
                    }
                },
                'Ù‚Ø·Ø±': {
                    apiCountry: 'Qatar',
                    method: 10,
                    timeZone: 'Asia/Qatar',
                    cities: {
                        'Ø§Ù„Ø¯ÙˆØ­Ø©': { apiCity: 'Doha', coords: [25.2854, 51.5310] },
                        'Ø§Ù„ÙˆÙƒØ±Ø©': { apiCity: 'Al Wakrah', coords: [25.1768, 51.6048] },
                        'Ø§Ù„Ø±ÙŠØ§Ù†': { apiCity: 'Al Rayyan', coords: [25.2950, 51.4250] },
                    }
                },
                'ÙÙ„Ø³Ø·ÙŠÙ†': {
                    apiCountry: 'Palestine',
                    method: 23,
                    timeZone: 'Asia/Hebron',
                    cities: {
                        'Ø§Ù„Ù‚Ø¯Ø³': { apiCity: 'Jerusalem', coords: [31.7683, 35.2137] },
                        'ØºØ²Ø©': { apiCity: 'Gaza', coords: [31.5, 34.4667] },
                        'Ø±Ø§Ù… Ø§Ù„Ù„Ù‡': { apiCity: 'Ramallah', coords: [31.9029, 35.2062] },
                        'Ø§Ù„Ø®Ù„ÙŠÙ„': { apiCity: 'Hebron', coords: [31.5297, 35.0938] },
                        'Ù†Ø§Ø¨Ù„Ø³': { apiCity: 'Nablus', coords: [32.2211, 35.2544] },
                    }
                },
                'Ø§Ù„ÙƒÙˆÙŠØª': {
                    apiCountry: 'Kuwait',
                    method: 9,
                    timeZone: 'Asia/Kuwait',
                    cities: {
                        'Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ÙƒÙˆÙŠØª': { apiCity: 'Kuwait City', coords: [29.3759, 47.9774] },
                        'Ø­ÙˆÙ„ÙŠ': { apiCity: 'Hawalli', coords: [29.3361, 48.03] },
                        'Ø§Ù„Ø³Ø§Ù„Ù…ÙŠØ©': { apiCity: 'Salmiya', coords: [29.3333, 48.0833] },
                    }
                }
            };

            const countryInfo = cityData[c];
            if (countryInfo) {
                const m = countryInfo.cities[city];
                return {
                    apiCountry: countryInfo.apiCountry,
                    apiCity: (m && m.apiCity) ? m.apiCity : city,
                    method: countryInfo.method,
                    timeZone: countryInfo.timeZone,
                    coords: (m && m.coords) ? m.coords : [0, 0]
                };
            }

            return { apiCountry: countryAr, apiCity: cityAr, timeZone: 'Asia/Amman', coords: [31.9454, 35.9284], method: 3 };
        }

        function getAdhanCalculationMethod(methodId) {
            if (typeof adhan === 'undefined') return null;
            switch(methodId) {
                case 1: return adhan.CalculationMethod.Karachi();
                case 2: return adhan.CalculationMethod.NorthAmerica();
                case 3: return adhan.CalculationMethod.MuslimWorldLeague();
                case 4: return adhan.CalculationMethod.UmmAlQura();
                case 5: return adhan.CalculationMethod.Egyptian();
                case 8: return adhan.CalculationMethod.Gulf();
                case 9: return adhan.CalculationMethod.Kuwait();
                case 10: return adhan.CalculationMethod.Qatar();
                case 12: return adhan.CalculationMethod.France();
                case 13: return adhan.CalculationMethod.Turkey();
                case 14: return adhan.CalculationMethod.Russia();
                case 16: return adhan.CalculationMethod.Dubai();
                case 23: // Jordan/Palestine
                    const params = adhan.CalculationMethod.MuslimWorldLeague();
                    params.fajrAngle = 18;
                    params.ishaAngle = 18;
                    return params;
                default: return adhan.CalculationMethod.MuslimWorldLeague();
            }
        }

        function calculateOfflinePrayerTimes(country, city, date = new Date()) {
            try {
                const mapping = resolveLocationMapping(country, city);
                const coords = new adhan.Coordinates(mapping.coords[0], mapping.coords[1]);
                const params = getAdhanCalculationMethod(mapping.method);
                
                const prayerTimes = new adhan.PrayerTimes(coords, date, params);
                
                const formatTime = (date) => {
                    return date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', hour12: false });
                };

                return {
                    fajr: formatTime(prayerTimes.fajr),
                    shuruq: formatTime(prayerTimes.sunrise),
                    dhuhr: formatTime(prayerTimes.dhuhr),
                    asr: formatTime(prayerTimes.asr),
                    maghrib: formatTime(prayerTimes.maghrib),
                    isha: formatTime(prayerTimes.isha),
                    isOffline: true
                };
            } catch (e) {
                console.error('Error calculating offline prayer times:', e);
                return null;
            }
        }

        // ==================== HELPER FUNCTIONS ====================
        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„ØµÙŠÙÙŠ Ø£Ù… Ø§Ù„Ø´ØªÙˆÙŠ
        function getAutomaticDSTAdjustment(country, date = new Date()) {
            // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ØŒ ÙŠÙ…ÙƒÙ† ØªØ¹Ø·ÙŠÙ„Ù‡ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            if (!defaultSettings.dstAutoAdjust) return 0;
            
            const month = date.getMonth() + 1; // Ø´Ù‡Ø± 1-12
            const day = date.getDate();
            
            // ØªØ­Ø¯ÙŠØ¯ ÙØªØ±Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„ØµÙŠÙÙŠ ÙˆØ§Ù„Ø´ØªÙˆÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø©
            if (country === 'Ø§Ù„Ø£Ø±Ø¯Ù†' || country === 'ÙÙ„Ø³Ø·ÙŠÙ†' || country ==='Ù„Ø¨Ù†Ø§Ù†' || country ==='Ø³ÙˆØ±ÙŠØ§') {
                // Ø§Ù„Ø£Ø±Ø¯Ù† ÙˆÙÙ„Ø³Ø·ÙŠÙ† ÙˆØ³ÙˆØ±ÙŠØ§ ÙˆÙ„Ø¨Ù†Ø§Ù†: Ø£Ù„ØºÙˆØ§ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„ØµÙŠÙÙŠ ÙÙŠ 2023
                return 0;
            }
            else if (country === 'Ù…ØµØ±') {
                // Ù…ØµØ±: Ø£Ù„ØºØª Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„ØµÙŠÙÙŠ ÙÙŠ 2023
                return 0;
            }
            else if (country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' || country === 'Ø§Ù„ÙƒÙˆÙŠØª' || country ==='Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†' || country ==='Ù‚Ø·Ø±' || country ==='Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©' || country ==='Ø¹Ù…Ø§Ù†') {
                // Ø¯ÙˆÙ„ Ø§Ù„Ø®Ù„ÙŠØ¬: Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØªØ±Ø© ØªÙˆÙ‚ÙŠØª ØµÙŠÙÙŠ officially
                return 0;
            }
            // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆÙ„: Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ù…Ù† Ù…Ø§Ø±Ø³ Ø¥Ù„Ù‰ Ø£ÙƒØªÙˆØ¨Ø±
            if (month > 2 && month < 11) return 60; // +1 Ø³Ø§Ø¹Ø© (ØªÙˆÙ‚ÙŠØª ØµÙŠÙÙŠ)
            return 0; // Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¹Ø§Ø¯ÙŠ (Ø´ØªÙˆÙŠ)
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆÙ‚ÙŠØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ®
        function updateDSTBasedOnDate() {
            const now = new Date();
            const country = state.settings.country || 'Ø§Ù„Ø£Ø±Ø¯Ù†';
            const autoAdjustment = getAutomaticDSTAdjustment(country, now);
            
            // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ø®ØªÙ„ÙØ§Ù‹ Ø¹Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (autoAdjustment !== state.settings.dstAdjustment && state.settings.dstAdjustment !== 1) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ Ù‚Ø§Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ ÙŠØ¯ÙˆÙŠØŒ Ù„Ø§ Ù†ØºÙŠØ±Ù‡
                return;
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            if (autoAdjustment !== state.settings.dstAdjustment) {
                console.log(`ğŸ”„ ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ: ${autoAdjustment === 60 ? 'ØªÙˆÙ‚ÙŠØª ØµÙŠÙÙŠ (+1 Ø³Ø§Ø¹Ø©)' : 'ØªÙˆÙ‚ÙŠØª Ø´ØªÙˆÙŠ (Ø¹Ø§Ø¯ÙŠ)'}`);
                state.settings.dstAdjustment = autoAdjustment;
                
                // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ù…Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                updatePrayerTimes();
            }
        }
        
        // ==================== API FUNCTIONS ====================
        
        function getCacheKey(country, city, year) {
            return `prayerTimes_${country}_${city}_${year}`;
        }

        function getCachedPrayerTimes(country, city, date) {
            try {
                const year = date.getFullYear();
                const month = date.getMonth() + 1; // 1-12
                const day = date.getDate();
                
                const key = getCacheKey(country, city, year);
                const cachedData = localStorage.getItem(key);
                
                if (!cachedData) return null;
                
                const data = JSON.parse(cachedData);
                // Aladhan API structure for calendar: data[month_index][day_index] or similar
                // We will store exactly what the API returns: object with months "1", "2", etc.
                
                if (data && data[month] && data[month][day - 1]) {
                    const timings = data[month][day - 1].timings;
                    const normalize = (v) => (v ? String(v).split(' ')[0] : '');
                    return {
                        fajr: normalize(timings.Fajr),
                        shuruq: normalize(timings.Sunrise),
                        dhuhr: normalize(timings.Dhuhr),
                        asr: normalize(timings.Asr),
                        maghrib: normalize(timings.Maghrib),
                        isha: normalize(timings.Isha),
                    };
                }
            } catch (e) {
                console.error('Error reading from cache:', e);
            }
            return null;
        }

        async function fetchAndCacheAnnualPrayerTimes(country, city, year) {
            const mapping = resolveLocationMapping(country, city);
            const method = (mapping.method !== undefined && mapping.method !== null) ? mapping.method : 23; 
            const countryParam = mapping.apiCountry || country;
            const cityParam = mapping.apiCity || city;

            const params = new URLSearchParams({
                city: cityParam,
                country: countryParam,
                method: String(method),
                year: String(year),
                annual: 'true'
            });

            const url = `https://api.aladhan.com/v1/calendarByCity?${params.toString()}`;
            console.log('Fetching annual prayer times...', url);

            const response = await fetch(url);
            if (!response.ok) throw new Error(`Failed to fetch annual times: ${response.status}`);
            
            const json = await response.json();
            if (json.code !== 200 || !json.data) throw new Error('Invalid annual data');

            // Save to localStorage
            const key = getCacheKey(country, city, year);
            localStorage.setItem(key, JSON.stringify(json.data));
            console.log('Annual prayer times cached successfully for year', year);
        }

        async function fetchPrayerTimes(country, city) {
            const today = new Date();
            const currentYear = today.getFullYear();
            
            // 1. Try to get from cache
            const cached = getCachedPrayerTimes(country, city, today);
            
            // If cached data exists, we can return it.
            // But we should also check if we need to cache the CURRENT year (if not fully cached or if we want to ensure we have it)
            // For simplicity: If we have data for today, we assume the cache is good enough for now. 
            // We can trigger a background update if we want, but let's prioritize returning data.
            
            if (cached) {
                console.log('Using cached prayer times');
                
                // Optional: Check if we have next year's data if it's December?
                // Or just ensure we have the full current year if we only have partial?
                // The cache key is by year, so if it exists, it likely has the full year.
                
                return cached;
            }

            console.log('No cache found or cache miss, fetching from API...');

            try {
                // 2. If no cache, fetch the WHOLE year and cache it
                // This ensures that one successful connection fixes the app for the whole year
                await fetchAndCacheAnnualPrayerTimes(country, city, currentYear);
                
                // 3. Try to read from cache again
                const newCached = getCachedPrayerTimes(country, city, today);
                if (newCached) return newCached;
                
                throw new Error('Failed to retrieve prayer times after annual fetch');
            } catch (error) {
                console.error('Annual fetch failed, trying single day fallback:', error);
                
                // 4. Fallback to single day fetch (original logic) if annual fetch fails
                // (e.g. maybe API timed out on large request, but small request works?)
                // Although usually if one fails, both fail if it's network.
                // But let's keep the fallback just in case.
                
                try {
                    const mapping = resolveLocationMapping(country, city);
                    const method = (mapping.method !== undefined && mapping.method !== null) ? mapping.method : 23;
                    const tz = mapping.timeZone;
                    const countryParam = mapping.apiCountry || country;
                    const cityParam = mapping.apiCity || city;
        
                    const params = new URLSearchParams({
                        city: cityParam,
                        country: countryParam,
                        method: String(method),
                    });
                    if (tz) params.append('timezonestring', tz);
        
                    const dd = String(today.getDate()).padStart(2, '0');
                    const mm = String(today.getMonth() + 1).padStart(2, '0');
                    const yyyy = today.getFullYear();
                    const dateStr = `${dd}-${mm}-${yyyy}`;
                    const url = `https://api.aladhan.com/v1/timingsByCity/${dateStr}?${params.toString()}`;
                    // Ø¥Ø¶Ø§ÙØ© timeout Ù„Ø·Ù„Ø¨ Ø§Ù„Ø´Ø¨ÙƒØ©
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 Ø«Ø§Ù†ÙŠØ© timeout
                    
                    try {
                        const response = await fetch(url, { signal: controller.signal });
                        clearTimeout(timeoutId);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    } catch (fetchError) {
                        clearTimeout(timeoutId);
                        if (fetchError.name === 'AbortError') {
                            throw new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                        }
                        throw fetchError;
                    }
                    
                    const data = await response.json();
                    const normalize = (v) => (v ? String(v).split(' ')[0] : '');
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    if (!data || !data.data || !data.data.timings) {
                        throw new Error('Ø¨ÙŠØ§Ù†Ø§Øª ØªÙˆÙ‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©');
                    }
                    
                    const t = data.data.timings;
                    
                    // Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª Ù„Ù„ØªØµØ­ÙŠØ­
                    console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:', t);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ„ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    const prayers = {
                        fajr: t.Fajr,
                        shuruq: t.Sunrise || t.Shuruq || t.Fajr, // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù‚ÙŠÙ…Ø© Ù„Ù„Ø´Ø±ÙˆÙ‚ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ¬Ø± ÙƒÙ‚ÙŠÙ…Ø© Ø¨Ø¯ÙŠÙ„Ø©
                        dhuhr: t.Dhuhr,
                        asr: t.Asr,
                        maghrib: t.Maghrib,
                        isha: t.Isha,
                    };
                    
                    // Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ„ÙˆØ§Øª Ù„Ù„ØªØµØ­ÙŠØ­
                    console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:', prayers);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„ÙˆØ§Øª
                    for (const prayer in prayers) {
                        if (!prayers[prayer]) {
                            console.warn(`Missing prayer time for: ${prayer}`);
                        }
                    }
                    
                    return {
                        fajr: normalize(prayers.fajr),
                        shuruq: normalize(prayers.shuruq),
                        dhuhr: normalize(prayers.dhuhr),
                        asr: normalize(prayers.asr),
                        maghrib: normalize(prayers.maghrib),
                        isha: normalize(prayers.isha),
                    };
                } catch (fallbackError) {
                    console.error('All fetch attempts failed, using offline calculation:', fallbackError);
                    
                    const offlineTimes = calculateOfflinePrayerTimes(country, city, today);
                    if (offlineTimes) {
                        console.log('Offline prayer times calculated successfully');
                        return offlineTimes;
                    }

                    // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ ÙƒÙ„ Ø´ÙŠØ¡ØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹
                    console.log('Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙƒØ­Ù„ Ø£Ø®ÙŠØ±');
                    return {
                        fajr: '04:02',
                        shuruq: '05:33',
                        dhuhr: '12:42',
                        asr: '16:23',
                        maghrib: '19:51',
                        isha: '21:22',
                    };
                }
            }
        }

        // ==================== FETCH TEMPERATURE FUNCTION ====================
        async function fetchTemperature(country, city) {
            try {
                const mapping = resolveLocationMapping(country, city);
                const apiCity = mapping.apiCity || city;

                // Ø§Ø³ØªØ®Ø¯Ø§Ù… wttr.in API (Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ù…ÙØªØ§Ø­ API)
                const url = `https://wttr.in/${apiCity}?format=j1`;

                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch temperature: ${response.status}`);
                }

                const data = await response.json();
                const temp = Math.round(data.current_condition[0].temp_C);
                console.log(`âœ… ØªÙ… Ø¬Ù„Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: ${temp}Â°C Ù„Ù…Ø¯ÙŠÙ†Ø© ${city}`);
                return temp;
            } catch (error) {
                console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:', error);
                return 25; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„
            }
        }

        // ==================== DEFAULT SETTINGS ====================
        const defaultSettings = {
            mosqueName: 'Ù…Ø³Ø¬Ø¯',
            timeFormat: '12h',
            // Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù† Ø¨Ø¹Ø¯
            remoteSyncEnabled: false,
            remoteSyncUrl: '', // Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
            deviceLocationId: '', // Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù…Ø³Ø¬Ø¯ (Ù…Ø«Ù„Ø§Ù‹: Riyadh_01)
            // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„ØµÙŠÙÙŠ ÙˆØ§Ù„Ø´ØªÙˆÙŠ (1 Ù„Ù„ØµÙŠÙØŒ -1 Ù„Ù„Ø´ØªÙˆÙŠØŒ 0 Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ)
            dstAutoAdjust: 1, // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            prayerTimes: {
                fajr: '04:02',
                dhuhr: '12:42',
                asr: '16:23',
                maghrib: '19:51',
                isha: '21:22',
            },
            manualPrayers: {}, // ØªØªØ¨Ø¹ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªÙŠ ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹
            prayerTimeOffsets: {
                fajr: 0,
                dhuhr: 0,
                asr: 1,
                maghrib: 1,
                isha: 0,
            },
            iqamaCountdown: {
                fajr: 20,
                dhuhr: 15,
                asr: 15,
                maghrib: 10,
                isha: 15,
            },
            dimDuration: 1,
            adhanDurationMinutes: 3,
            adhanDurationSeconds: 14,
            phoneImageDurationMinutes: 2,
            phoneImageDurationSeconds: 0,
            azkarDurationMinutes: 5,
            azkarDurationSeconds: 0,
            shuruqTime: '05:33',
            shuruqOffset: -5,
            jumuahTime: '12:43',
            jumuahOffset: 0,
            country: 'Ø§Ù„Ø£Ø±Ø¯Ù†',
            city: 'Ø¹Ù…Ø§Ù†',
            neighborhood: '',
            street: '',
            dstAdjustment: 0,
            showWeather: true,
            temperature: 25,
            adhanSound: '',
            fajrAdhanSound: '',
            phoneImage: '',
            adhanImage: '',
            iqamaBackgroundImage: '',
            iqamaBackgroundColor: '#1e3a8a',
            volume: 0.5,
            isMuted: false,
            azkarBackgroundImage: '',
            backgroundImage: '',
            adhanTextPosition: 'center',
            colors: {
                textColor: '#FFFFFF',
                nextPrayerTextColor: '#FFD700',
                iqamaCountdownTextColor: '#FFFFFF',
                azkarTextColor: '#FFFFFF',
                shuruqBoxColor: '#1e3a8a',
                clockBoxColor: '#1d4ed8',
                jumuahBoxColor: '#1e3a8a',
                prayerBoxesColor: '#1e3a8a',
            },
        };

        // ==================== REMOTE SYNC FUNCTIONS ====================
        async function checkRemoteUpdates() {
            const settings = getSettings();
            if (!settings.remoteSyncEnabled || !settings.remoteSyncUrl) return;

            try {
                console.log('ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù† Ø¨Ø¹Ø¯...');
                // Ù†Ø±Ø³Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù„Ù„Ø³ÙŠØ±ÙØ± Ù„ÙŠØ¹Ø±Ù Ø£ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙŠØ±Ø³Ù„
                const url = new URL(settings.remoteSyncUrl);
                url.searchParams.append('locationId', settings.deviceLocationId || settings.city);
                url.searchParams.append('city', settings.city);
                url.searchParams.append('t', Date.now()); // Ù„Ù…Ù†Ø¹ Ø§Ù„ÙƒØ§Ø´

                const response = await fetch(url.toString());
                if (!response.ok) throw new Error('Failed to connect to remote sync server');

                const remoteConfig = await response.json();
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ«Ù‡Ø§
                if (remoteConfig && Object.keys(remoteConfig).length > 0) {
                    console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù† Ø¨Ø¹Ø¯ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
                    
                    // Ø¯Ù…Ø¬ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    state.settings = {
                        ...state.settings,
                        ...remoteConfig
                    };
                    
                    saveSettings();
                    renderMainScreen();
                    
                    // Ø¥Ø°Ø§ ØªØºÙŠØ±Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ù†Ø­Ø¯Ø« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙÙˆØ±Ø§Ù‹
                    if (remoteConfig.city || remoteConfig.country) {
                        await updatePrayerTimes();
                    }
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù† Ø¨Ø¹Ø¯:', error);
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
        setInterval(checkRemoteUpdates, 10 * 60 * 1000);

        // ==================== UPDATE FUNCTIONS ====================
        async function updatePrayerTimes() {
            // Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù† Ø¨Ø¹Ø¯ Ù‚Ø¨Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª
            await checkRemoteUpdates();
            
            console.log('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©...');
            try {
                const settings = getSettings();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                if (!settings || !settings.country || !settings.city) {
                    console.error('âŒ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©');
                    throw new Error('Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©');
                }
                
                console.log(`ğŸ“ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù€: ${settings.city}, ${settings.country}`);
                const newTimes = await fetchPrayerTimes(settings.country, settings.city);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª
                if (!newTimes) {
                    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©');
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©');
                }
                
                console.log('âœ… ØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­:', newTimes);
                
                // Ø¬Ù„Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                const currentTemp = await fetchTemperature(settings.country, settings.city);
                settings.temperature = currentTemp;
                
                // Apply DST adjustment and manual offsets
                const dst = settings.dstAdjustment || 0;
                const offsets = settings.prayerTimeOffsets || { fajr: 0, dhuhr: 0, asr: 0, maghrib: 0, isha: 0 };
                
                if (dst !== 0 || Object.values(offsets).some(v => v !== 0)) {
                    console.log(`Applying adjustments - DST: ${dst}, Offsets:`, offsets);
                    const adjustedTimes = JSON.parse(JSON.stringify(newTimes)); // Ù†Ø³Ø®Ø© Ø¹Ù…ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª
                    for (const prayer in adjustedTimes) {
                        if (adjustedTimes[prayer]) {
                            const offset = (offsets[prayer] || 0) + dst;
                            adjustedTimes[prayer] = applyOffsetToTime(adjustedTimes[prayer], offset);
                        }
                    }
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
                    newTimes = adjustedTimes;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
                settings.prayerTimes = newTimes;
                
                // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ø´Ø±ÙˆÙ‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (newTimes && newTimes.shuruq) {
                    settings.shuruqTime = newTimes.shuruq;
                    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ø´Ø±ÙˆÙ‚ Ø¥Ù„Ù‰:', newTimes.shuruq);
                } else {
                    console.warn('âš ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆÙ‚Øª Ø§Ù„Ø´Ø±ÙˆÙ‚ ØºÙŠØ± Ù…ØªØ§Ø­Ø©ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ ÙˆÙ‚Øª Ø´Ø±ÙˆÙ‚ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    if (!settings.shuruqTime) {
                        settings.shuruqTime = '05:33';
                        console.log('ğŸ”„ ØªÙ… ØªØ¹ÙŠÙŠÙ† ÙˆÙ‚Øª Ø§Ù„Ø´Ø±ÙˆÙ‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:', settings.shuruqTime);
                    }
                }
                
                // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                state.settings = settings;
                saveSettings();
                
                console.log('ğŸ‰ ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­');
                // ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù†Ø§Ø¬Ø­
                state.lastSuccessfulUpdate = new Date();
                state.lastUpdateAttempt = new Date();
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                renderMainScreen();
                return true;
            } catch (error) {
                console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©:', error.message);
                
                // ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Øª Ø¢Ø®Ø± Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«
                state.lastUpdateAttempt = new Date();
                
                // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                if (error.message.includes('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª') || 
                    error.message.includes('Failed to fetch') ||
                    error.message.includes('ERR_CONNECTION_TIMED_OUT')) {
                    console.warn('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                    
                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ ØªØ­Ø¯ÙŠØ« Ù†Ø§Ø¬Ø­ Ù…Ù† Ù‚Ø¨Ù„ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    if (!state.lastSuccessfulUpdate) {
                        console.log('ğŸ”„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙƒØ­Ù„ Ù…Ø¤Ù‚Øª');
                        state.settings.prayerTimes = {
                            fajr: '04:02',
                            shuruq: '05:33',
                            dhuhr: '12:42',
                            asr: '16:23',
                            maghrib: '19:51',
                            isha: '21:22',
                        };
                        renderMainScreen();
                    }
                    
                    return false;
                }
                
                return false;
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        window.addEventListener('load', async () => {
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
            updateDSTBasedOnDate();
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙƒÙ„ Ø³Ø§Ø¹Ø© Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙ‚ÙŠØª
            setInterval(updateDSTBasedOnDate, 60 * 60 * 1000);
            
            await updatePrayerTimes();
            
            // ØªØ­Ø¯ÙŠØ« ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
            function scheduleMidnightUpdate() {
                const now = new Date();
                const midnight = new Date(now);
                midnight.setHours(24, 0, 0, 0); // Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
                
                const timeUntilMidnight = midnight - now;
                
                // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                setTimeout(updatePrayerTimes, timeUntilMidnight);
                
                // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
                setInterval(updatePrayerTimes, 24 * 60 * 60 * 1000);
            }
            
            scheduleMidnightUpdate();
        });
        
        // ==================== UTILITY FUNCTIONS ====================
        function applyOffsetToTime(time, offsetMinutes) {
            if (!time || !time.includes(':')) return time;
            const [hours, minutes] = time.split(':').map(Number);
            if (isNaN(hours) || isNaN(minutes)) return time;
            
            const totalMinutes = hours * 60 + minutes + offsetMinutes;
            const adjustedMinutes = ((totalMinutes % 1440) + 1440) % 1440;
            const newHours = Math.floor(adjustedMinutes / 60);
            const newMinutes = adjustedMinutes % 60;
            
            return `${String(newHours).padStart(2, '0')}:${String(newMinutes).padStart(2, '0')}`;
        }

        function formatPrayerTime(time24, timeFormat, nowTz) {
            if (!time24 || !time24.includes(':')) return '';
            const [hours, minutes] = time24.split(':');
            if (isNaN(parseInt(hours)) || isNaN(parseInt(minutes))) return '';
            
            const date = new Date(nowTz);
            date.setHours(parseInt(hours, 10), parseInt(minutes, 10), 0, 0);
            
            if (timeFormat === '12h') {
                let h = date.getHours();
                const period = h >= 12 ? 'PM' : 'AM';
                h = h % 12 || 12;
                return `${h}:${String(date.getMinutes()).padStart(2, '0')}`;
            } else {
                return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
            }
        }

        function formatHijriDate(date) {
            return new Intl.DateTimeFormat('ar-SA-u-ca-islamic-civil', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
            }).format(date);
        }

        function formatGregorianDate(date) {
            return new Intl.DateTimeFormat('ar-EG', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
            }).format(date);
        }

        // ==================== REMOTE CONTROL ====================
        let remoteControl = null;
        if (typeof RemoteControlManager !== 'undefined') {
            remoteControl = new RemoteControlManager();
            const firebaseConfig = {
                apiKey: "AIzaSyDK_kEdxeew7b60MU6oD8CO4LJ0y_y7q-0",
                authDomain: "muezzins-call-481df.firebaseapp.com",
                databaseURL: "https://muezzins-call-481df.firebaseio.com",
                projectId: "muezzins-call-481df",
                storageBucket: "muezzins-call-481df.firebasestorage.app",
                messagingSenderId: "633935423896",
                appId: "1:633935423896:web:51e8f649fe32c3340823ed"
            };
            remoteControl.init(firebaseConfig);
        }

        // ==================== STATE MANAGEMENT ====================
        let state = {
            settings: JSON.parse(JSON.stringify(defaultSettings)),
            isPanelOpen: false,
            isFetchingTimes: false,
            isOffline: false,
            lastSuccessfulUpdate: null,
            lastUpdateAttempt: null,
            currentPhase: 'idle', // 'idle' | 'adhan' | 'iqamaCountdown' | 'phoneImage' | 'azkar'
            activePrayer: null,
            iqamaEndTime: null,
            currentAzkarIndex: 0,
            currentTime: new Date(),
            phaseTimeoutRef: null,
            azkarIntervalRef: null,
            isAdhanPlaying: false,
            audioUnlocked: false,
        };

        // ==================== SETTINGS FUNCTIONS ====================
        function getSettings() {
            try {
                const savedSettings = localStorage.getItem('alMoazinClockSettings');
                if (savedSettings) {
                    const parsedSettings = JSON.parse(savedSettings);
                    return {
                        ...defaultSettings,
                        ...parsedSettings
                    };
                }
            } catch (e) {
                console.error('Error loading settings:', e);
            }
            return defaultSettings;
        }
        
        // ==================== NETWORK MONITORING ====================
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
        function checkNetworkStatus() {
            const wasOffline = state.isOffline;
            state.isOffline = !navigator.onLine;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯ØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª
            if (!state.isOffline && wasOffline) {
                console.log('ğŸŒ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†ØªØŒ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª...');
                setTimeout(updatePrayerTimes, 2000); // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            renderMainScreen();
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        window.addEventListener('online', checkNetworkStatus);
        window.addEventListener('offline', checkNetworkStatus);
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        checkNetworkStatus();
        
        // ==================== INITIALIZATION ====================
        function init() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† localStorage Ù…ØªØ§Ø­
            if (typeof(Storage) === "undefined") {
                console.error('âŒ localStorage ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
                state.settings = JSON.parse(JSON.stringify(defaultSettings));
                renderMainScreen();
                return;
            }
            
            // Load settings from localStorage
            try {
                console.log('ğŸ“‚ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† localStorage...');
                const savedSettings = localStorage.getItem('alMoazinClockSettings');
                const savedMedia = localStorage.getItem('alMoazinMediaFiles');
                const savedPrayerTimesData = localStorage.getItem('alMoazinPrayerTimesData');
                
                console.log('ğŸ“¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:', {
                    hasSettings: !!savedSettings,
                    hasMedia: !!savedMedia,
                    hasPrayerTimesData: !!savedPrayerTimesData,
                    settingsLength: savedSettings ? savedSettings.length : 0,
                    mediaLength: savedMedia ? savedMedia.length : 0,
                    prayerTimesDataLength: savedPrayerTimesData ? savedPrayerTimesData.length : 0
                });
                
                if (savedSettings) {
                    console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©');
                    const parsedSettings = JSON.parse(savedSettings);
                    let parsedMedia = {};
                    let parsedPrayerTimesData = {};
                    
                    if (savedMedia) {
                        try {
                            parsedMedia = JSON.parse(savedMedia);
                            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:', {
                                hasBackgroundImage: !!parsedMedia.backgroundImage,
                                hasPhoneImage: !!parsedMedia.phoneImage,
                                hasAdhanImage: !!parsedMedia.adhanImage,
                                hasIqamaBackgroundImage: !!parsedMedia.iqamaBackgroundImage,
                                hasAzkarBackgroundImage: !!parsedMedia.azkarBackgroundImage,
                                hasAdhanSound: !!parsedMedia.adhanSound,
                                hasFajrAdhanSound: !!parsedMedia.fajrAdhanSound
                            });
                        } catch (e) {
                            console.warn('âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:', e);
                            parsedMedia = {};
                        }
                    } else {
                        console.log('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø©');
                    }

                    if (savedPrayerTimesData) {
                        try {
                            parsedPrayerTimesData = JSON.parse(savedPrayerTimesData);
                            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:', {
                                lastUpdated: parsedPrayerTimesData.lastUpdated,
                                hasPrayerTimes: !!parsedPrayerTimesData.prayerTimes,
                                hasPrayerTimeOffsets: !!parsedPrayerTimesData.prayerTimeOffsets
                            });
                        } catch (e) {
                            console.warn('âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©:', e);
                            parsedPrayerTimesData = {};
                        }
                    } else {
                        console.log('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª ØµÙ„Ø§Ø© Ù…Ø­ÙÙˆØ¸Ø©');
                    }
                    
                    // Ø¯Ù…Ø¬ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ…
                    // Ø§Ù„Ù…Ù„ÙØ§Øª ÙŠØ¬Ø¨ Ø£Ù† ØªØ£ØªÙŠ Ø¨Ø¹Ø¯ parsedSettings Ù„ØªØªØ¬Ø§ÙˆØ² Ø£ÙŠ Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    state.settings = {
                        ...defaultSettings,
                        ...parsedSettings,
                        // Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„ÙŠÙ‡Ø§
                        backgroundImage: parsedMedia.backgroundImage || parsedSettings.backgroundImage || defaultSettings.backgroundImage,
                        phoneImage: parsedMedia.phoneImage || parsedSettings.phoneImage || defaultSettings.phoneImage,
                        adhanImage: parsedMedia.adhanImage || parsedSettings.adhanImage || defaultSettings.adhanImage,
                        iqamaBackgroundImage: parsedMedia.iqamaBackgroundImage || parsedSettings.iqamaBackgroundImage || defaultSettings.iqamaBackgroundImage,
                        azkarBackgroundImage: parsedMedia.azkarBackgroundImage || parsedSettings.azkarBackgroundImage || defaultSettings.azkarBackgroundImage,
                        adhanSound: parsedMedia.adhanSound || parsedSettings.adhanSound || defaultSettings.adhanSound,
                        fajrAdhanSound: parsedMedia.fajrAdhanSound || parsedSettings.fajrAdhanSound || defaultSettings.fajrAdhanSound,
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¯Ù…Ø¬ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                        colors: {
                            ...defaultSettings.colors,
                            ...(parsedSettings.colors || {}),
                        },
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¯Ù…Ø¬ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                        prayerTimes: {
                            ...defaultSettings.prayerTimes,
                            ...(parsedSettings.prayerTimes || {}),
                            ...(parsedPrayerTimesData.prayerTimes || {}),
                        },
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¯Ù…Ø¬ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                        iqamaCountdown: {
                            ...defaultSettings.iqamaCountdown,
                            ...(parsedSettings.iqamaCountdown || {}),
                        },
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¯Ù…Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                        prayerTimeOffsets: {
                            ...defaultSettings.prayerTimeOffsets,
                            ...(parsedSettings.prayerTimeOffsets || {}),
                            ...(parsedPrayerTimesData.prayerTimeOffsets || {}),
                        },
                        shuruqTime: parsedPrayerTimesData.shuruqTime || parsedSettings.shuruqTime || defaultSettings.shuruqTime,
                        shuruqOffset: parsedPrayerTimesData.shuruqOffset !== undefined ? parsedPrayerTimesData.shuruqOffset : (parsedSettings.shuruqOffset !== undefined ? parsedSettings.shuruqOffset : defaultSettings.shuruqOffset),
                        jumuahTime: parsedPrayerTimesData.jumuahTime || parsedSettings.jumuahTime || defaultSettings.jumuahTime,
                        jumuahOffset: parsedPrayerTimesData.jumuahOffset !== undefined ? parsedPrayerTimesData.jumuahOffset : (parsedSettings.jumuahOffset !== undefined ? parsedSettings.jumuahOffset : defaultSettings.jumuahOffset),
                    };
                    
                    // Ø¥Ø²Ø§Ù„Ø© lastSaved Ù…Ù† state.settings Ù„Ø£Ù†Ù‡ Ù„ÙŠØ³ Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    if (state.settings.lastSaved) {
                        delete state.settings.lastSaved;
                    }
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­:', {
                        mosqueName: state.settings.mosqueName,
                        country: state.settings.country,
                        city: state.settings.city,
                        prayerTimes: state.settings.prayerTimes,
                        iqamaCountdown: state.settings.iqamaCountdown,
                        colors: state.settings.colors,
                        lastSaved: parsedSettings.lastSaved
                    });
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                    if (!state.settings.prayerTimes || !state.settings.colors || !state.settings.iqamaCountdown) {
                        console.warn('âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø© - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                        state.settings = {
                            ...defaultSettings,
                            ...state.settings,
                            prayerTimes: state.settings.prayerTimes || defaultSettings.prayerTimes,
                            colors: state.settings.colors || defaultSettings.colors,
                            iqamaCountdown: state.settings.iqamaCountdown || defaultSettings.iqamaCountdown,
                        };
                    }
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                    console.log('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', {
                        hasPrayerTimes: !!state.settings.prayerTimes,
                        hasColors: !!state.settings.colors,
                        hasIqamaCountdown: !!state.settings.iqamaCountdown,
                        mosqueName: state.settings.mosqueName,
                        prayerTimesCount: Object.keys(state.settings.prayerTimes || {}).length,
                        hasBackgroundImage: !!state.settings.backgroundImage,
                        backgroundImageLength: state.settings.backgroundImage ? state.settings.backgroundImage.length : 0,
                        hasPhoneImage: !!state.settings.phoneImage,
                        hasAdhanImage: !!state.settings.adhanImage
                    });
                } else {
                    console.log('ğŸ†• Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                    state.settings = JSON.parse(JSON.stringify(defaultSettings));
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
                    try {
                        const essentialSettings = {
                            ...defaultSettings,
                            lastSaved: new Date().toISOString()
                        };
                        delete essentialSettings.backgroundImage;
                        delete essentialSettings.iqamaBackgroundImage;
                        delete essentialSettings.azkarBackgroundImage;
                        delete essentialSettings.phoneImage;
                        delete essentialSettings.adhanImage;
                        delete essentialSettings.adhanSound;
                        delete essentialSettings.fajrAdhanSound;
                        localStorage.setItem('alMoazinClockSettings', JSON.stringify(essentialSettings));
                        console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©');
                    } catch (e) {
                        console.warn('âš ï¸ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:', e);
                    }
                }
            } catch (error) {
                console.error('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                state.settings = JSON.parse(JSON.stringify(defaultSettings));
            }

            // Initialize audio
            const audioRef = document.getElementById('audioRef');
            if (audioRef) {
                audioRef.volume = state.settings.volume;
                audioRef.muted = state.settings.isMuted;
            }

            // Start clock
            setInterval(() => {
                const now = new Date();
                // Apply DST adjustment to current time if set
                if (state.settings.dstAdjustment && state.settings.dstAdjustment !== 0) {
                    now.setMinutes(now.getMinutes() + state.settings.dstAdjustment);
                }
                state.currentTime = now;
                updateUI();
            }, 1000);

            // Initial render
            renderMainScreen();
            setupEventListeners();
            checkPrayerTime();
            
            // Check prayer time every 250ms - ÙØ­Øµ Ù…ØªÙƒØ±Ø± Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªÙÙˆÙŠØª ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
            setInterval(checkPrayerTime, 250);
            
            // ÙØ­Øµ Ø¥Ø¶Ø§ÙÙŠ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ØªÙÙˆÙŠØª ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
            setInterval(() => {
                if (state.currentPhase === 'idle') {
                    checkPrayerTime();
                }
            }, 1000);
            
            // Check iqama countdown
            setInterval(checkIqamaCountdown, 1000);
            
            // Initialize prayer times update system
            initializePrayerTimesUpdates();
        }
        
        // ==================== PRAYER TIMES AUTO-UPDATE SYSTEM ====================
        function initializePrayerTimesUpdates() {
            console.log('[AUTO UPDATE] ğŸš€ Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…ÙˆØ§Ù‚ÙŠØª');
            
            // 1. ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            const initializeApp = async () => {
                console.log('[INIT] ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ - ÙØ­Øµ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«');
                
                const storedTimesData = localStorage.getItem('alMoazinPrayerTimes');
                let needsUpdate = true;
                
                if (storedTimesData) {
                    try {
                        const { date, fetchTime } = JSON.parse(storedTimesData);
                        const today = `${state.currentTime.getFullYear()}-${String(state.currentTime.getMonth() + 1).padStart(2, '0')}-${String(state.currentTime.getDate()).padStart(2, '0')}`;
                        const isToday = date === today;
                        const fetchAge = Date.now() - (fetchTime || 0);
                        const maxAge = 12 * 60 * 60 * 1000; // 12 Ø³Ø§Ø¹Ø©
                        
                        if (isToday && fetchAge < maxAge) {
                            needsUpdate = false;
                            console.log('[INIT] âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© - Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†');
                        } else {
                            console.log(`[INIT] âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© - Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø·Ù„ÙˆØ¨ (Ø§Ù„Ø¹Ù…Ø±: ${Math.round(fetchAge / 60000)} Ø¯Ù‚ÙŠÙ‚Ø©)`);
                        }
                    } catch (e) {
                        console.log('[INIT] âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© - Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«');
                    }
                } else {
                    console.log('[INIT] ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© - Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«');
                }
                
                if (needsUpdate) {
                    await fetchPrayerTimesAndWeather(true);
                }
            };
            
            initializeApp();
            
            // 2. ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª
            const REFRESH_INTERVAL = 6 * 60 * 60 * 1000; // 6 Ø³Ø§Ø¹Ø§Øª
            const periodicUpdateId = setInterval(async () => {
                console.log(`[PERIODIC UPDATE] ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ Ù„Ù„Ù…ÙˆØ§Ù‚ÙŠØª`);
                try {
                    await fetchPrayerTimesAndWeather(true);
                } catch (error) {
                    console.log('[PERIODIC UPDATE] âš ï¸ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                }
            }, REFRESH_INTERVAL);
            
            // 3. ÙØ­Øµ ÙŠÙˆÙ…ÙŠ Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø©
            const DAILY_CHECK_INTERVAL = 60 * 60 * 1000; // Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©
            const dailyCheckId = setInterval(async () => {
                const storedTimesData = localStorage.getItem('alMoazinPrayerTimes');
                if (storedTimesData) {
                    try {
                        const { date } = JSON.parse(storedTimesData);
                        const today = `${state.currentTime.getFullYear()}-${String(state.currentTime.getMonth() + 1).padStart(2, '0')}-${String(state.currentTime.getDate()).padStart(2, '0')}`;
                        
                        if (date !== today) {
                            console.log(`[DAILY CHECK] ğŸ“… Ø§ÙƒØªØ´Ø§Ù ØªØ§Ø±ÙŠØ® Ø¬Ø¯ÙŠØ¯ ${today} - Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«`);
                            try {
                                await fetchPrayerTimesAndWeather(true);
                                console.log('[DAILY CHECK] âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                            } catch (error) {
                                console.log('[DAILY CHECK] âš ï¸ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                            }
                        }
                    } catch (e) {
                        console.error('[DAILY CHECK] âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„ØªØ§Ø±ÙŠØ®:', e);
                    }
                }
            }, DAILY_CHECK_INTERVAL);
            
            // 4. ØªØ­Ø¯ÙŠØ« ÙŠÙˆÙ…ÙŠ Ù…Ø¶Ù…ÙˆÙ† Ø¹Ù†Ø¯ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
            const scheduleMidnightUpdate = () => {
                const now = new Date();
                const midnight = new Date(now);
                midnight.setHours(0, 0, 0, 0);
                midnight.setDate(midnight.getDate() + 1); // Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¯Ù…
                
                const msUntilMidnight = midnight.getTime() - now.getTime();
                
                console.log(`[MIDNIGHT UPDATE] ğŸŒ™ Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¹Ù†Ø¯ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„ Ø¨Ø¹Ø¯ ${Math.round(msUntilMidnight / (1000 * 60 * 60))} Ø³Ø§Ø¹Ø©`);
                
                return setTimeout(async () => {
                    console.log('[MIDNIGHT UPDATE] ğŸŒ… Ø­Ø§Ù† Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„ - Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…ÙŠ');
                    
                    try {
                        await fetchPrayerTimesAndWeather(true);
                        console.log('[MIDNIGHT UPDATE] âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø¨Ù†Ø¬Ø§Ø­');
                    } catch (error) {
                        console.log('[MIDNIGHT UPDATE] âš ï¸ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
                    }
                    
                    // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ù„ÙŠ
                    scheduleMidnightUpdate();
                }, msUntilMidnight);
            };
            
            const midnightTimeoutId = scheduleMidnightUpdate();
            
            // 5. ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø§Ù„ÙØ¬Ø± (Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ù„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ÙØ¬Ø±)
            const scheduleNextFajrUpdate = () => {
                const fajrTime = state.settings.prayerTimes.fajr;
                if (!fajrTime || !fajrTime.includes(':')) return;
                
                try {
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    
                    const [hours, minutes] = fajrTime.split(':').map(Number);
                    tomorrow.setHours(hours, minutes, 0, 0);
                    
                    const msUntilNextFajr = tomorrow.getTime() - new Date().getTime();
                    
                    if (msUntilNextFajr > 0) {
                        console.log(`[FAJR UPDATE] ğŸ•°ï¸ Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ù„ÙŠ Ø¹Ù†Ø¯ ÙØ¬Ø± Ø§Ù„ØºØ¯ (${fajrTime}) - Ø¨Ø¹Ø¯ ${Math.round(msUntilNextFajr / (1000 * 60 * 60))} Ø³Ø§Ø¹Ø©`);
                        
                        setTimeout(async () => {
                            console.log(`[FAJR UPDATE] ğŸŒ… Ù‚Ø¯ Ø­Ø§Ù† ÙØ¬Ø± ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ - Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«`);
                            await fetchPrayerTimesAndWeather(true);
                            scheduleNextFajrUpdate(); // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ù„ÙŠ
                        }, msUntilNextFajr);
                    }
                } catch (error) {
                    console.error(`[FAJR UPDATE] âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«:`, error);
                }
            };
            
            // Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø§Ù„ÙØ¬Ø± Ø¨Ø¹Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„Ø£ÙˆÙ„Ù‰
            setTimeout(() => {
                scheduleNextFajrUpdate();
            }, 5000); // Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ Ù…Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„
            
            console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙˆØ§Ù„ÙŠÙˆÙ…ÙŠ ÙˆØ§Ù„Ø¯ÙˆØ±ÙŠ ÙˆØ§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ');
            
            // ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø³ÙŠØªÙ… ØªÙ†Ø¸ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©)
            window.addEventListener('beforeunload', () => {
                clearInterval(periodicUpdateId);
                clearTimeout(midnightTimeoutId);
                clearInterval(dailyCheckId);
            });
        }

        // ==================== PRAYER TIME CHECKING ====================
        let lastCheckedTime = '';
        let lastTriggeredPrayer = null;
        let lastTriggeredTime = '';
        let prayerInterval = null;
        
        // Ø¯Ø§Ù„Ø© Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        function startPrayerMonitoring() {
            // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø³Ø§Ø¨Ù‚Ø©
            if (prayerInterval) {
                clearInterval(prayerInterval);
            }
            
            // ØªØ­ÙˆÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ù† Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
            const timeToMinutes = (timeStr) => {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            };
            
            const prayerTimes = state.settings.prayerTimes;
            if (!prayerTimes || Object.keys(prayerTimes).length === 0) {
                console.warn('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆÙ‚Ø§Øª ØµÙ„Ø§Ø© Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©');
                return;
            }
            
            const fajrMinutes = timeToMinutes(prayerTimes.fajr);
            const dhuhrMinutes = timeToMinutes(prayerTimes.dhuhr);
            const asrMinutes = timeToMinutes(prayerTimes.asr);
            const maghribMinutes = timeToMinutes(prayerTimes.maghrib);
            const ishaMinutes = timeToMinutes(prayerTimes.isha);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            const checkTime = () => {
                const now = new Date();
                const currentMinutes = now.getHours() * 60 + now.getMinutes();
                const currentSeconds = now.getSeconds();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„ ØµÙ„Ø§Ø© (Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª)
                if (currentMinutes >= fajrMinutes && currentMinutes < fajrMinutes + 1 && currentSeconds < 10) {
                    // Ø§Ù„Ø£Ø°Ø§Ù† Ù„ÙØ¬Ø± (Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª)
                    if (!lastTriggeredPrayer || lastTriggeredPrayer !== 'fajr' || lastTriggeredTime !== prayerTimes.fajr) {
                        console.log(`ğŸ•°ï¸ Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± - Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ø°Ø§Ù†`);
                        
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø°Ø§Ù†
                        const adhanFile = state.settings.fajrAdhanSound || 'audio/audio_fajr.mp3';
                        console.log(`ğŸµ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù†: ${adhanFile}`);
                        
                        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ù…Ø¨Ø§Ø´Ø±Ø©
                        triggerAdhan('fajr');
                        lastTriggeredPrayer = 'fajr';
                        lastTriggeredTime = prayerTimes.fajr;
                    }
                } else if (currentMinutes >= dhuhrMinutes && currentMinutes < dhuhrMinutes + 1 && currentSeconds < 10) {
                    // Ø§Ù„Ø£Ø°Ø§Ù† Ù„Ø¸Ù‡Ø± (Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª)
                    if (!lastTriggeredPrayer || lastTriggeredPrayer !== 'dhuhr' || lastTriggeredTime !== prayerTimes.dhuhr) {
                        console.log(`ğŸ•°ï¸ Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø± - Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ø°Ø§Ù†`);
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†
                        if (!state.audioUnlocked) {
                            const audioRef = document.getElementById('audioRef');
                            if (audioRef) {
                                try {
                                    audioRef.volume = 0;
                                    const playPromise = audioRef.play();
                                    if (playPromise) {
                                        playPromise.then(() => {
                                            audioRef.pause();
                                            audioRef.currentTime = 0;
                                            audioRef.volume = state.settings.volume;
                                            state.audioUnlocked = true;
                                            console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª');
                                            triggerAdhan('dhuhr');
                                        }).catch((e) => {
                                            console.warn('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:', e);
                                            triggerAdhan('dhuhr');
                                        });
                                    } else {
                                        triggerAdhan('dhuhr');
                                    }
                                } catch (e) {
                                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                                    triggerAdhan('dhuhr');
                                }
                            } else {
                                console.error('âŒ audioRef ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                                triggerAdhan('dhuhr');
                            }
                        } else {
                            triggerAdhan('dhuhr');
                        }
                        lastTriggeredPrayer = 'dhuhr';
                        lastTriggeredTime = prayerTimes.dhuhr;
                    }
                } else if (currentMinutes >= asrMinutes && currentMinutes < asrMinutes + 1 && currentSeconds < 10) {
                    // Ø§Ù„Ø£Ø°Ø§Ù† Ù„Ø¹ØµØ± (Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª)
                    if (!lastTriggeredPrayer || lastTriggeredPrayer !== 'asr' || lastTriggeredTime !== prayerTimes.asr) {
                        console.log(`ğŸ•°ï¸ Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ± - Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ø°Ø§Ù†`);
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†
                        if (!state.audioUnlocked) {
                            const audioRef = document.getElementById('audioRef');
                            if (audioRef) {
                                try {
                                    audioRef.volume = 0;
                                    const playPromise = audioRef.play();
                                    if (playPromise) {
                                        playPromise.then(() => {
                                            audioRef.pause();
                                            audioRef.currentTime = 0;
                                            audioRef.volume = state.settings.volume;
                                            state.audioUnlocked = true;
                                            console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª');
                                            triggerAdhan('asr');
                                        }).catch((e) => {
                                            console.warn('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:', e);
                                            triggerAdhan('asr');
                                        });
                                    } else {
                                        triggerAdhan('asr');
                                    }
                                } catch (e) {
                                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                                    triggerAdhan('asr');
                                }
                            } else {
                                console.error('âŒ audioRef ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                                triggerAdhan('asr');
                            }
                        } else {
                            triggerAdhan('asr');
                        }
                        lastTriggeredPrayer = 'asr';
                        lastTriggeredTime = prayerTimes.asr;
                    }
                } else if (currentMinutes >= maghribMinutes && currentMinutes < maghribMinutes + 1 && currentSeconds < 10) {
                    // Ø§Ù„Ø£Ø°Ø§Ù† Ù„Ù…ØºØ±Ø¨ (Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª)
                    if (!lastTriggeredPrayer || lastTriggeredPrayer !== 'maghrib' || lastTriggeredTime !== prayerTimes.maghrib) {
                        console.log(`ğŸ•°ï¸ Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© Ø§Ù„Ù…ØºØ±Ø¨ - Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ø°Ø§Ù†`);
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†
                        if (!state.audioUnlocked) {
                            const audioRef = document.getElementById('audioRef');
                            if (audioRef) {
                                try {
                                    audioRef.volume = 0;
                                    const playPromise = audioRef.play();
                                    if (playPromise) {
                                        playPromise.then(() => {
                                            audioRef.pause();
                                            audioRef.currentTime = 0;
                                            audioRef.volume = state.settings.volume;
                                            state.audioUnlocked = true;
                                            console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª');
                                            triggerAdhan('maghrib');
                                        }).catch((e) => {
                                            console.warn('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:', e);
                                            triggerAdhan('maghrib');
                                        });
                                    } else {
                                        triggerAdhan('maghrib');
                                    }
                                } catch (e) {
                                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                                    triggerAdhan('maghrib');
                                }
                            } else {
                                console.error('âŒ audioRef ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                                triggerAdhan('maghrib');
                            }
                        } else {
                            triggerAdhan('maghrib');
                        }
                        lastTriggeredPrayer = 'maghrib';
                        lastTriggeredTime = prayerTimes.maghrib;
                    }
                } else if (currentMinutes >= ishaMinutes && currentMinutes < ishaMinutes + 1 && currentSeconds < 10) {
                    // Ø§Ù„Ø£Ø°Ø§Ù† Ù„Ø¹Ø´Ø§Ø¡ (Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª)
                    if (!lastTriggeredPrayer || lastTriggeredPrayer !== 'isha' || lastTriggeredTime !== prayerTimes.isha) {
                        console.log(`ğŸ•°ï¸ Ø­Ø§Ù† ÙˆÙ‚Øª ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡ - Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ø°Ø§Ù†`);
                        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ù‚Ø¨Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†
                        if (!state.audioUnlocked) {
                            const audioRef = document.getElementById('audioRef');
                            if (audioRef) {
                                try {
                                    audioRef.volume = 0;
                                    const playPromise = audioRef.play();
                                    if (playPromise) {
                                        playPromise.then(() => {
                                            audioRef.pause();
                                            audioRef.currentTime = 0;
                                            audioRef.volume = state.settings.volume;
                                            state.audioUnlocked = true;
                                            console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª');
                                            triggerAdhan('isha');
                                        }).catch((e) => {
                                            console.warn('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:', e);
                                            triggerAdhan('isha');
                                        });
                                    } else {
                                        triggerAdhan('isha');
                                    }
                                } catch (e) {
                                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                                    triggerAdhan('isha');
                                }
                            } else {
                                console.error('âŒ audioRef ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                                triggerAdhan('isha');
                            }
                        } else {
                            triggerAdhan('isha');
                        }
                        lastTriggeredPrayer = 'isha';
                        lastTriggeredTime = prayerTimes.isha;
                    }
                }
            };
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
            prayerInterval = setInterval(checkTime, 60000);
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙˆØ±Ø§Ù‹
            checkTime();
            
            console.log('âœ… Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
        }
        
        function checkPrayerTime() {
            if (state.currentPhase !== 'idle') {
                // Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø£Ø®Ø±Ù‰ØŒ Ù„Ø§ Ù†ØªØ­Ù‚Ù‚
                return;
            }
            
            const now = new Date();
            const currentHours = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentSeconds = now.getSeconds();
            const currentTime = `${String(currentHours).padStart(2, '0')}:${String(currentMinutes).padStart(2, '0')}`;
            const currentTimeFull = `${currentTime}:${String(currentSeconds).padStart(2, '0')}`;
            
            // Ø·Ø¨Ø§Ø¹Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„ØªØ­Ù‚Ù‚ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† lastTriggeredTime
            if (currentTime !== lastCheckedTime && currentSeconds === 0) {
                console.log(`ğŸ” ÙØ­Øµ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© - Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ: ${currentTimeFull}`);
                console.log('ğŸ“‹ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:', state.settings.prayerTimes);
                console.log('ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', {
                    currentPhase: state.currentPhase,
                    activePrayer: state.activePrayer,
                    isAdhanPlaying: state.isAdhanPlaying,
                    lastTriggeredPrayer: lastTriggeredPrayer,
                    lastTriggeredTime: lastTriggeredTime
                });
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† lastTriggeredTime Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† ÙÙŠ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                if (lastCheckedTime && lastCheckedTime !== currentTime) {
                    console.log(`ğŸ”„ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† ${lastCheckedTime} Ø¥Ù„Ù‰ ${currentTime} - Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† lastTriggeredTime`);
                    // Ù†Ø¹ÙŠØ¯ ØªØ¹ÙŠÙŠÙ† lastTriggeredTime ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… Ù†ÙƒÙ† ÙÙŠ Ù†ÙØ³ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
                    const previousPrayerTime = lastTriggeredTime.split('-')[1];
                    if (previousPrayerTime !== currentTime) {
                        lastTriggeredTime = '';
                        lastTriggeredPrayer = null;
                        console.log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† lastTriggeredTime');
                    }
                }
                
                lastCheckedTime = currentTime;
            }
            
            const prayerTimes = state.settings.prayerTimes;
            
            if (!prayerTimes || Object.keys(prayerTimes).length === 0) {
                if (currentSeconds === 0) {
                    console.warn('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆÙ‚Ø§Øª ØµÙ„Ø§Ø© Ù…Ø­ÙÙˆØ¸Ø©');
                }
                return;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙ„Ø§Ø© ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù‚Ø§Ø±Ù†Ø© Ù†ØµÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø©
            const prayerName = Object.keys(prayerTimes).find(p => {
                const prayerTime = prayerTimes[p];
                if (!prayerTime) return false;
                
                // ØªØ·Ø¨ÙŠØ¹ Ø§Ù„ÙˆÙ‚Øª Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµØ­ÙŠØ­ (HH:MM)
                const normalizedPrayerTime = prayerTime.includes(':') ? prayerTime : null;
                if (!normalizedPrayerTime) return false;
                
                // Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (HH:MM)
                const matches = normalizedPrayerTime === currentTime;
                
                // Ø·Ø¨Ø§Ø¹Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
                if (matches) {
                    console.log(`ğŸ”” âœ… âœ… âœ… ØªØ·Ø§Ø¨Ù‚! ØµÙ„Ø§Ø© ${prayerNames[p]}: Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ ${currentTimeFull} - ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© ${normalizedPrayerTime} - Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ${currentSeconds} âœ… âœ… âœ…`);
                } else {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨ (Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù‚Ø¨Ù„)
                    const [prayerHours, prayerMinutes] = normalizedPrayerTime.split(':').map(Number);
                    if (!isNaN(prayerHours) && !isNaN(prayerMinutes)) {
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨ (10 Ø«ÙˆØ§Ù†ÙŠ Ù‚Ø¨Ù„)
                        if (prayerHours === currentHours && prayerMinutes === currentMinutes && currentSeconds >= 50) {
                            console.log(`ğŸ”” â³ â³ â³ Ø§Ù‚ØªØ±Ø§Ø¨ Ø´Ø¯ÙŠØ¯! ØµÙ„Ø§Ø© ${prayerNames[p]}: Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ ${currentTimeFull} - ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© ${normalizedPrayerTime} - Ù…ØªØ¨Ù‚Ù‰ ${60 - currentSeconds} Ø«Ø§Ù†ÙŠØ© â³ â³ â³`);
                        } else if (prayerHours === currentHours && prayerMinutes === currentMinutes + 1 && currentSeconds >= 50) {
                            console.log(`ğŸ”” â³ Ø§Ù‚ØªØ±Ø§Ø¨! ØµÙ„Ø§Ø© ${prayerNames[p]}: Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ ${currentTimeFull} - ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© ${normalizedPrayerTime} - Ù…ØªØ¨Ù‚Ù‰ Ø£Ù‚Ù„ Ù…Ù† Ø¯Ù‚ÙŠÙ‚Ø©`);
                        }
                    }
                }
                
                return matches;
            });
            
            // Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ ØªØ·Ø§Ø¨Ù‚
            if (prayerName) {
                console.log(`ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙ„Ø§Ø© Ù…ØªØ·Ø§Ø¨Ù‚Ø©: ${prayerNames[prayerName]} ÙÙŠ ${currentTimeFull}`);
            }
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ø°Ø§Ù† ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
            // Ù†Ø³ØªØ®Ø¯Ù… triggerKey Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
            const triggerKey = `${prayerName}-${currentTime}`;
            
            // Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ ØªØ·Ø§Ø¨Ù‚
            if (prayerName) {
                console.log(`ğŸ” ğŸ” ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙ„Ø§Ø© Ù…ØªØ·Ø§Ø¨Ù‚Ø©: ${prayerNames[prayerName]} ÙÙŠ ${currentTimeFull} ğŸ” ğŸ” ğŸ”`);
                console.log(`ğŸ”‘ triggerKey: ${triggerKey}`);
                console.log(`ğŸ”‘ lastTriggeredTime: ${lastTriggeredTime}`);
                console.log(`ğŸ”‘ Ù‡Ù„ triggerKey !== lastTriggeredTime? ${triggerKey !== lastTriggeredTime}`);
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡Ø§ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
            if (prayerName && triggerKey !== lastTriggeredTime) {
                console.log(`â° â° â° â° â° ÙˆÙ‚Øª ØµÙ„Ø§Ø© ${prayerNames[prayerName]} â° â° â° â° â°`);
                console.log(`ğŸ“Š Ø§Ù„ØªÙØ§ØµÙŠÙ„:`, {
                    prayerName: prayerName,
                    currentTime: currentTimeFull,
                    prayerTime: prayerTimes[prayerName],
                    currentPhase: state.currentPhase,
                    isAdhanPlaying: state.isAdhanPlaying,
                    currentSeconds: currentSeconds,
                    triggerKey: triggerKey,
                    lastTriggeredTime: lastTriggeredTime
                });
                
                // ØªØ­Ø¯ÙŠØ« lastTriggeredTime ÙÙˆØ±Ø§Ù‹ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
                lastTriggeredTime = triggerKey;
                lastTriggeredPrayer = prayerName;
                
                console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†...');
                
                // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ triggerAdhan Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª
                // triggerAdhan Ø³ØªØ­Ø§ÙˆÙ„ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹
                console.log('ğŸ¯ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ triggerAdhan Ù…Ø¨Ø§Ø´Ø±Ø©...');
                triggerAdhan(prayerName);
            } else if (prayerName && triggerKey === lastTriggeredTime) {
                // ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
                if (currentSeconds === 0 || currentSeconds === 1) {
                    console.log(`â„¹ï¸ Ø§Ù„Ø£Ø°Ø§Ù† ØªÙ… ØªØ´ØºÙŠÙ„Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„ØµÙ„Ø§Ø© ${prayerNames[prayerName]}`);
                }
            }
        }
        
        function triggerAdhan(prayerName) {
            console.log(`ğŸš€ğŸš€ğŸš€ triggerAdhan() - ØµÙ„Ø§Ø©: ${prayerName} ğŸš€ğŸš€ğŸš€`);
            
            if (!prayerName) {
                console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø³Ù… ØµÙ„Ø§Ø©!');
                return;
            }
            
            state.activePrayer = prayerName;
            state.currentPhase = 'adhan';
            
            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©:', {
                activePrayer: state.activePrayer,
                currentPhase: state.currentPhase
            });
            
            // Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø£Ø°Ø§Ù† ÙÙˆØ±Ø§Ù‹ ÙÙŠ Ø£ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©
            console.log('ğŸ–¼ï¸ Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø°Ø§Ù†...');
            renderAdhan();
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø°Ø§Ù†
            let adhanFile = '';
            if (prayerName === 'fajr') {
                adhanFile = state.settings.fajrAdhanSound || 'audio/audio_fajr.mp3';
            } else {
                adhanFile = state.settings.adhanSound || 'audio/audio_dhar.mp3';
            }
            
            console.log(`ğŸµ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù†: ${adhanFile}`, {
                hasFajrSound: !!state.settings.fajrAdhanSound,
                hasRegularSound: !!state.settings.adhanSound,
                isFajr: prayerName === 'fajr'
            });
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù†ØµØ± Ø§Ù„ØµÙˆØª
            const audioRef = document.getElementById('audioRef');
            if (!audioRef) {
                console.error('âŒ audioRef ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                // Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ audioRefØŒ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø¨Ø¹Ø¯ Ù…Ø¯Ø© Ø§Ù„Ø£Ø°Ø§Ù†
                const adhanDuration = (state.settings.adhanDurationMinutes * 60 + state.settings.adhanDurationSeconds) * 1000;
                setTimeout(() => {
                    console.log('â° Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø£Ø°Ø§Ù† (Ø¨Ø¯ÙˆÙ† ØµÙˆØª) - Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©');
                    startIqamaCountdown();
                }, adhanDuration);
                return;
            }
            
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ startAdhan Ù…Ø¨Ø§Ø´Ø±Ø© - Ø³ØªØ­Ø§ÙˆÙ„ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            console.log('ğŸ¯ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ startAdhan Ù…Ø¨Ø§Ø´Ø±Ø©...');
            startAdhan();
        }

        function checkIqamaCountdown() {
            if (state.currentPhase === 'iqamaCountdown' && state.iqamaEndTime) {
                if (new Date() >= state.iqamaEndTime) {
                    state.iqamaEndTime = null;
                    startPhoneImage();
                }
            }
        }

        // ==================== ADHAN LOGIC ====================
        function startAdhan() {
            console.log('ğŸ”ŠğŸ”ŠğŸ”Š Ø¨Ø¯Ø¡ Ø¯Ø§Ù„Ø© startAdhan() ğŸ”ŠğŸ”ŠğŸ”Š');
            console.log('ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø°Ø§Ù†:', {
                isAdhanPlaying: state.isAdhanPlaying,
                activePrayer: state.activePrayer,
                currentPhase: state.currentPhase,
                isMuted: state.settings.isMuted,
                volume: state.settings.volume,
                audioUnlocked: state.audioUnlocked
            });
            
            if (state.isAdhanPlaying) {
                console.log('âš ï¸ Ø§Ù„Ø£Ø°Ø§Ù† Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ - Ø¥ÙŠÙ‚Ø§Ù');
                return;
            }
            
            if (!state.activePrayer) {
                console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙ„Ø§Ø© Ù†Ø´Ø·Ø© - Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†');
                return;
            }
            
            state.isAdhanPlaying = true;
            console.log('âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† isAdhanPlaying = true');
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø£Ø°Ø§Ù† (ØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ triggerAdhanØŒ Ù„ÙƒÙ† Ù†Ø¹ÙŠØ¯ Ø§Ù„ØªØ£ÙƒØ¯)
            if (state.currentPhase === 'adhan') {
                console.log('ğŸ–¼ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø°Ø§Ù†...');
                renderAdhan();
            }
            
            const prayerName = state.activePrayer;
            let adhanFile = '';
            if (prayerName === 'fajr') {
                adhanFile = state.settings.fajrAdhanSound || 'audio/audio_fajr.mp3';
            } else {
                adhanFile = state.settings.adhanSound || 'audio/audio_dhar.mp3';
            }
            
            console.log('ğŸµ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø°Ø§Ù†:', {
                prayerName: prayerName,
                adhanFile: adhanFile ? adhanFile.substring(0, 100) + '...' : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù',
                hasFajrSound: !!state.settings.fajrAdhanSound,
                hasRegularSound: !!state.settings.adhanSound,
                fileLength: adhanFile ? adhanFile.length : 0,
                isDataURL: adhanFile ? adhanFile.startsWith('data:') : false,
                fajrSoundLength: state.settings.fajrAdhanSound ? state.settings.fajrAdhanSound.length : 0,
                regularSoundLength: state.settings.adhanSound ? state.settings.adhanSound.length : 0
            });
            
            const adhanDuration = (state.settings.adhanDurationMinutes * 60 + state.settings.adhanDurationSeconds) * 1000;
            console.log(`â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø£Ø°Ø§Ù†: ${state.settings.adhanDurationMinutes} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${state.settings.adhanDurationSeconds} Ø«Ø§Ù†ÙŠØ© = ${adhanDuration}ms`);
            
            const audioRef = document.getElementById('audioRef');
            console.log('ğŸ”Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª audio element:', {
                audioRefExists: !!audioRef,
                audioUnlocked: state.audioUnlocked,
                isMuted: state.settings.isMuted,
                volume: state.settings.volume
            });
            
            if (!audioRef) {
                console.error('âŒ audioRef ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                setTimeout(() => startIqamaCountdown(), adhanDuration);
                return;
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„ØµÙˆØª Ù…Ø¹Ø·Ù„Ø§Ù‹ (Ù„ÙƒÙ† Ø³Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø©)
            if (adhanFile) {
                console.log('ğŸµ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†...', {
                    isMuted: state.settings.isMuted,
                    hasFile: !!adhanFile,
                    filePath: adhanFile.substring(0, 100),
                    audioUnlocked: state.audioUnlocked
                });
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ù‚Ø¨Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„
                // Ù†Ø¨Ø¯Ø£ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ù…Ø¨Ø§Ø´Ø±Ø© - Ø§Ù„ØµÙˆØª Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
                console.log('ğŸµ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ù…Ø¨Ø§Ø´Ø±Ø©...');
                playAdhanAudio();
            } else {
                console.log('ğŸ”‡ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ø£Ø°Ø§Ù† - Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù…Ø¯Ø© Ø§Ù„Ø£Ø°Ø§Ù† Ø«Ù… Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©');
                setTimeout(() => {
                    console.log('â° Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø£Ø°Ø§Ù† (Ø¨Ø¯ÙˆÙ† Ù…Ù„Ù) - Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©');
                    startIqamaCountdown();
                }, adhanDuration);
            }
            
            // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
            function playAdhanAudio() {
                console.log('ğŸµ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù†...');
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                audioRef.onended = null;
                audioRef.onerror = null;
                audioRef.onloadstart = null;
                
                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØµØ¯Ø± ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                console.log('ğŸ“ ØªØ¹ÙŠÙŠÙ† Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù†:', {
                    adhanFileType: typeof adhanFile,
                    adhanFileLength: adhanFile ? adhanFile.length : 0,
                    isDataURL: adhanFile ? adhanFile.startsWith('data:') : false,
                    preview: adhanFile ? adhanFile.substring(0, 50) + '...' : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù'
                });
                
                audioRef.src = adhanFile;
                audioRef.currentTime = 0;
                audioRef.volume = state.settings.volume;
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…Ø¹Ø·Ù‘Ù„
                audioRef.muted = false; // Ù†Ø¶Ø¨Ø·Ù‡ Ø¹Ù„Ù‰ false Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ´ØºÙŠÙ„
                
                console.log('ğŸ”Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:', {
                    volume: audioRef.volume,
                    muted: audioRef.muted,
                    src: audioRef.src ? (audioRef.src.length > 100 ? audioRef.src.substring(0, 100) + '...' : audioRef.src) : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯',
                    srcLength: audioRef.src ? audioRef.src.length : 0,
                    audioUnlocked: state.audioUnlocked,
                    isMuted: state.settings.isMuted
                });
                
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ø¦Ù„ ØªÙˆØ¶ÙŠØ­ÙŠØ©
                console.log(`ğŸµ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù†: ${adhanFile}`);
                console.log(`ğŸ”Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª: Ø­Ø¬Ù…=${audioRef.volume}, ÙƒØªÙ…=${audioRef.muted}`);
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹
                const loadPromise = audioRef.load();
                if (loadPromise) {
                    loadPromise.catch(e => {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù†:', e);
                    });
                }
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                audioRef.onended = () => {
                    console.log('ğŸµ âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø£Ø°Ø§Ù† Ø§Ù„ØµÙˆØªÙŠ - Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø¥Ù‚Ø§Ù…Ø©');
                    state.isAdhanPlaying = false;
                    startIqamaCountdown();
                };
                
                audioRef.onerror = (e) => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†:', e);
                    console.error('âŒ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', {
                        error: audioRef.error,
                        errorCode: audioRef.error ? audioRef.error.code : null,
                        errorMessage: audioRef.error ? audioRef.error.message : null,
                        src: audioRef.src
                    });
                    state.isAdhanPlaying = false;
                    setTimeout(() => startIqamaCountdown(), adhanDuration);
                };
                
                audioRef.onloadstart = () => {
                    console.log('ğŸ“¥ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù†...');
                };
                
                audioRef.oncanplay = () => {
                    console.log('âœ… Ù…Ù„Ù Ø§Ù„Ø£Ø°Ø§Ù† Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„');
                };
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
                const playPromise = audioRef.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('âœ… âœ… âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­! âœ… âœ… âœ…');
                        console.log('ğŸµ Ø§Ù„Ø£Ø°Ø§Ù† ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†:', {
                            currentTime: audioRef.currentTime,
                            duration: audioRef.duration,
                            volume: audioRef.volume,
                            muted: audioRef.muted
                        });
                    }).catch((e) => {
                        console.error('âŒ ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†:', e);
                        console.error('âŒ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', {
                            name: e.name,
                            message: e.message,
                            stack: e.stack
                        });
                        state.isAdhanPlaying = false;
                        console.log(`â³ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù…Ø¯Ø© ${adhanDuration / 1000} Ø«Ø§Ù†ÙŠØ© Ø«Ù… Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©`);
                        setTimeout(() => startIqamaCountdown(), adhanDuration);
                    });
                } else {
                    console.warn('âš ï¸ play() Ù„Ù… ÙŠÙØ±Ø¬Ø¹ promise');
                    state.isAdhanPlaying = false;
                    setTimeout(() => startIqamaCountdown(), adhanDuration);
                }
            }
        }

        function startIqamaCountdown() {
            state.isAdhanPlaying = false;
            const prayerName = state.activePrayer;
            const duration = state.settings.iqamaCountdown[prayerName] || 0;
            
            if (duration <= 0) {
                startPhoneImage();
                return;
            }
            
            state.currentPhase = 'iqamaCountdown';
            state.iqamaEndTime = new Date(Date.now() + duration * 60 * 1000);
            renderIqamaCountdown();
        }

        function startPhoneImage() {
            state.currentPhase = 'phoneImage';
            renderPhoneImage();
            
            const phoneImageDuration = (state.settings.phoneImageDurationMinutes * 60 + state.settings.phoneImageDurationSeconds) * 1000;

            console.log(`â° Ø¨Ø¯Ø¡ Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù…Ø¯Ø©: ${state.settings.phoneImageDurationMinutes} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${state.settings.phoneImageDurationSeconds} Ø«Ø§Ù†ÙŠØ©`);

            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ Ù…Ø¤Ù‚Øª Ø³Ø§Ø¨Ù‚
            if (state.phoneImageTimer) {
                clearTimeout(state.phoneImageTimer);
            }
            
            if (phoneImageDuration > 0) {
                // Ø­ÙØ¸ Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ù„ØºØ§Ø¤Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§
                state.phoneImageTimer = setTimeout(() => {
                    console.log('â° Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ù‡Ø§ØªÙ - Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø°ÙƒØ§Ø±');
                    startAzkar();
                }, phoneImageDuration);
            } else {
                console.log('â° Ù…Ø¯Ø© Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ù‡Ø§ØªÙ ØµÙØ±ÙŠØ© - Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„ÙÙˆØ±ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø°ÙƒØ§Ø±');
                startAzkar();
            }
        }

        function startAzkar() {
            state.currentPhase = 'azkar';
            state.currentAzkarIndex = 0;
            renderAzkar();
            
            const azkarDuration = (state.settings.azkarDurationMinutes * 60 + state.settings.azkarDurationSeconds) * 1000;
            const displayInterval = azkarDuration > 0 ? azkarDuration / azkarAfterPrayer.length : 15000;
            
            if (state.azkarIntervalRef) {
                clearInterval(state.azkarIntervalRef);
            }
            
            state.azkarIntervalRef = setInterval(() => {
                state.currentAzkarIndex++;
                if (state.currentAzkarIndex >= azkarAfterPrayer.length) {
                    clearInterval(state.azkarIntervalRef);
                    setTimeout(() => resetToIdle(), 2000);
                } else {
                    renderAzkar();
                }
            }, displayInterval);
        }

        function resetToIdle() {
            state.currentPhase = 'idle';
            state.activePrayer = null;
            state.iqamaEndTime = null;
            state.currentAzkarIndex = 0;
            state.isAdhanPlaying = false;
            
            if (state.phaseTimeoutRef) {
                clearTimeout(state.phaseTimeoutRef);
                state.phaseTimeoutRef = null;
            }
            if (state.azkarIntervalRef) {
                clearInterval(state.azkarIntervalRef);
                state.azkarIntervalRef = null;
            }
            
            renderMainScreen();
        }

        function skipToNextPhase() {
            if (state.currentPhase === 'adhan') {
                if (state.activePrayer) startIqamaCountdown();
            } else if (state.currentPhase === 'iqamaCountdown') {
                state.iqamaEndTime = null;
                startPhoneImage();
            } else if (state.currentPhase === 'phoneImage') {
                startAzkar();
            } else if (state.currentPhase === 'azkar') {
                resetToIdle();
            }
        }

        // ==================== RENDERING FUNCTIONS ====================
        function renderAdhan() {
            const hasImage = state.settings.adhanImage && state.settings.adhanImage.length > 0;
            const positionClass = state.settings.adhanTextPosition === 'top' ? 'justify-start' : 
                                 state.settings.adhanTextPosition === 'bottom' ? 'justify-end' : 'justify-center';
            const activePrayerName = state.activePrayer ? prayerNames[state.activePrayer] : '';
            
            const container = document.getElementById('app-container');
            container.innerHTML = `
                <div class="min-h-screen relative flex flex-col" style="background-color: ${hasImage ? 'transparent' : '#101828'}; background-image: ${hasImage ? `url(${state.settings.adhanImage})` : 'none'}; background-size: cover; background-position: center; background-repeat: no-repeat;">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <button onclick="skipToNextPhase()" class="absolute top-6 right-6 z-50 bg-red-600/80 hover:bg-red-700 text-white text-5xl font-bold rounded-full w-16 h-16 flex items-center justify-center shadow-2xl transition-all hover:scale-110" title="Ø§Ø¶ØºØ· Ù„Ù„Ø®Ø±ÙˆØ¬">Ã—</button>
                    <div class="relative z-10 flex flex-col items-center text-center gap-10 px-6 py-12 flex-1 ${positionClass}">
                        <div class="max-w-4xl w-full mx-auto flex flex-col items-center gap-10">
                            <span class="text-6xl md:text-7xl font-bold text-white drop-shadow-[0_0_20px_rgba(255,255,255,0.9)]">Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</span>
                            <h2 class="text-5xl md:text-6xl font-bold text-white drop-shadow-[0_0_20px_rgba(255,255,255,0.9)]">Ø­Ø§Ù† Ø§Ù„Ø¢Ù† ÙˆÙ‚Øª Ø£Ø°Ø§Ù† ${activePrayerName || '...'}</h2>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIqamaCountdown() {
            const hasBackgroundImage = state.settings.iqamaBackgroundImage && state.settings.iqamaBackgroundImage.length > 0;
            const countdown = calculateIqamaCountdown();
            const activePrayerName = state.activePrayer ? prayerNames[state.activePrayer] : '';
            
            const container = document.getElementById('app-container');
            container.innerHTML = `
                <div class="min-h-screen text-white flex flex-col justify-center items-center font-sans relative" style="background-color: ${hasBackgroundImage ? 'transparent' : state.settings.iqamaBackgroundColor}; background-image: ${hasBackgroundImage ? `url(${state.settings.iqamaBackgroundImage})` : 'none'}; background-size: cover; background-position: center; background-repeat: no-repeat;">
                    <button onclick="skipToNextPhase()" class="absolute top-6 right-6 z-50 bg-red-600/80 hover:bg-red-700 text-white text-5xl font-bold rounded-full w-16 h-16 flex items-center justify-center shadow-2xl transition-all hover:scale-110" title="Ø§Ø¶ØºØ· Ù„Ù„Ø®Ø±ÙˆØ¬">Ã—</button>
                    <div class="flex-grow flex flex-col justify-center items-center text-center p-8">
                        <h2 class="text-6xl sm:text-7xl md:text-8xl font-bold mb-8" style="color: ${state.settings.colors.iqamaCountdownTextColor}">Ø¥Ù‚Ø§Ù…Ø© ØµÙ„Ø§Ø© ${activePrayerName}</h2>
                        <div id="iqama-countdown-display" class="font-mono text-[12vw] sm:text-[15vw] font-bold tracking-widest" style="text-shadow: 0 0 25px #fff; color: ${state.settings.colors.iqamaCountdownTextColor}">${countdown || '00:00'}</div>
                    </div>
                </div>
            `;
        }

        function renderPhoneImage() {
            const hasBackgroundImage = state.settings.phoneImage && state.settings.phoneImage.length > 0;
            const container = document.getElementById('app-container');
            container.innerHTML = `
                <div class="min-h-screen flex items-center justify-center relative" style="background-color: ${hasBackgroundImage ? 'transparent' : '#000000'}; background-image: ${hasBackgroundImage ? `url(${state.settings.phoneImage})` : 'none'}; background-size: contain; background-position: center; background-repeat: no-repeat;">
                    <button onclick="skipToNextPhase()" class="absolute top-6 right-6 z-50 bg-red-600/80 hover:bg-red-700 text-white text-5xl font-bold rounded-full w-16 h-16 flex items-center justify-center shadow-2xl transition-all hover:scale-110" title="Ø§Ø¶ØºØ· Ù„Ù„Ø®Ø±ÙˆØ¬">Ã—</button>
                    ${!hasBackgroundImage ? 
                        `<div class="text-white text-6xl font-bold text-center p-8">
                            <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‡Ø§ØªÙ</p>
                            <p class="text-4xl mt-8">ğŸ“µ</p>
                        </div>` : ''
                    }
                </div>
            `;
        }

        function renderAzkar() {
            const currentAzkar = azkarAfterPrayer[state.currentAzkarIndex % azkarAfterPrayer.length];
            const hasBackgroundImage = state.settings.azkarBackgroundImage && state.settings.azkarBackgroundImage.length > 0;
            
            const container = document.getElementById('app-container');
            container.innerHTML = `
                <div class="min-h-screen text-white flex items-center justify-center p-8 relative bg-cover bg-center" style="background-image: ${hasBackgroundImage ? `url(${state.settings.azkarBackgroundImage})` : 'none'}; background-color: ${hasBackgroundImage ? 'transparent' : '#1e40af'};">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <button onclick="skipToNextPhase()" class="absolute top-6 right-6 z-50 bg-red-600/80 hover:bg-red-700 text-white text-5xl font-bold rounded-full w-16 h-16 flex items-center justify-center shadow-2xl transition-all hover:scale-110" title="Ø§Ø¶ØºØ· Ù„Ù„Ø®Ø±ÙˆØ¬">Ã—</button>
                    <div class="max-w-4xl text-center z-10">
                        <h2 class="text-5xl font-bold mb-12" style="color: ${state.settings.colors.azkarTextColor}">Ø£Ø°ÙƒØ§Ø± Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©</h2>
                        <p class="text-5xl leading-relaxed whitespace-pre-line font-semibold" style="color: ${state.settings.colors.azkarTextColor}">${currentAzkar}</p>
                        <div class="mt-12 text-xl opacity-70" style="color: ${state.settings.colors.azkarTextColor}">(${state.currentAzkarIndex + 1} / ${azkarAfterPrayer.length})</div>
                    </div>
                </div>
            `;
        }

        function calculateIqamaCountdown() {
            if (!state.iqamaEndTime) return null;
            const diff = state.iqamaEndTime.getTime() - state.currentTime.getTime();
            if (diff <= 0) return '00:00';
            const minutes = Math.floor(diff / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function calculateNextPrayer() {
            const toMinutes = (s) => {
                if (!s || !s.includes(':')) return null;
                const [hStr, mStr] = s.split(':');
                const h = parseInt(hStr, 10);
                const m = parseInt(mStr, 10);
                if (Number.isNaN(h) || Number.isNaN(m)) return null;
                return h * 60 + m;
            };

            const currentMinutes = state.currentTime.getHours() * 60 + state.currentTime.getMinutes();
            const currentSeconds = state.currentTime.getSeconds();
            
            const schedule = PRAYER_ORDER
                .map(name => ({ name, min: toMinutes(state.settings.prayerTimes[name]) }))
                .filter(p => p.min != null);

            let next = schedule.find(p => p.min > currentMinutes);

            if (!next) {
                const fajrMin = toMinutes(state.settings.prayerTimes.fajr);
                if (fajrMin == null) {
                    return { nextPrayerName: '...', countdown: '--:--:--' };
                }
                
                const diffSec = ((fajrMin + 1440) * 60) - (currentMinutes * 60 + currentSeconds);
                const hours = Math.floor(diffSec / 3600);
                const minutes = Math.floor((diffSec % 3600) / 60);
                const seconds = diffSec % 60;
                
                return {
                    nextPrayerName: prayerNames.fajr,
                    countdown: `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`,
                };
            }

            const diffSec = (next.min * 60) - (currentMinutes * 60 + currentSeconds);
            const hours = Math.floor(diffSec / 3600);
            const minutes = Math.floor((diffSec % 3600) / 60);
            const seconds = diffSec % 60;

            return {
                nextPrayerName: prayerNames[next.name],
                countdown: `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`,
            };
        }

        function renderMainScreen() {
            const { nextPrayerName, countdown } = calculateNextPrayer();
            const nowTz = state.currentTime;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø­Ø¯ÙŠØ«Ø©
            let lastUpdateInfo = '';
            if (state.lastSuccessfulUpdate) {
                const timeSinceUpdate = Math.floor((new Date() - state.lastSuccessfulUpdate) / (1000 * 60)); // Ø¯Ù‚Ø§Ø¦Ù‚
                
                if (timeSinceUpdate > 60) { // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø° Ø£ÙƒØ«Ø± Ù…Ù† Ø³Ø§Ø¹Ø©
                    const hours = Math.floor(timeSinceUpdate / 60);
                    lastUpdateInfo = `<div class="text-xs text-amber-300 bg-amber-900/30 px-2 py-1 rounded-md border border-amber-700/50">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø° ${hours} Ø³Ø§Ø¹Ø©</div>`;
                } else {
                    lastUpdateInfo = `<div class="text-xs text-green-300 bg-green-900/30 px-2 py-1 rounded-md border border-green-700/50">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø° ${timeSinceUpdate} Ø¯Ù‚ÙŠÙ‚Ø©</div>`;
                }
            } else if (state.isOffline) {
                lastUpdateInfo = `<div class="text-xs text-red-300 bg-red-900/30 px-2 py-1 rounded-md border border-red-700/50">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ØªØµØ§Ù„</div>`;
            }
            
            const hour = String(nowTz.getHours()).padStart(2, '0');
            const minute = String(nowTz.getMinutes()).padStart(2, '0');
            const second = String(nowTz.getSeconds()).padStart(2, '0');
            const dayPeriod = state.settings.timeFormat === '12h' ? 
                (nowTz.getHours() >= 12 ? 'PM' : 'AM') : null;
            const hour12 = state.settings.timeFormat === '12h' ? 
                (nowTz.getHours() % 12 || 12) : nowTz.getHours();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø®Ù„ÙÙŠØ©
            const hasBackground = state.settings.backgroundImage && state.settings.backgroundImage.length > 0;
            const backgroundStyle = hasBackground ? 
                `background-image: url(${state.settings.backgroundImage}); background-size: cover; background-position: center; background-repeat: no-repeat;` : 
                'background-color: #263138;';
            
            console.log('ğŸ¨ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:', {
                hasBackgroundImage: hasBackground,
                backgroundImageLength: state.settings.backgroundImage ? state.settings.backgroundImage.length : 0,
                backgroundImagePreview: state.settings.backgroundImage ? state.settings.backgroundImage.substring(0, 50) + '...' : 'none'
            });
            
            const container = document.getElementById('app-container');
            container.innerHTML = `
                <div class="bg-cover bg-center min-h-screen flex flex-col p-4 sm:p-6 lg:p-8 font-sans transition-all duration-1000 relative" style="${backgroundStyle} color: ${state.settings.colors.textColor};">
                    <div class="absolute inset-0 bg-black/60 -z-10"></div>
                    <header class="flex justify-between items-start">
                        <div class="flex items-center gap-4 text-2xl">
                            ${state.settings.showWeather ? `
                                <div class="flex items-center gap-2">
                                    <span>${state.settings.temperature}Â°</span>
                                    <svg class="text-yellow-400" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                                </div>
                            ` : ''}
                            ${state.isOffline ? `
                                <div class="flex items-center gap-2 bg-red-900/30 px-2 py-1 rounded-md border border-red-700/50">
                                    <svg class="text-red-400" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" title="ØºÙŠØ± Ù…ØªØµÙ„"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"></path><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"></path><line x1="1.42" y1="1.42" x2="23" y2="23"></line><path d="M23 12.55a11.93 11.93 0 0 1-2.33 3.5"></path><path d="M2 2l20 20"></path></svg>
                                    <span class="text-red-300 text-sm">ØºÙŠØ± Ù…ØªØµÙ„</span>
                                </div>
                            ` : `
                                <div class="flex items-center gap-2 bg-green-900/30 px-2 py-1 rounded-md border border-green-700/50">
                                    <svg class="text-green-400" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" title="Ù…ØªØµÙ„"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                                    <span class="text-green-300 text-sm">Ù…ØªØµÙ„</span>
                                </div>
                            `}
                            ${lastUpdateInfo}
                        </div>
                        <h1 class="text-4xl md:text-5xl font-bold text-center flex-grow">${state.settings.mosqueName}</h1>
                        <div class="flex items-center gap-2">
                            <button onclick="updatePrayerTimes()" class="bg-transparent hover:bg-accent p-2 rounded-md" aria-label="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª" title="ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©">
                                <svg class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                            </button>
                            <button onclick="openSettings()" class="bg-transparent hover:bg-accent p-2 rounded-md" aria-label="Open settings">
                                <svg class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path></svg>
                            </button>
                        </div>
                    </header>

                    <main class="flex-grow flex flex-col justify-center items-center text-center my-4">
                        <div class="flex justify-around items-center w-full max-w-5xl">
                            <div class="flex flex-col justify-center rounded-2xl p-4 text-center shadow-lg border border-blue-600/50" style="width: 235px; height: 135px; background-color: ${state.settings.colors.shuruqBoxColor};">
                                <h3 class="text-2xl font-bold">Ø§Ù„Ø´Ø±ÙˆÙ‚</h3>
                                <p class="text-3xl font-mono font-bold">${formatPrayerTime(state.settings.shuruqTime, state.settings.timeFormat, nowTz)}</p>
                            </div>

                            <div class="rounded-2xl p-4 md:p-6 shadow-2xl border border-blue-500/50 w-[90%] max-w-2xl mx-4" style="background-color: ${state.settings.colors.clockBoxColor};">
                                <div class="flex justify-center items-baseline">
                                    <span class="text-8xl md:text-9xl font-bold tracking-tighter" style="text-shadow: 0 0 15px #fff;">${hour12}:${minute}</span>
                                    <div class="flex flex-col items-start ml-2 md:ml-4">
                                        <span class="text-3xl md:text-5xl font-bold" style="text-shadow: 0 0 10px #fff;">${second}</span>
                                        ${dayPeriod ? `<span class="text-2xl md:text-4xl font-bold" style="text-shadow: 0 0 8px #fff;">${dayPeriod}</span>` : ''}
                                    </div>
                                </div>
                                <div class="mt-2 text-lg md:text-xl space-y-1">
                                    <p>${formatHijriDate(nowTz)}</p>
                                    <p>${formatGregorianDate(nowTz)}</p>
                                </div>
                            </div>

                            <div class="flex flex-col justify-center rounded-2xl p-4 text-center shadow-lg border border-blue-600/50" style="width: 235px; height: 135px; background-color: ${state.settings.colors.jumuahBoxColor};">
                                <h3 class="text-2xl font-bold">Ø§Ù„Ø¬Ù…Ø¹Ø©</h3>
                                <p class="text-3xl font-mono font-bold">${formatPrayerTime(state.settings.jumuahTime, state.settings.timeFormat, nowTz)}</p>
                            </div>
                        </div>

                        <div class="mt-8 text-3xl font-semibold flex flex-col items-center gap-2">
                            ${state.isFetchingTimes ? `
                                <div class="flex items-center gap-3">
                                    <svg class="animate-spin h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>
                                    <span>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©...</span>
                                </div>
                            ` : `
                                <div class="flex items-center gap-3" style="color: ${state.settings.colors.nextPrayerTextColor};">
                                    <svg class="text-yellow-400" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                                    <span>Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span>
                                    <svg class="text-yellow-400" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                                </div>
                                <span class="text-5xl font-bold" style="color: ${state.settings.colors.nextPrayerTextColor};">${nextPrayerName}</span>
                                <span class="font-mono text-4xl" style="color: ${state.settings.colors.nextPrayerTextColor};">ØªØ¨Ù‚Ù‰ ${countdown}</span>
                            `}
                        </div>
                    </main>
                    
                    <footer class="w-full max-w-7xl mx-auto mt-auto">
                        <div class="grid grid-cols-5 gap-3 md:gap-6 justify-items-center max-w-7xl mx-auto">
                            ${PRAYER_ORDER.map((key) => {
                                const isNext = prayerNames[key] === nextPrayerName && !state.isFetchingTimes;
                                return `
                                    <div class="rounded-2xl p-3 text-center shadow-lg border border-blue-600/50 transition-all flex flex-col justify-center ${isNext ? 'border-yellow-400 border-2 scale-105' : ''}" style="width: 200px; height: 110px; background-color: ${state.settings.colors.prayerBoxesColor};">
                                        <h3 class="text-2xl font-bold">${prayerNames[key]}</h3>
                                        <p class="text-3xl font-mono font-bold">${formatPrayerTime(state.settings.prayerTimes[key], state.settings.timeFormat, nowTz)}</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </footer>
                </div>
            `;

            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ø¹Ø±Ø¶ Ù†Ø§Ø¬Ø­
            const splash = document.getElementById('app-splash');
            if (splash && splash.style.display !== 'none') {
                splash.style.opacity = '0';
                setTimeout(() => {
                    splash.style.display = 'none';
                }, 500);
            }
        }

        function updateUI() {
            if (state.currentPhase === 'idle') {
                renderMainScreen();
                // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                startPrayerMonitoring();
            } else if (state.currentPhase === 'iqamaCountdown') {
                // Update countdown every second
                const countdown = calculateIqamaCountdown();
                const countdownEl = document.getElementById('iqama-countdown-display');
                if (countdownEl) {
                    countdownEl.textContent = countdown || '00:00';
                }
            } else if (state.currentPhase === 'azkar') {
                // Azkar doesn't need frequent updates
            }
        }

        // ==================== SETTINGS PANEL ====================
        function openSettings() {
            state.isPanelOpen = true;
            document.getElementById('settings-overlay').classList.add('open');
            document.getElementById('settings-panel').classList.add('open');
            renderSettingsPanel();
        }

        function closeSettings() {
            state.isPanelOpen = false;
            document.getElementById('settings-overlay').classList.remove('open');
            document.getElementById('settings-panel').classList.remove('open');
        }

        function renderSettingsPanel() {
            const content = document.getElementById('settings-content');
            const localSettings = JSON.parse(JSON.stringify(state.settings));
            
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- PWA Install Button -->
                    <div id="install-button-container" class="${deferredPrompt ? '' : 'hidden'} border-b pb-4">
                        <button id="install-pwa-btn" class="w-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg flex items-center justify-center gap-2 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²
                        </button>
                    </div>

                    <!-- Manual Install Guide -->
                    <div class="border-b pb-4">
                        <h3 class="text-sm font-semibold mb-2 text-accent cursor-pointer" onclick="toggleAccordion('install-guide')">ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ TV BOX Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ (ÙŠØ¯ÙˆÙŠØ§Ù‹) â–¼</h3>
                        <div id="accordion-install-guide" class="accordion-content text-xs space-y-2 text-muted-foreground">
                            <p>1. Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ù…ØªØµÙØ­ Chrome.</p>
                            <p>2. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø«Ù„Ø§Ø« (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©) ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ©.</p>
                            <p>3. Ø§Ø®ØªØ± <b>"Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"</b> Ø£Ùˆ <b>"ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"</b>.</p>
                            <p>4. Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙˆÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„.</p>
                            <div id="file-protocol-warning" class="hidden p-2 bg-red-900/30 border border-red-500 rounded text-red-200 mt-2">
                                âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø£Ù†Øª ØªÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒÙ…Ù„Ù Ù…Ø­Ù„ÙŠ. Ø§Ù„ØªØ«Ø¨ÙŠØª ÙŠØªØ·Ù„Ø¨ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¨Ø± Ø¥Ù†ØªØ±Ù†Øª (Firebase) Ø£Ùˆ Ø®Ø§Ø¯Ù… Ù…Ø­Ù„ÙŠ.
                            </div>
                        </div>
                    </div>

                    <!-- General Settings -->
                    <div class="border-b pb-4">
                        <h3 class="text-lg font-semibold mb-4 cursor-pointer" onclick="toggleAccordion('general')">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø© â–¼</h3>
                        <div id="accordion-general" class="accordion-content open">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¬Ø¯</label>
                                    <input type="text" id="mosque-name" value="${localSettings.mosqueName}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
                                    <select id="country" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="updateCities()">
                                        ${countries.map(c => `<option value="${c}" ${c === localSettings.country ? 'selected' : ''}>${c}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                                    <div class="flex gap-2">
                                        <select id="city" class="flex-1 px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="updatePrayerTimesOnLocationChange()">
                                            ${(citiesByCountry[localSettings.country] || []).map(c => `<option value="${c}" ${c === localSettings.city ? 'selected' : ''}>${c}</option>`).join('')}
                                        </select>
                                        <button onclick="fetchPrayerTimes(true)" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90" id="refresh-btn">
                                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø§Ù„Ø­ÙŠ</label>
                                    <input type="text" id="neighborhood" value="${localSettings.neighborhood || ''}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" placeholder="Ù…Ø«Ø§Ù„: Ø­ÙŠ Ù…Ø¹ØµÙˆÙ… Ø£Ùˆ Ø¬Ø¨Ù„ Ø§Ù„Ù†Ø²Ù‡Ø©" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø§Ù„Ø´Ø§Ø±Ø¹</label>
                                    <input type="text" id="street" value="${localSettings.street || ''}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§Ø±Ø¹ Ø§Ù„ÙƒÙˆÙŠØªÙŠØ© Ø£Ùˆ Ø´Ø§Ø±Ø¹ Ø¨Ø³Ù…Ø§Ù†" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª (ØµÙŠÙÙŠ/Ø´ØªÙˆÙŠ)</label>
                                    <select id="dst-adjustment" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground">
                                        <option value="1" ${localSettings.dstAdjustment === 1 ? 'selected' : ''}>ØªÙ„Ù‚Ø§Ø¦ÙŠ (ØªØºÙŠÙŠØ± ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„ØªØ§Ø±ÙŠØ®)</option>
                                        <option value="0" ${localSettings.dstAdjustment === 0 ? 'selected' : ''}>Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„</option>
                                        <option value="60" ${localSettings.dstAdjustment === 60 ? 'selected' : ''}>ØªÙˆÙ‚ÙŠØª ØµÙŠÙÙŠ (+1 Ø³Ø§Ø¹Ø©)</option>
                                        <option value="-60" ${localSettings.dstAdjustment === -60 ? 'selected' : ''}>ØªÙˆÙ‚ÙŠØª Ø´ØªÙˆÙŠ (-1 Ø³Ø§Ø¹Ø©)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Iqama Countdown -->
                    <div class="border-b pb-4">
                        <h3 class="text-lg font-semibold mb-4 cursor-pointer" onclick="toggleAccordion('iqama')">Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© â–¼</h3>
                        <div id="accordion-iqama" class="accordion-content">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ© Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</label>
                                    <input type="file" id="iqama-background-image" accept="image/*" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="handleFileChange('iqamaBackgroundImage', this)" />
                                </div>
                                ${PRAYER_ORDER.map(prayer => `
                                    <div>
                                        <label class="block text-sm font-medium mb-2">${prayerNames[prayer]} (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                        <input type="number" id="iqama-${prayer}" value="${localSettings.iqamaCountdown[prayer]}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Prayer Times -->
                    <div class="border-b pb-4">
                        <h3 class="text-lg font-semibold mb-4 cursor-pointer" onclick="toggleAccordion('prayer-times')">Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© (ÙŠØ¯ÙˆÙŠ) â–¼</h3>
                        <div id="accordion-prayer-times" class="accordion-content">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø§Ù„Ø´Ø±ÙˆÙ‚</label>
                                    <input type="time" id="shuruq-time" value="${localSettings.shuruqTime}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                    <label class="block text-sm font-medium mb-2 mt-2">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙˆÙ‚ (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                    <input type="number" id="shuruq-offset" value="${localSettings.shuruqOffset || 0}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø§Ù„Ø¬Ù…Ø¹Ø©</label>
                                    <input type="time" id="jumuah-time" value="${localSettings.jumuahTime}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                    <label class="block text-sm font-medium mb-2 mt-2">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù…Ø¹Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                    <input type="number" id="jumuah-offset" value="${localSettings.jumuahOffset || 0}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                </div>
                                ${PRAYER_ORDER.map(prayer => `
                                    <div>
                                        <label class="block text-sm font-medium mb-2">${prayerNames[prayer]}</label>
                                        <div class="flex items-center gap-2 mb-2">
                                            <input type="time" id="prayer-${prayer}" value="${localSettings.prayerTimes[prayer]}" class="flex-1 px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="savePrayerOffset('${prayer}')" />
                                            <button onclick="adjustPrayerTime('${prayer}', -1)" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-md">-</button>
                                            <button onclick="adjustPrayerTime('${prayer}', 1)" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-md">+</button>
                                        </div>
                                        <label class="block text-sm font-medium mb-2 mt-2">ØªØ¹Ø¯ÙŠÙ„ ${prayerNames[prayer]} (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                        <div class="flex items-center gap-2">
                                            <input type="number" id="prayer-offset-${prayer}" value="${(localSettings.prayerTimeOffsets && localSettings.prayerTimeOffsets[prayer]) || 0}" class="flex-1 px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="savePrayerOffset('${prayer}')" />
                                            <button onclick="savePrayerOffset('${prayer}')" class="bg-primary text-primary-foreground px-3 py-2 rounded-md hover:bg-primary/90">Ø­ÙØ¸</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Display Settings -->
                    <div class="border-b pb-4">
                        <h3 class="text-lg font-semibold mb-4 cursor-pointer" onclick="toggleAccordion('display')">Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ù…Ø¸Ù‡Ø± â–¼</h3>
                        <div id="accordion-display" class="accordion-content">
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <label class="text-sm font-medium">Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ†Ø³ÙŠÙ‚ 24 Ø³Ø§Ø¹Ø©</label>
                                    <input type="checkbox" id="time-format" ${localSettings.timeFormat === '24h' ? 'checked' : ''} class="w-4 h-4" />
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-sm font-medium">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø·Ù‚Ø³</label>
                                    <input type="checkbox" id="show-weather" ${localSettings.showWeather ? 'checked' : ''} class="w-4 h-4" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Ù…Ø¦ÙˆÙŠØ©)</label>
                                    <input type="number" id="temperature" value="${localSettings.temperature}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" disabled />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ø¯Ø© Ø§Ù„ØªØ¹ØªÙŠÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø°Ø§Ù† (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                                    <input type="number" id="dim-duration" value="${localSettings.dimDuration}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                                    <input type="file" id="background-image" accept="image/*" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="handleFileChange('backgroundImage', this)" />
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Colors -->
                    <div class="border-b pb-4">
                        <h3 class="text-lg font-semibold mb-4 cursor-pointer" onclick="toggleAccordion('colors')">ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ù„ÙˆØ§Ù† â–¼</h3>
                        <div id="accordion-colors" class="accordion-content">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù„ÙˆÙ† Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø§Ù…</label>
                                    <input type="color" id="text-color" value="${localSettings.colors.textColor}" class="w-full h-10 p-1 border border-border rounded-md" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù„ÙˆÙ† Ù†Øµ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</label>
                                    <input type="color" id="next-prayer-text-color" value="${localSettings.colors.nextPrayerTextColor}" class="w-full h-10 p-1 border border-border rounded-md" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù„ÙˆÙ† Ù†Øµ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø¥Ù‚Ø§Ù…Ø©</label>
                                    <input type="color" id="iqama-countdown-text-color" value="${localSettings.colors.iqamaCountdownTextColor}" class="w-full h-10 p-1 border border-border rounded-md" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù„ÙˆÙ† Ù†Øµ Ø§Ù„Ø£Ø°ÙƒØ§Ø±</label>
                                    <input type="color" id="azkar-text-color" value="${localSettings.colors.azkarTextColor}" class="w-full h-10 p-1 border border-border rounded-md" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø´Ø±ÙˆÙ‚</label>
                                    <input type="color" id="shuruq-box-color" value="${localSettings.colors.shuruqBoxColor}" class="w-full h-10 p-1 border border-border rounded-md" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø³Ø§Ø¹Ø©</label>
                                    <input type="color" id="clock-box-color" value="${localSettings.colors.clockBoxColor}" class="w-full h-10 p-1 border border-border rounded-md" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¬Ù…Ø¹Ø©</label>
                                    <input type="color" id="jumuah-box-color" value="${localSettings.colors.jumuahBoxColor}" class="w-full h-10 p-1 border border-border rounded-md" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</label>
                                    <input type="color" id="prayer-boxes-color" value="${localSettings.colors.prayerBoxesColor}" class="w-full h-10 p-1 border border-border rounded-md" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Audio Settings -->
                    <div class="border-b pb-4">
                        <h3 class="text-lg font-semibold mb-4 cursor-pointer" onclick="toggleAccordion('audio')">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª â–¼</h3>
                        <div id="accordion-audio" class="accordion-content">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ù„Ù ØµÙˆØª Ø£Ø°Ø§Ù† Ø§Ù„ØµÙ„ÙˆØ§Øª (Ø§Ù„Ø¸Ù‡Ø±ØŒ Ø§Ù„Ø¹ØµØ±ØŒ Ø§Ù„Ù…ØºØ±Ø¨ØŒ Ø§Ù„Ø¹Ø´Ø§Ø¡)</label>
                                    <input type="file" id="adhan-sound" accept="audio/*" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="handleFileChange('adhanSound', this)" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ù„Ù ØµÙˆØª Ø£Ø°Ø§Ù† Ø§Ù„ÙØ¬Ø± (Ù…Ù†ÙØµÙ„)</label>
                                    <input type="file" id="fajr-adhan-sound" accept="audio/*" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="handleFileChange('fajrAdhanSound', this)" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª</label>
                                    <div class="flex items-center gap-2">
                                        <button onclick="toggleMute()" class="p-2 bg-input border border-border rounded-md hover:bg-accent">
                                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="mute-icon">
                                                ${localSettings.isMuted ? '<line x1="1" y1="1" x2="23" y2="23"></line><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"></path><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line>' : '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>'}
                                            </svg>
                                        </button>
                                        <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="${localSettings.isMuted ? 0 : localSettings.volume}" class="flex-1" oninput="updateVolume(this.value)" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Prayer Phases -->
                    <div class="border-b pb-4">
                        <h3 class="text-lg font-semibold mb-4 cursor-pointer" onclick="toggleAccordion('phases')">Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØµÙ„Ø§Ø© â–¼</h3>
                        <div id="accordion-phases" class="accordion-content open">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ø¯Ø© Ø§Ù„Ø£Ø°Ø§Ù† - Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</label>
                                    <input type="number" id="adhan-duration-minutes" value="${localSettings.adhanDurationMinutes}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ø¯Ø© Ø§Ù„Ø£Ø°Ø§Ù† - Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ</label>
                                    <input type="number" id="adhan-duration-seconds" value="${localSettings.adhanDurationSeconds}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ØµÙˆØ±Ø© Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø°Ø§Ù†</label>
                                    <input type="file" id="adhan-image" accept="image/*" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="handleFileChange('adhanImage', this)" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…ÙˆØ¶Ø¹ Ù†Øµ Ø§Ù„Ø£Ø°Ø§Ù†</label>
                                    <select id="adhan-text-position" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground">
                                        <option value="top" ${localSettings.adhanTextPosition === 'top' ? 'selected' : ''}>Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©</option>
                                        <option value="center" ${localSettings.adhanTextPosition === 'center' ? 'selected' : ''}>ÙˆØ³Ø· Ø§Ù„Ø´Ø§Ø´Ø©</option>
                                        <option value="bottom" ${localSettings.adhanTextPosition === 'bottom' ? 'selected' : ''}>Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ØµÙˆØ±Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‡Ø§ØªÙ</label>
                                    <input type="file" id="phone-image" accept="image/*" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="handleFileChange('phoneImage', this)" />
                                    ${localSettings.phoneImage ? `
                                        <div class="mt-3 p-3 bg-secondary rounded-md">
                                            <img src="${localSettings.phoneImage}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‡Ø§ØªÙ" class="w-full max-h-36 object-contain rounded mb-2" />
                                            <button type="button" onclick="clearPhoneImage()" class="w-full bg-destructive text-destructive-foreground px-3 py-2 rounded-md text-sm hover:opacity-90">Ù…Ø³Ø­ Ø§Ù„ØµÙˆØ±Ø©</button>
                                        </div>
                                    ` : ''}
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ø¯Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‡Ø§ØªÙ - Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</label>
                                    <input type="number" id="phone-image-duration-minutes" value="${localSettings.phoneImageDurationMinutes}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" min="0" />
                                    <p class="text-xs text-muted-foreground mt-1">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ØªÙŠ Ø³ØªÙØ¹Ø±Ø¶ ÙÙŠÙ‡Ø§ ØµÙˆØ±Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ø¯Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‡Ø§ØªÙ - Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ</label>
                                    <input type="number" id="phone-image-duration-seconds" value="${localSettings.phoneImageDurationSeconds}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" min="0" max="59" />
                                    <p class="text-xs text-muted-foreground mt-1">Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ© Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø°ÙƒØ§Ø±</label>
                                    <input type="file" id="azkar-background-image" accept="image/*" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="handleFileChange('azkarBackgroundImage', this)" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø°ÙƒØ§Ø± - Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</label>
                                    <input type="number" id="azkar-duration-minutes" value="${localSettings.azkarDurationMinutes}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ù…Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø°ÙƒØ§Ø± - Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ</label>
                                    <input type="number" id="azkar-duration-seconds" value="${localSettings.azkarDurationSeconds}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Remote Control -->
                    <div class="border-b pb-4">
                        <h3 class="text-lg font-semibold mb-4 cursor-pointer" onclick="toggleAccordion('remote-control')">Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù† Ø¨Ø¹Ø¯ â–¼</h3>
                        <div id="accordion-remote-control" class="accordion-content">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø§Ø´Ø©</label>
                                    <div class="flex gap-2 mb-2">
                                        <button onclick="selectCurrentScreen()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
                                        <button onclick="showAllScreens()" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª</button>
                                    </div>
                                    <select id="screen-select" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="loadScreenSettings()">
                                        <option value="current">Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</option>
                                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª</option>
                                        <option value="by-country">Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø©</option>
                                    </select>
                                </div>
                                <div id="screen-settings">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…Ø§Ù† (Ù„Ù„Ù…Ø´Ø±Ù)</label>
                                        <input type="password" id="remote-security-key" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…Ø§Ù†" />
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
                                            <select id="remote-country" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="updateRemoteCities()">
                                                ${countries.map(c => `<option value="${c}" ${c === localSettings.country ? 'selected' : ''}>${c}</option>`).join('')}
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                                            <select id="remote-city" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground">
                                                ${(citiesByCountry[localSettings.country] || []).map(c => `<option value="${c}" ${c === localSettings.city ? 'selected' : ''}>${c}</option>`).join('')}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Ø§Ù„Ø­ÙŠ</label>
                                            <input type="text" id="remote-neighborhood" value="${localSettings.neighborhood || ''}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" placeholder="Ù…Ø«Ø§Ù„: Ø­ÙŠ Ù…Ø¹ØµÙˆÙ…" />
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Ø§Ù„Ø´Ø§Ø±Ø¹</label>
                                            <input type="text" id="remote-street" value="${localSettings.street || ''}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§Ø±Ø¹ Ø§Ù„ÙƒÙˆÙŠØªÙŠØ©" />
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¬Ø¯</label>
                                        <input type="text" id="remote-mosque-name" value="${localSettings.mosqueName || ''}" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§</label>
                                        <select id="remote-service-type" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground">
                                            <option value="all">ØªØ­Ø¯ÙŠØ« Ø´Ø§Ù…Ù„ (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª)</option>
                                            <option value="mosque_info">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ø¯ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹</option>
                                            <option value="prayer_times">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø¥Ù‚Ø§Ù…Ø©</option>
                                            <option value="display_settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø®Ù„ÙÙŠØ§Øª</option>
                                            <option value="audio_settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ø¢Ø°Ø§Ù†</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« (ØªØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©)</label>
                                        <input type="text" id="remote-message" value="ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­" class="w-full px-3 py-2 bg-input border border-border rounded-md text-foreground" />
                                    </div>
                                    <div class="pt-2">
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" id="remote-update-all" class="w-4 h-4 rounded border-gray-600 bg-gray-700">
                                            <span class="text-sm text-gray-300">ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø­ÙŠ</span>
                                        </label>
                                    </div>
                                    <div>
                                        <button onclick="applyRemoteSettings()" class="w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 mt-2">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ­ÙØ¸Ù‡Ø§</button>
                                    </div>
                                </div>
                                <div id="screens-list" class="hidden">
                                    <div class="mt-4 p-3 bg-gray-800 rounded-lg">
                                        <!-- Ù‚Ø³Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© -->
                                        <div id="city-selection" class="mb-4">
                                            <h4 class="text-md font-semibold mb-2">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</h4>
                                            <div class="flex gap-2 mb-2">
                                                <select id="city-country-select" class="flex-1 px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="updateCityList()">
                                                    ${countries.map(c => `<option value="${c}">${c}</option>`).join('')}
                                                </select>
                                                <select id="city-select" class="flex-1 px-3 py-2 bg-input border border-border rounded-md text-foreground" onchange="loadMosquesInCity()">
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                                                </select>
                                            </div>
                                            <button onclick="loadAllMosquesInCity()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¬Ø¯ ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</button>
                                        </div>
                                        
                                        <!-- Ù‚Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³Ø§Ø¬Ø¯ ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© -->
                                        <div id="city-mosques-list">
                                            <h4 class="text-md font-semibold mb-2">Ù…Ø³Ø§Ø¬Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h4>
                                            <div id="city-mosques-container" class="space-y-2 max-h-40 overflow-y-auto">
                                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                                            </div>
                                        </div>
                                        
                                        <!-- Ù‚Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© -->
                                        <div>
                                            <h4 class="text-md font-semibold mb-2">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h4>
                                            <div id="screens-container" class="space-y-2 max-h-40 overflow-y-auto">
                                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleAccordion(id) {
            const content = document.getElementById(`accordion-${id}`);
            content.classList.toggle('open');
        }

        function updateCities() {
            const country = document.getElementById('country').value;
            const citySelect = document.getElementById('city');
            const cities = citiesByCountry[country] || [];
            citySelect.innerHTML = cities.map(c => `<option value="${c}">${c}</option>`).join('');
            if (cities.length > 0) {
                citySelect.value = cities[0];
            }
        }

        function handleFileChange(settingKey, input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    if (event.target && event.target.result) {
                        state.settings[settingKey] = event.target.result;
                        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ${settingKey}`, {
                            fileSize: file.size,
                            fileType: file.type,
                            dataLength: event.target.result.length
                        });
                        // Ø­ÙØ¸ ÙÙˆØ±ÙŠ ÙÙŠ localStorage Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø©
                        try {
                            const savedMedia = localStorage.getItem('alMoazinMediaFiles');
                            let mediaFiles = savedMedia ? JSON.parse(savedMedia) : {};
                            mediaFiles[settingKey] = event.target.result;
                            localStorage.setItem('alMoazinMediaFiles', JSON.stringify(mediaFiles));
                            console.log(`ğŸ’¾ ØªÙ… Ø­ÙØ¸ ${settingKey} ÙÙˆØ±Ø§Ù‹ ÙÙŠ localStorage`);
                        } catch (e) {
                            console.warn(`âš ï¸ ÙØ´Ù„ Ø­ÙØ¸ ${settingKey} ÙÙˆØ±Ø§Ù‹:`, e);
                        }
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function toggleMute() {
            state.settings.isMuted = !state.settings.isMuted;
            const audioRef = document.getElementById('audioRef');
            if (audioRef) {
                audioRef.muted = state.settings.isMuted;
            }
            renderSettingsPanel();
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù† ÙÙŠ Ù‚Ø³Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù† Ø¨Ø¹Ø¯
        function updateRemoteCities() {
            const country = document.getElementById('remote-country').value;
            const citySelect = document.getElementById('remote-city');
            const cities = citiesByCountry[country] || [];
            
            // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø¯ÙŠÙ†Ø© Ù‚Ø¨Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            const currentCity = citySelect.value;
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù†
            citySelect.innerHTML = cities.map(c => `<option value="${c}">${c}</option>`).join('');
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ø¯Ù†ØŒ Ø¬Ø±Ø¨ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            if (cities.length > 0) {
                if (cities.includes(currentCity)) {
                    citySelect.value = currentCity;
                } else {
                    citySelect.value = cities[0];
                }
            } else {
                citySelect.value = '';
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        function loadScreenSettings() {
            const screenSelect = document.getElementById('screen-select');
            const screenSettings = document.getElementById('screen-settings');
            const screensList = document.getElementById('screens-list');
            
            if (screenSelect.value === 'current') {
                // Ø¹Ø±Ø¶ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                screenSettings.classList.remove('hidden');
                screensList.classList.add('hidden');
                
                // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                const countryEl = document.getElementById('remote-country');
                const cityEl = document.getElementById('remote-city');
                
                if (countryEl) {
                    countryEl.value = state.settings.country;
                    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    updateRemoteCities();
                }
                if (cityEl) cityEl.value = state.settings.city;
            } else if (screenSelect.value === 'all' || screenSelect.value === 'by-country') {
                // Ø¹Ø±Ø¶ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                screenSettings.classList.remove('hidden');
                screensList.classList.add('hidden');
                
                // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø§Øª
                const countryEl = document.getElementById('remote-country');
                const cityEl = document.getElementById('remote-city');
                
                if (countryEl) {
                    countryEl.value = state.settings.country;
                    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    updateRemoteCities();
                }
                if (cityEl) cityEl.value = state.settings.city;
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function selectCurrentScreen() {
            const screenSelect = document.getElementById('screen-select');
            screenSelect.value = 'current';
            loadScreenSettings();
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª
        function showAllScreens() {
            const screenSelect = document.getElementById('screen-select');
            screenSelect.value = 'all';
            loadScreenSettings();
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
        function loadScreensList() {
            const screensContainer = document.getElementById('screens-container');
            
            // Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            let screens = JSON.parse(localStorage.getItem('alMoazinScreensList') || '[]');
            
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¦Ù…Ø©ØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            if (screens.length === 0) {
                const screenId = generateScreenId();
                const screenName = state.settings.mosqueName || `Ø´Ø§Ø´Ø© ${new Date().toLocaleDateString()}`;
                
                screens = [{
                    id: screenId,
                    name: screenName,
                    country: state.settings.country,
                    city: state.settings.city,
                    lastUpdated: new Date().toISOString()
                }];
                
                // Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                localStorage.setItem('alMoazinScreensList', JSON.stringify(screens));
            }
            
            // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª
            screensContainer.innerHTML = screens.map(screen => `
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded-md hover:bg-gray-600 cursor-pointer" onclick="selectScreen('${screen.id}')">
                    <div>
                        <div class="font-medium">${screen.name}</div>
                        <div class="text-sm text-gray-400">${screen.country} - ${screen.city}</div>
                    </div>
                    <button onclick="event.stopPropagation(); deleteScreen('${screen.id}')" class="text-red-500 hover:text-red-400">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>
            `).join('');
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø´Ø§Ø´Ø©
        function generateScreenId() {
            return 'screen_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø´Ø§Ø´Ø© Ù…Ø­Ø¯Ø¯Ø©
        function selectScreen(screenId) {
            const screens = JSON.parse(localStorage.getItem('alMoazinScreensList') || '[]');
            const screen = screens.find(s => s.id === screenId);
            
            if (screen) {
                // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                document.getElementById('screen-select').value = 'current';
                document.getElementById('screen-settings').classList.remove('hidden');
                document.getElementById('screens-list').classList.add('hidden');
                
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ù‚ÙŠÙ… Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                document.getElementById('remote-country').value = screen.country;
                document.getElementById('remote-mosque-name').value = screen.name;
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                updateRemoteCities();
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
                const citySelect = document.getElementById('remote-city');
                if (citySelect && screen.city) {
                    citySelect.value = screen.city;
                }
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ø´Ø§Ø´Ø©
        function deleteScreen(screenId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø§Ø´Ø©ØŸ')) {
                let screens = JSON.parse(localStorage.getItem('alMoazinScreensList') || '[]');
                screens = screens.filter(s => s.id !== screenId);
                localStorage.setItem('alMoazinScreensList', JSON.stringify(screens));
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª
                loadScreensList();
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù† Ø¨Ø¹Ø¯
        function applyRemoteSettings() {
            try {
                console.log('ğŸ’¾ Ø¨Ø¯Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù† Ø¨Ø¹Ø¯...');
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ù‚Ø³Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù† Ø¨Ø¹Ø¯
                const countryEl = document.getElementById('remote-country');
                const cityEl = document.getElementById('remote-city');
                const mosqueNameEl = document.getElementById('remote-mosque-name');
                const messageEl = document.getElementById('remote-message');
                const screenSelect = document.getElementById('screen-select');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                if (!countryEl || !screenSelect) {
                    throw new Error('Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©');
                }
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª
                let screens = [];
                try {
                    screens = JSON.parse(localStorage.getItem('alMoazinScreensList') || '[]');
                } catch (e) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª:', e);
                    screens = [];
                }
                let targetScreens = [];
                
                if (screenSelect.value === 'current') {
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·
                    targetScreens = [{
                        id: 'current',
                        name: state.settings.mosqueName || 'Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
                        country: state.settings.country,
                        city: state.settings.city
                    }];
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    if (countryEl) state.settings.country = countryEl.value;
                    if (cityEl) state.settings.city = cityEl.value;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
                    if (messageEl) {
                        showNotification(messageEl.value, 'success');
                        console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©');
                    }
                } else if (screenSelect.value === 'by-country') {
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¯ÙˆÙ„Ø©
                    const selectedCountry = countryEl.value;
                    const selectedCity = cityEl ? cityEl.value : '';
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¯ÙˆÙ„Ø© Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙƒÙ„ Ù…Ø³Ø¬Ø¯
                    screens.forEach(screen => {
                        if (screen.country === selectedCountry) {
                            screen.country = selectedCountry;
                            if (selectedCity) screen.city = selectedCity;
                            screen.lastUpdated = new Date().toISOString();
                            
                            // Ù„Ø§ Ù†Ø­Ø°Ù ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ù„ÙƒÙ„ Ù…Ø³Ø¬Ø¯
                            if (!screen.prayerTimeOffsets) {
                                screen.prayerTimeOffsets = {};
                            }
                        }
                    });
                    
                    // Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
                    localStorage.setItem('alMoazinScreensList', JSON.stringify(screens));
                    
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª ÙÙŠ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    targetScreens = screens.filter(screen => screen.country === selectedCountry);
                    
                    if (targetScreens.length === 0) {
                        // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø´Ø§Ø´Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆÙ„Ø©ØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø§Ø´Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                        targetScreens = [{
                            id: generateScreenId(),
                            name: `Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¬Ø¯ ÙÙŠ ${selectedCountry}`,
                            country: selectedCountry,
                            city: selectedCity || (citiesByCountry[selectedCountry] ? citiesByCountry[selectedCountry][0] : ''),
                            lastUpdated: new Date().toISOString(),
                            prayerTimeOffsets: {}
                        }];
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        screens.push(targetScreens[0]);
                        localStorage.setItem('alMoazinScreensList', JSON.stringify(screens));
                    }
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­
                    if (messageEl) {
                        showNotification(messageEl.value, 'success');
                        console.log(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¬Ø¯ ÙÙŠ ${selectedCountry}`);
                    }
                } else if (screenSelect.value === 'all') {
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
                    targetScreens = screens;
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­
                    if (messageEl) {
                        showNotification(messageEl.value, 'success');
                        console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª');
                    }
                } else {
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø© Ù…Ø­Ø¯Ø¯Ø©
                    const selectedScreenId = screenSelect.value;
                    const selectedScreen = screens.find(s => s.id === selectedScreenId);
                    
                    if (selectedScreen) {
                        targetScreens = [selectedScreen];
                        
                        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                        selectedScreen.country = countryEl.value;
                        if (cityEl) selectedScreen.city = cityEl.value;
                        selectedScreen.lastUpdated = new Date().toISOString();
                        
                        // ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø¬Ø¯
                        if (!selectedScreen.prayerTimeOffsets) {
                            selectedScreen.prayerTimeOffsets = {};
                        }
                        
                        // Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
                        localStorage.setItem('alMoazinScreensList', JSON.stringify(screens));
                        
                        // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­
                        if (messageEl) {
                            showNotification(messageEl.value, 'success');
                            console.log(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø¬Ø¯: ${selectedScreen.name}`);
                        }
                    }
                }
                
                console.log(`ğŸ¯ Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ ${targetScreens.length} Ø´Ø§Ø´Ø©(Ø§Øª)`);
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©
                targetScreens.forEach((screen, index) => {
                    console.log(`ğŸ“± ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©: ${screen.name}`);
                    
                    // ÙØµÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¹Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    const mediaFiles = {
                        backgroundImage: state.settings.backgroundImage || '',
                        iqamaBackgroundImage: state.settings.iqamaBackgroundImage || '',
                        azkarBackgroundImage: state.settings.azkarBackgroundImage || '',
                        phoneImage: state.settings.phoneImage || '',
                        adhanImage: state.settings.adhanImage || '',
                        adhanSound: state.settings.adhanSound || '',
                        fajrAdhanSound: state.settings.fajrAdhanSound || ''
                    };
                    
                    // ÙØµÙ„ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    const prayerTimesData = {
                        prayerTimes: state.settings.prayerTimes,
                        prayerTimeOffsets: state.settings.prayerTimeOffsets,
                        shuruqTime: state.settings.shuruqTime,
                        shuruqOffset: state.settings.shuruqOffset,
                        jumuahTime: state.settings.jumuahTime,
                        jumuahOffset: state.settings.jumuahOffset,
                        lastUpdated: new Date().toISOString()
                    };
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø¯ÙˆÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆÙ…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©
                    const essentialSettings = {
                        mosqueName: screen.id === 'current' ? state.settings.mosqueName : screen.name,
                        timeFormat: state.settings.timeFormat,
                        iqamaCountdown: state.settings.iqamaCountdown,
                        dimDuration: state.settings.dimDuration,
                        adhanDurationMinutes: state.settings.adhanDurationMinutes,
                        adhanDurationSeconds: state.settings.adhanDurationSeconds,
                        phoneImageDurationMinutes: state.settings.phoneImageDurationMinutes,
                        phoneImageDurationSeconds: state.settings.phoneImageDurationSeconds,
                        azkarDurationMinutes: state.settings.azkarDurationMinutes,
                        azkarDurationSeconds: state.settings.azkarDurationSeconds,
                        country: screen.id === 'current' ? state.settings.country : screen.country,
                        city: screen.id === 'current' ? state.settings.city : screen.city,
                        showWeather: state.settings.showWeather,
                        temperature: state.settings.temperature,
                        volume: state.settings.volume,
                        isMuted: state.settings.isMuted,
                        adhanTextPosition: state.settings.adhanTextPosition,
                        iqamaBackgroundColor: state.settings.iqamaBackgroundColor,
                        colors: state.settings.colors,
                        lastSaved: new Date().toISOString()
                    };
                    
                    try {
                        // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                        localStorage.setItem('alMoazinClockSettings', JSON.stringify(essentialSettings));
                        console.log(`âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠ localStorage Ù„Ù„Ø´Ø§Ø´Ø©: ${screen.name}`);
                    } catch (e) {
                        console.error(`âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø´Ø§Ø´Ø© ${screen.name}:`, e);
                    }
                    
                    try {
                        // Ø­ÙØ¸ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
                        localStorage.setItem('alMoazinPrayerTimesData', JSON.stringify(prayerTimesData));
                        console.log(`âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙÙŠ localStorage Ù„Ù„Ø´Ø§Ø´Ø©: ${screen.name}`);
                    } catch (e) {
                        console.error(`âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„Ø´Ø§Ø´Ø© ${screen.name}:`, e);
                    }
                    
                    try {
                        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ±
                        localStorage.setItem('alMoazinMediaFiles', JSON.stringify(mediaFiles));
                        console.log(`âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ± ÙÙŠ localStorage Ù„Ù„Ø´Ø§Ø´Ø©: ${screen.name}`);
                    } catch (e) {
                        console.error(`âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ø´Ø§Ø´Ø© ${screen.name}:`, e);
                    }
                });
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                if (messageEl && messageEl.value) {
                    showNotificationToUsers(messageEl.value);
                }
                
                console.log(`âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ ${targetScreens.length} Ø´Ø§Ø´Ø©(Ø§Øª) Ø¨Ù†Ø¬Ø§Ø­`);
                
                // Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª ÙÙŠ localStorage
                try {
                    localStorage.setItem('alMoazinScreensList', JSON.stringify(screens));
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª');
                } catch (e) {
                    console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª:', e);
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                if (targetScreens.some(s => s.id === 'current')) {
                    // Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    closeSettings();
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    renderMainScreen();
                    
                    // Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ø°Ø§ ØªØºÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹
                    if (countryEl && cityEl && 
                        (state.settings.country !== countryEl.value || state.settings.city !== cityEl.value)) {
                        console.log('ğŸ“ ØªØºÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ - Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø¬Ø¯ÙŠØ¯Ø©');
                        fetchPrayerTimesAndWeather(true);
                    }
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù† Ø¨Ø¹Ø¯:', error);
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const errorMessage = error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
                showNotification(errorMessage, 'error');
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­Ø°ÙŠØ±ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…
                console.warn('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', error);
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function showNotification(message, type = 'success') {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
            notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-opacity duration-500 opacity-0`;
            notification.textContent = message;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
            document.body.appendChild(notification);
            
            // Ø¬Ø¹Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙŠØ¸Ù‡Ø± ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹
            setTimeout(() => {
                notification.style.opacity = '1';
            }, 10);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 500);
            }, 5000);
        }

        // Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø± Ù„Ù„Ø¯Ø§Ù„Ø© Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        function showNotificationToUsers(message) {
            showNotification(message, 'success');
        }

        function updateVolume(value) {
            state.settings.volume = parseFloat(value);
            state.settings.isMuted = value == 0;
            const audioRef = document.getElementById('audioRef');
            if (audioRef) {
                audioRef.volume = state.settings.volume;
                audioRef.muted = state.settings.isMuted;
            }
            const muteIcon = document.getElementById('mute-icon');
            if (muteIcon) {
                muteIcon.innerHTML = state.settings.isMuted ? 
                    '<line x1="1" y1="1" x2="23" y2="23"></line><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"></path><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line>' :
                    '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>';
            }
        }

        function clearPhoneImage() {
            state.settings.phoneImage = '';
            const phoneImageInput = document.getElementById('phone-image');
            if (phoneImageInput) {
                phoneImageInput.value = '';
            }
            try {
                const savedMedia = localStorage.getItem('alMoazinMediaFiles');
                let mediaFiles = savedMedia ? JSON.parse(savedMedia) : {};
                delete mediaFiles.phoneImage;
                localStorage.setItem('alMoazinMediaFiles', JSON.stringify(mediaFiles));
            } catch (e) {
                console.warn('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† localStorage:', e);
            }
            renderSettingsPanel();
        }

        function fetchPrayerTimes(force) {
            fetchPrayerTimesAndWeather(force);
        }

        function saveSettings() {
            try {
                console.log('ğŸ’¾ Ø¨Ø¯Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
                
                // General
                const mosqueNameEl = document.getElementById('mosque-name');
                const countryEl = document.getElementById('country');
                const cityEl = document.getElementById('city');
                const neighborhoodEl = document.getElementById('neighborhood');
                const streetEl = document.getElementById('street');
                const dstAdjustmentEl = document.getElementById('dst-adjustment');
                
                if (mosqueNameEl) state.settings.mosqueName = mosqueNameEl.value;
                if (countryEl) state.settings.country = countryEl.value;
                if (cityEl) state.settings.city = cityEl.value;
                if (neighborhoodEl) state.settings.neighborhood = neighborhoodEl.value;
                if (streetEl) state.settings.street = streetEl.value;
                if (dstAdjustmentEl) {
                    const dstValue = parseInt(dstAdjustmentEl.value) || 0;
                    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‚ÙŠÙ…Ø© "1" ÙƒØªØ¹Ø¯ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
                    if (dstValue === 1) {
                        // Ù‚Ù… Ø¨ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©
                        updateDSTBasedOnDate();
                        state.settings.dstAdjustment = dstValue; // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© 1 Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                    } else {
                        state.settings.dstAdjustment = dstValue;
                    }
                }
                
                // Display
                const timeFormatEl = document.getElementById('time-format');
                const showWeatherEl = document.getElementById('show-weather');
                const dimDurationEl = document.getElementById('dim-duration');
                
                if (timeFormatEl) state.settings.timeFormat = timeFormatEl.checked ? '24h' : '12h';
                if (showWeatherEl) state.settings.showWeather = showWeatherEl.checked;
                if (dimDurationEl) state.settings.dimDuration = parseInt(dimDurationEl.value) || 0;
                
                // Prayer Times
                const shuruqTimeEl = document.getElementById('shuruq-time');
                const jumuahTimeEl = document.getElementById('jumuah-time');
                const shuruqOffsetEl = document.getElementById('shuruq-offset');
                const jumuahOffsetEl = document.getElementById('jumuah-offset');
                
                if (!state.settings.manualPrayers) {
                    state.settings.manualPrayers = {};
                }

                if (shuruqTimeEl) {
                    if (state.settings.shuruqTime !== shuruqTimeEl.value) {
                        state.settings.shuruqTime = shuruqTimeEl.value;
                        state.settings.manualPrayers['shuruq'] = true;
                    }
                }
                if (jumuahTimeEl) {
                    if (state.settings.jumuahTime !== jumuahTimeEl.value) {
                        state.settings.jumuahTime = jumuahTimeEl.value;
                        state.settings.manualPrayers['jumuah'] = true;
                    }
                }
                if (shuruqOffsetEl) state.settings.shuruqOffset = parseInt(shuruqOffsetEl.value) || 0;
                if (jumuahOffsetEl) state.settings.jumuahOffset = parseInt(jumuahOffsetEl.value) || 0;
                
                PRAYER_ORDER.forEach(prayer => {
                    const prayerEl = document.getElementById(`prayer-${prayer}`);
                    const iqamaEl = document.getElementById(`iqama-${prayer}`);
                    const offsetEl = document.getElementById(`prayer-offset-${prayer}`);
                    if (prayerEl) {
                        const newTime = prayerEl.value;
                        if (state.settings.prayerTimes[prayer] !== newTime) {
                            state.settings.prayerTimes[prayer] = newTime;
                            state.settings.manualPrayers[prayer] = true;
                            console.log(`ğŸ“ Ø­ÙØ¸ ÙˆÙ‚Øª ØµÙ„Ø§Ø© ${prayerNames[prayer]}: ${newTime} (ÙŠØ¯ÙˆÙŠ)`);
                        }
                    }
                    if (iqamaEl) state.settings.iqamaCountdown[prayer] = parseInt(iqamaEl.value) || 0;
                    if (offsetEl) {
                        const offsetValue = parseInt(offsetEl.value) || 0;
                        state.settings.prayerTimeOffsets[prayer] = offsetValue;
                        console.log(`ğŸ“ Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ‚Øª ØµÙ„Ø§Ø© ${prayerNames[prayer]}: ${offsetValue} Ø¯Ù‚ÙŠÙ‚Ø©`);
                    }
                });
                
                // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ© Ø¹Ù„Ù‰ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©
                savePrayerTimesData();
                
                console.log('ğŸ“‹ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:', state.settings.prayerTimes);
                
                // Colors
                const textColorEl = document.getElementById('text-color');
                const nextPrayerTextColorEl = document.getElementById('next-prayer-text-color');
                const iqamaCountdownTextColorEl = document.getElementById('iqama-countdown-text-color');
                const azkarTextColorEl = document.getElementById('azkar-text-color');
                const shuruqBoxColorEl = document.getElementById('shuruq-box-color');
                const clockBoxColorEl = document.getElementById('clock-box-color');
                const jumuahBoxColorEl = document.getElementById('jumuah-box-color');
                const prayerBoxesColorEl = document.getElementById('prayer-boxes-color');
                
                if (textColorEl) state.settings.colors.textColor = textColorEl.value;
                if (nextPrayerTextColorEl) state.settings.colors.nextPrayerTextColor = nextPrayerTextColorEl.value;
                if (iqamaCountdownTextColorEl) state.settings.colors.iqamaCountdownTextColor = iqamaCountdownTextColorEl.value;
                if (azkarTextColorEl) state.settings.colors.azkarTextColor = azkarTextColorEl.value;
                if (shuruqBoxColorEl) state.settings.colors.shuruqBoxColor = shuruqBoxColorEl.value;
                if (clockBoxColorEl) state.settings.colors.clockBoxColor = clockBoxColorEl.value;
                if (jumuahBoxColorEl) state.settings.colors.jumuahBoxColor = jumuahBoxColorEl.value;
                if (prayerBoxesColorEl) state.settings.colors.prayerBoxesColor = prayerBoxesColorEl.value;
                
                // Audio
                const audioRef = document.getElementById('audioRef');
                if (audioRef) {
                    audioRef.volume = state.settings.volume;
                    audioRef.muted = state.settings.isMuted;
                }
                
                // Phases
                const adhanDurationMinutesEl = document.getElementById('adhan-duration-minutes');
                const adhanDurationSecondsEl = document.getElementById('adhan-duration-seconds');
                const adhanTextPositionEl = document.getElementById('adhan-text-position');
                const phoneImageDurationMinutesEl = document.getElementById('phone-image-duration-minutes');
                const phoneImageDurationSecondsEl = document.getElementById('phone-image-duration-seconds');
                const azkarDurationMinutesEl = document.getElementById('azkar-duration-minutes');
                const azkarDurationSecondsEl = document.getElementById('azkar-duration-seconds');
                
                if (adhanDurationMinutesEl) state.settings.adhanDurationMinutes = parseInt(adhanDurationMinutesEl.value) || 0;
                if (adhanDurationSecondsEl) state.settings.adhanDurationSeconds = parseInt(adhanDurationSecondsEl.value) || 0;
                if (adhanTextPositionEl) state.settings.adhanTextPosition = adhanTextPositionEl.value;
                if (phoneImageDurationMinutesEl) state.settings.phoneImageDurationMinutes = parseInt(phoneImageDurationMinutesEl.value) || 0;
                if (phoneImageDurationSecondsEl) state.settings.phoneImageDurationSeconds = parseInt(phoneImageDurationSecondsEl.value) || 0;
                if (azkarDurationMinutesEl) state.settings.azkarDurationMinutes = parseInt(azkarDurationMinutesEl.value) || 0;
                if (azkarDurationSecondsEl) state.settings.azkarDurationSeconds = parseInt(azkarDurationSecondsEl.value) || 0;
                
                // Save to localStorage - Ø­ÙØ¸ ÙƒØ§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                const oldCountry = state.settings.country;
                const oldCity = state.settings.city;
                
                // ÙØµÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¹Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                const mediaFiles = {
                    backgroundImage: state.settings.backgroundImage || '',
                    iqamaBackgroundImage: state.settings.iqamaBackgroundImage || '',
                    azkarBackgroundImage: state.settings.azkarBackgroundImage || '',
                    phoneImage: state.settings.phoneImage || '',
                    adhanImage: state.settings.adhanImage || '',
                    adhanSound: state.settings.adhanSound || '',
                    fajrAdhanSound: state.settings.fajrAdhanSound || ''
                };
                
                // ÙØµÙ„ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                const prayerTimesData = {
                    prayerTimes: state.settings.prayerTimes,
                    prayerTimeOffsets: state.settings.prayerTimeOffsets,
                    shuruqTime: state.settings.shuruqTime,
                    shuruqOffset: state.settings.shuruqOffset,
                    jumuahTime: state.settings.jumuahTime,
                    jumuahOffset: state.settings.jumuahOffset,
                    lastUpdated: new Date().toISOString()
                };

                // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø¯ÙˆÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆÙ…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©
                const essentialSettings = {
                    mosqueName: state.settings.mosqueName,
                    timeFormat: state.settings.timeFormat,
                    iqamaCountdown: state.settings.iqamaCountdown,
                    prayerTimeOffsets: state.settings.prayerTimeOffsets,
                    shuruqOffset: state.settings.shuruqOffset,
                    jumuahOffset: state.settings.jumuahOffset,
                    dimDuration: state.settings.dimDuration,
                    adhanDurationMinutes: state.settings.adhanDurationMinutes,
                    adhanDurationSeconds: state.settings.adhanDurationSeconds,
                    phoneImageDurationMinutes: state.settings.phoneImageDurationMinutes,
                    phoneImageDurationSeconds: state.settings.phoneImageDurationSeconds,
                    azkarDurationMinutes: state.settings.azkarDurationMinutes,
                    azkarDurationSeconds: state.settings.azkarDurationSeconds,
                    country: state.settings.country,
                    city: state.settings.city,
                    neighborhood: state.settings.neighborhood || '',
                    street: state.settings.street || '',
                    showWeather: state.settings.showWeather,
                    temperature: state.settings.temperature,
                    volume: state.settings.volume,
                    isMuted: state.settings.isMuted,
                    adhanTextPosition: state.settings.adhanTextPosition,
                    iqamaBackgroundColor: state.settings.iqamaBackgroundColor,
                    colors: state.settings.colors,
                    lastSaved: new Date().toISOString()
                };
                
                try {
                    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    localStorage.setItem('alMoazinClockSettings', JSON.stringify(essentialSettings));
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠ localStorage');
                    console.log('ğŸ“‹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:', essentialSettings);
                } catch (e) {
                    console.error('âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:', e);
                    if (e.name === 'QuotaExceededError') {
                        alert('Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø©. ÙŠØ±Ø¬Ù‰ Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø¢Ø®Ø±.');
                    } else {
                        alert('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                    }
                    return;
                }

                try {
                    // Ø­ÙØ¸ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
                    localStorage.setItem('alMoazinPrayerTimesData', JSON.stringify(prayerTimesData));
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙÙŠ localStorage');
                    console.log('ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:', prayerTimesData);
                } catch (e) {
                    console.error('âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©:', e);
                    // Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ø°Ø§ ÙØ´Ù„ Ø­ÙØ¸ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©
                }
                
                try {
                    // Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ± - Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù†Ø­ÙØ¸ Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª ÙØ§Ø±ØºØ©
                    localStorage.setItem('alMoazinMediaFiles', JSON.stringify(mediaFiles));
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ± ÙÙŠ localStorage:', {
                        hasBackgroundImage: !!mediaFiles.backgroundImage,
                        hasPhoneImage: !!mediaFiles.phoneImage,
                        hasAdhanImage: !!mediaFiles.adhanImage,
                        hasIqamaBackgroundImage: !!mediaFiles.iqamaBackgroundImage,
                        hasAzkarBackgroundImage: !!mediaFiles.azkarBackgroundImage,
                        hasAdhanSound: !!mediaFiles.adhanSound,
                        hasFajrAdhanSound: !!mediaFiles.fajrAdhanSound,
                        backgroundImageLength: mediaFiles.backgroundImage ? mediaFiles.backgroundImage.length : 0
                    });
                } catch (e) {
                    console.error('âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª:', e);
                    if (e.name === 'QuotaExceededError') {
                        console.warn('âš ï¸ Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø© - Ù„Ù† ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©');
                        alert('ØªØ­Ø°ÙŠØ±: Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø©. Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ù‚Ø¯ Ù„Ø§ ØªÙØ­ÙØ¸.');
                    }
                    // Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ø°Ø§ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª
                }
                
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©...');
                
                closeSettings();
                renderMainScreen();
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù† Ø¨Ø¹Ø¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØ¹Ù„Ø©
                if (remoteControl) {
                    remoteControl.updateDeviceStatus(state.settings);
                }
                
                // Fetch new prayer times if location changed or apply offsets
                const newCountry = state.settings.country;
                const newCity = state.settings.city;
                if (oldCountry !== newCountry || oldCity !== newCity) {
                    console.log('ğŸ“ ØªØºÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ - Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø¬Ø¯ÙŠØ¯Ø©');
                    fetchPrayerTimesAndWeather(true);
                } else {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙŠØ¯ÙˆÙŠØ© (offsets) Ø¬Ø¯ÙŠØ¯Ø©
                    console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ©');
                    fetchPrayerTimesAndWeather(false);
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
        }

        // ==================== PRAYER TIMES FETCHING ====================
        async function fetchPrayerTimesAndWeather(force = false) {
            if (!state.settings.city || !state.settings.country) return;
            
            state.isFetchingTimes = true;
            state.isOffline = false;
            updateUI();
            
            const d = state.currentTime;
            const today = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
            
            // Check cached data
            const storedTimesData = localStorage.getItem('alMoazinPrayerTimes');
            let useCachedData = false;
            
            if (storedTimesData && !force) {
                try {
                    const parsed = JSON.parse(storedTimesData);
                    const { date, times, shuruq, city, country, fetchTime } = parsed;
                    
                    const isToday = date === today;
                    const isSameLocation = city === state.settings.city && country === state.settings.country;
                    const fetchAge = Date.now() - (fetchTime || 0);
                    const maxAge = 6 * 60 * 60 * 1000;
                    const isDataFresh = fetchAge < maxAge;
                    
                    if (isToday && isSameLocation && isDataFresh && times) {
                        const dst = state.settings.dstAdjustment || 0;
                        const offsets = state.settings.prayerTimeOffsets || { fajr: 0, dhuhr: 0, asr: 0, maghrib: 0, isha: 0 };
                        const adjustedTimes = {
                            fajr: applyOffsetToTime(times.fajr, offsets.fajr + dst),
                            dhuhr: applyOffsetToTime(times.dhuhr, offsets.dhuhr + dst),
                            asr: applyOffsetToTime(times.asr, offsets.asr + dst),
                            maghrib: applyOffsetToTime(times.maghrib, offsets.maghrib + dst),
                            isha: applyOffsetToTime(times.isha, offsets.isha + dst),
                        };
                        const adjustedShuruq = applyOffsetToTime(shuruq, (state.settings.shuruqOffset || 0) + dst);
                        
                        state.settings.prayerTimes = adjustedTimes;
                        state.settings.shuruqTime = adjustedShuruq;
                        state.settings.jumuahTime = applyOffsetToTime(adjustedTimes.dhuhr, state.settings.jumuahOffset || 0);
                        useCachedData = true;
                    }
                } catch (e) {
                    console.error('Error reading cached data:', e);
                }
            }
            
            if (useCachedData && !force) {
                state.isFetchingTimes = false;
                updateUI();
                return;
            }
            
            try {
                const locationMapping = resolveLocationMapping(state.settings.country, state.settings.city);
                const method = (locationMapping.method !== undefined && locationMapping.method !== null) ? locationMapping.method : 23;
                const timezonestring = locationMapping.timeZone;
                const params = new URLSearchParams({
                    city: locationMapping.apiCity || state.settings.city,
                    country: locationMapping.apiCountry || state.settings.country,
                    method: String(method),
                });
                if (timezonestring) params.append('timezonestring', timezonestring);
                
                const d = state.currentTime;
                const dd = String(d.getDate()).padStart(2, '0');
                const mm = String(d.getMonth() + 1).padStart(2, '0');
                const yyyy = d.getFullYear();
                const dateStr = `${dd}-${mm}-${yyyy}`;
                
                const url = `https://api.aladhan.com/v1/timingsByCity/${dateStr}?${params.toString()}`;
                const resp = await fetch(url);
                if (!resp.ok) throw new Error(`Aladhan HTTP ${resp.status}`);
                const data = await resp.json();
                if (data.code !== 200 || !data.data || !data.data.timings) throw new Error('Invalid Aladhan response');
                const t = data.data.timings;
                const normalize = (v) => (v ? String(v).split(' ')[0] : '');
                const basePrayerTimes = {
                    fajr: normalize(t.Fajr),
                    dhuhr: normalize(t.Dhuhr),
                    asr: normalize(t.Asr),
                    maghrib: normalize(t.Maghrib),
                    isha: normalize(t.Isha),
                };
                const baseShuruq = normalize(t.Sunrise);
                // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                let dst = state.settings.dstAdjustment || 0;
                if (dst === 1) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…ÙØ¹Ù„ØŒ Ø§Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    dst = getAutomaticDSTAdjustment(state.settings.country || 'Ø§Ù„Ø£Ø±Ø¯Ù†');
                }
                const offsets = state.settings.prayerTimeOffsets || { fajr: 0, dhuhr: 0, asr: 0, maghrib: 0, isha: 0 };
                const newPrayerTimes = {
                    fajr: applyOffsetToTime(basePrayerTimes.fajr, offsets.fajr + dst),
                    dhuhr: applyOffsetToTime(basePrayerTimes.dhuhr, offsets.dhuhr + dst),
                    asr: applyOffsetToTime(basePrayerTimes.asr, offsets.asr + dst),
                    maghrib: applyOffsetToTime(basePrayerTimes.maghrib, offsets.maghrib + dst),
                    isha: applyOffsetToTime(basePrayerTimes.isha, offsets.isha + dst),
                };
                const newShuruq = applyOffsetToTime(baseShuruq, (state.settings.shuruqOffset || 0) + dst);
                
                state.settings.prayerTimes = newPrayerTimes;
                state.settings.shuruqTime = newShuruq;
                state.settings.jumuahTime = newPrayerTimes.dhuhr;
                
                const prayerData = {
                    date: today,
                    times: basePrayerTimes,
                    shuruq: baseShuruq,
                    adjustedTimes: newPrayerTimes,
                    adjustedShuruq: newShuruq,
                    city: state.settings.city,
                    country: state.settings.country,
                    temperature: state.settings.temperature,
                    method,
                    timezonestring,
                    fetchTime: Date.now(),
                    apiVersion: '1.0'
                };
                
                localStorage.setItem('alMoazinPrayerTimes', JSON.stringify(prayerData));
            } catch (error) {
                state.isOffline = true;
                console.error('Failed to fetch prayer times:', error);
            } finally {
                state.isFetchingTimes = false;
                updateUI();
                // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ«Ù‡Ø§
                startPrayerMonitoring();
            }
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            document.getElementById('update-prayer-times').addEventListener('click', async () => {
                const button = document.getElementById('update-prayer-times');
                const originalText = button.textContent;
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
                button.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«... ';
                button.disabled = true;
                
                try {
                    const success = await updatePrayerTimes();
                    if (success) {
                        button.textContent = 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­! ';
                        button.classList.remove('bg-secondary', 'text-secondary-foreground');
                        button.classList.add('bg-green-600', 'text-white');
                        
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.classList.remove('bg-green-600', 'text-white');
                            button.classList.add('bg-secondary', 'text-secondary-foreground');
                            button.disabled = false;
                        }, 2000);
                    } else {
                        button.textContent = 'ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«! ';
                        button.classList.remove('bg-secondary', 'text-secondary-foreground');
                        button.classList.add('bg-red-600', 'text-white');
                        
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.classList.remove('bg-red-600', 'text-white');
                            button.classList.add('bg-secondary', 'text-secondary-foreground');
                            button.disabled = false;
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Error updating prayer times:', error);
                    button.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£! ';
                    button.classList.remove('bg-secondary', 'text-secondary-foreground');
                    button.classList.add('bg-red-600', 'text-white');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.classList.remove('bg-red-600', 'text-white');
                        button.classList.add('bg-secondary', 'text-secondary-foreground');
                        button.disabled = false;
                    }, 2000);
                }
            });
            document.getElementById('settings-overlay').addEventListener('click', closeSettings);
            
            // Audio unlock - ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£ÙˆÙ„
            const audioRef = document.getElementById('audioRef');
            if (audioRef && !state.audioUnlocked) {
                const unlockAudio = async () => {
                    try {
                        console.log('ğŸ”“ Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª...');
                        audioRef.volume = 0;
                        const playPromise = audioRef.play();
                        if (playPromise) {
                            await playPromise;
                            audioRef.pause();
                            audioRef.currentTime = 0;
                            audioRef.volume = state.settings.volume;
                            state.audioUnlocked = true;
                            console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¨Ù†Ø¬Ø§Ø­');
                        }
                    } catch (e) {
                        console.warn('âš ï¸ ÙØ´Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                    }
                };
                ['click', 'touchstart', 'keydown'].forEach(event => {
                    document.addEventListener(event, unlockAudio, { once: true });
                });
                console.log('ğŸ”“ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª...');
            } else if (audioRef && state.audioUnlocked) {
                console.log('âœ… Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù‘Ù„ Ø¨Ø§Ù„ÙØ¹Ù„');
            }
        }

        // ==================== TEST FUNCTIONS ====================
        function testAdhan(prayerName = 'maghrib') {
            console.log(`ğŸ§ª ğŸ§ª ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø°Ø§Ù† Ù„ØµÙ„Ø§Ø© ${prayerNames[prayerName]} ğŸ§ª ğŸ§ª ğŸ§ª`);
            console.log('ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:', {
                currentPhase: state.currentPhase,
                activePrayer: state.activePrayer,
                isAdhanPlaying: state.isAdhanPlaying
            });
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
            state.currentPhase = 'idle';
            state.activePrayer = null;
            state.isAdhanPlaying = false;
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙØ¹Ù„Ø§Ù‹
            if (!state.audioUnlocked) {
                console.log('ğŸ”“ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª...');
                const audioRef = document.getElementById('audioRef');
                if (audioRef) {
                    try {
                        audioRef.volume = 0;
                        audioRef.play().then(() => {
                            audioRef.pause();
                            audioRef.currentTime = 0;
                            audioRef.volume = state.settings.volume;
                            state.audioUnlocked = true;
                            console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª');
                            // Ø¨Ø¹Ø¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØªØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø£Ø°Ø§Ù†
                            setTimeout(() => {
                                state.activePrayer = prayerName;
                                state.currentPhase = 'adhan';
                                startAdhan();
                            }, 100);
                        }).catch((e) => {
                            console.warn('âš ï¸ ÙØ´Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                            // Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø£Ø°Ø§Ù†
                            state.activePrayer = prayerName;
                            state.currentPhase = 'adhan';
                            startAdhan();
                        });
                    } catch (e) {
                        console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                        state.activePrayer = prayerName;
                        state.currentPhase = 'adhan';
                        startAdhan();
                    }
                } else {
                    console.error('âŒ audioRef ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                    state.activePrayer = prayerName;
                    state.currentPhase = 'adhan';
                    startAdhan();
                }
            } else {
                // Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù‘Ù„ Ø¨Ø§Ù„ÙØ¹Ù„
                state.activePrayer = prayerName;
                state.currentPhase = 'adhan';
                startAdhan();
            }
        }
        
        function showCurrentPrayerTimes() {
            console.log('ğŸ“‹ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:', state.settings.prayerTimes);
            console.log('â° Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ:', new Date().toLocaleTimeString('ar-SA'));
            const now = new Date();
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            console.log('â° Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (HH:MM):', currentTime);
        }

        // ==================== START APP ====================
        window.openSettings = openSettings;
        window.skipToNextPhase = skipToNextPhase;
        window.toggleAccordion = toggleAccordion;
        window.updateCities = updateCities;
        window.handleFileChange = handleFileChange;
        window.clearPhoneImage = clearPhoneImage;
        window.toggleMute = toggleMute;
        window.updateVolume = updateVolume;
        window.fetchPrayerTimes = fetchPrayerTimes;
        window.testAdhan = testAdhan;
        window.showCurrentPrayerTimes = showCurrentPrayerTimes;
        window.adjustPrayerTime = adjustPrayerTime;
        window.savePrayerOffset = savePrayerOffset;
        window.savePrayerTimesData = savePrayerTimesData;
        
        // ==================== PRAYER TIME ADJUSTMENT FUNCTIONS ====================
        // Ø¯Ø§Ù„Ø© Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
        function adjustPrayerTime(prayer, direction) {
            const prayerEl = document.getElementById(`prayer-${prayer}`);
            if (!prayerEl) return;
            
            const currentTime = prayerEl.value.split(':');
            let hours = parseInt(currentTime[0]);
            let minutes = parseInt(currentTime[1]);
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ø£ÙˆÙ„Ø§Ù‹
            minutes += direction;
            
            // Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ 60 Ø£Ùˆ Ø£ØµØ¨Ø­Øª Ø³Ø§Ù„Ø¨Ø©ØŒ Ù‚Ù… Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
            if (minutes >= 60) {
                hours += 1;
                minutes -= 60;
            } else if (minutes < 0) {
                hours -= 1;
                minutes += 60;
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ 0-23
            if (hours >= 24) hours = 0;
            if (hours < 0) hours = 23;
            
            // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ…Ø© Ø­Ù‚Ù„ Ø§Ù„ÙˆÙ‚Øª
            prayerEl.value = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            
            // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙˆØ±Ø§Ù‹
            savePrayerOffset(prayer);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
        function savePrayerOffset(prayer) {
            const prayerEl = document.getElementById(`prayer-${prayer}`);
            const offsetEl = document.getElementById(`prayer-offset-${prayer}`);
            
            if (!prayerEl || !offsetEl) return;
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© manualPrayers
            if (!state.settings.manualPrayers) {
                state.settings.manualPrayers = {};
            }
            
            // Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØªØ­Ø¯ÙŠØ¯Ù‡ ÙƒÙŠØ¯ÙˆÙŠ
            state.settings.prayerTimes[prayer] = prayerEl.value;
            state.settings.manualPrayers[prayer] = true;
            
            // Ø­ÙØ¸ Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const offsetValue = parseInt(offsetEl.value) || 0;
            state.settings.prayerTimeOffsets[prayer] = offsetValue;
            
            console.log(`ğŸ“ Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ‚Øª ØµÙ„Ø§Ø© ${prayerNames[prayer]}: ${prayerEl.value} (ÙŠØ¯ÙˆÙŠ)`);
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹ ÙÙŠ localStorage
            savePrayerTimesData();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
            renderMainScreen();
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©
        function savePrayerTimesData() {
            try {
                const prayerTimesData = {
                    prayerTimes: state.settings.prayerTimes,
                    prayerTimeOffsets: state.settings.prayerTimeOffsets,
                    shuruqTime: state.settings.shuruqTime,
                    shuruqOffset: state.settings.shuruqOffset,
                    jumuahTime: state.settings.jumuahTime,
                    jumuahOffset: state.settings.jumuahOffset,
                    lastUpdated: new Date().toISOString()
                };
                
                localStorage.setItem('alMoazinPrayerTimesData', JSON.stringify(prayerTimesData));
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙÙˆØ±Ø§Ù‹');
            } catch (e) {
                console.error('âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©:', e);
            }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                init();
                checkFileProtocol();
            });
        } else {
            init();
            checkFileProtocol();
        }

        function checkFileProtocol() {
            if (window.location.protocol === 'file:') {
                const warning = document.getElementById('file-protocol-warning');
                if (warning) warning.classList.remove('hidden');
            }
        }
        
        // Register Service Worker for PWA
        let deferredPrompt;
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed', err));
            });
        }

        // Logic for Install Button
        window.addEventListener('beforeinstallprompt', (e) => {
            // Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            e.preventDefault();
            // Ø­ÙØ¸ Ø§Ù„Ø­Ø¯Ø« Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
            deferredPrompt = e;
            // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø²Ø±
            const installBtnContainer = document.getElementById('install-button-container');
            if (installBtnContainer) {
                installBtnContainer.classList.remove('hidden');
            }
        });

        // ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
        document.addEventListener('click', (e) => {
            if (e.target.closest('#install-pwa-btn')) {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                        const installBtnContainer = document.getElementById('install-button-container');
                        if (installBtnContainer) {
                            installBtnContainer.classList.add('hidden');
                        }
                    });
                }
            }
        });

        // Ø¬Ù„Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        fetchTemperature(state.settings.country, state.settings.city).then(temp => {
            state.settings.temperature = temp;
            renderMainScreen();
        });
    </script>
</body>
</html>
