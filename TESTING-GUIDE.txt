🧪 دليل الاختبار والتحقق
═══════════════════════════════════════════════════════════════════════════════

هذا الملف يساعدك على اختبار نظام التخزين الدائم والتأكد من أنه يعمل بشكل صحيح.

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 1: التحقق من التثبيت الصحيح
═══════════════════════════════════════════════════════════════════════════════

الخطوة 1: افتح Developer Tools
──────────────────────────────────────────────────────────────
- اضغط F12 أو Ctrl+Shift+I (أو Cmd+Option+I على Mac)
- انتقل إلى تبويب "Console"

الخطوة 2: اختبر وجود كائن API
──────────────────────────────────────────────────────────────
أدخل في Console:

    console.log(window.persistentStorageAPI)

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
يجب أن ترى كائن يحتوي على:
- saveNewBackground
- loadLastBackground
- saveCustomAdhanSound
- playCustomAdhanSound
- saveAllSettings
- loadAllSettings
- updateSetting
- وغيرها...

إذا رأيت "undefined" ← الملفات لم تُضف بشكل صحيح

الخطوة 3: اختبر قاعدة البيانات
──────────────────────────────────────────────────────────────
أدخل:

    console.log(storage.db)

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
يجب أن ترى: IDBDatabase { ... }

إذا رأيت "undefined" ← قاعدة البيانات لم تُفتح

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 2: حفظ واسترجاع البيانات
═══════════════════════════════════════════════════════════════════════════════

الخطوة 1: حفظ إعدادات بسيطة
──────────────────────────────────────────────────────────────
أدخل في Console:

    await persistentStorageAPI.saveAllSettings({
        testValue: 'Hello World',
        timestamp: new Date().toLocaleString('ar-SA')
    });

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
- يجب أن ترى: "✅ تم حفظ الإعدادات"
- في Console

الخطوة 2: تحميل الإعدادات
──────────────────────────────────────────────────────────────
أدخل:

    const settings = await persistentStorageAPI.loadAllSettings();
    console.log('الإعدادات المحفوظة:', settings);

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
يجب أن ترى الكائن الذي حفظته:
{
    testValue: "Hello World",
    timestamp: "10/12/2025, 3:45:30 ص"
}

الخطوة 3: اختبر البقاء بعد الإغلاق
──────────────────────────────────────────────────────────────
1. أغلق صفحة التطبيق بالكامل
2. افتحها مرة أخرى
3. أدخل نفس الأمر للتحميل
4. يجب أن تُحمل نفس البيانات ✓

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 3: اختبار الحفظ التلقائي
═══════════════════════════════════════════════════════════════════════════════

الخطوة 1: قم بتعيين بيانات معلقة
──────────────────────────────────────────────────────────────
أدخل:

    persistentStorageAPI.autoSave.setPendingData('volume', 0.75);
    persistentStorageAPI.autoSave.setPendingData('theme', 'dark');
    console.log('تم تعيين بيانات معلقة');

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
رسالة تأكيد

الخطوة 2: انتظر الحفظ التلقائي
──────────────────────────────────────────────────────────────
انتظر 30 ثانية ثم تحقق من Console.

يجب أن ترى: "💾 تم الحفظ التلقائي"

الخطوة 3: تحقق من الحفظ
──────────────────────────────────────────────────────────────
أدخل:

    const settings = await persistentStorageAPI.loadAllSettings();
    console.log(settings.volume);
    console.log(settings.theme);

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
0.75
"dark"

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 4: اختبار رفع الملفات
═══════════════════════════════════════════════════════════════════════════════

الخطوة 1: افتح storage-demo.html
──────────────────────────────────────────────────────────────
انتقل إلى: storage-demo.html

الخطوة 2: حمل صورة
──────────────────────────────────────────────────────────────
1. في قسم "إدارة الصور"
2. اضغط على "اختر صورة"
3. اختر صورة من جهازك
4. يجب أن ترى رسالة نجاح ✓

الخطوة 3: حمل صوت
──────────────────────────────────────────────────────────────
1. في قسم "إدارة الأصوات"
2. اضغط على "اختر صوت"
3. اختر ملف صوتي
4. يجب أن ترى رسالة نجاح ✓

الخطوة 4: حمل خلفية
──────────────────────────────────────────────────────────────
1. في قسم "إدارة الخلفيات"
2. اضغط على "اختر خلفية"
3. اختر صورة
4. يجب أن ترى رسالة نجاح ✓

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 5: اختبار قائمة الملفات المحفوظة
═══════════════════════════════════════════════════════════════════════════════

أدخل في Console:

    const files = await persistentStorageAPI.getStoredFilesList();
    console.log('الملفات المحفوظة:', files);

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
{
    images: [{ id: '...', name: '...', size: 12345, ... }],
    sounds: [{ id: '...', name: '...', size: 54321, ... }],
    backgrounds: [{ id: '...', name: '...', size: 98765, ... }],
    total: 3
}

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 6: اختبار الإحصائيات
═══════════════════════════════════════════════════════════════════════════════

أدخل في Console:

    const stats = await persistentStorageAPI.showStorageStats();
    console.log('إحصائيات الحفظ:', stats);

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
{
    images: { count: 5, size: '45.23 MB' },
    sounds: { count: 8, size: '123.45 MB' },
    backgrounds: { count: 3, size: '78.90 MB' },
    total: { count: 16, sizeMB: '247.58' }
}

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 7: اختبار تحديث إعداد واحد
═══════════════════════════════════════════════════════════════════════════════

أدخل في Console:

    await persistentStorageAPI.updateSetting('customValue', 'test123');

ثم تحقق:

    const settings = await persistentStorageAPI.loadAllSettings();
    console.log('قيمة customValue:', settings.customValue);

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
"test123"

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 8: اختبار حفظ صوت مخصص
═══════════════════════════════════════════════════════════════════════════════

1. افتح storage-demo.html
2. حمل صوت في قسم "إدارة الأصوات"
3. انسخ معرّف الصوت من الرسالة
4. في Console أدخل:

    await persistentStorageAPI.playCustomAdhanSound('الفجر');

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
يجب أن يتم البحث عن الصوت المحفوظ وتشغيله

═══════════════════════════════════════════════════════════════════════════════
✅ الاختبار 9: اختبار الدقة بعد الإغلاق
═══════════════════════════════════════════════════════════════════════════════

الخطوة 1: افتح storage-demo.html
──────────────────────────────────────────────────────────────

الخطوة 2: حمل صورة وصوت وخلفية
──────────────────────────────────────────────────────────────
1. حمل صورة
2. حمل صوت
3. حمل خلفية
4. انتظر 30 ثانية للحفظ التلقائي

الخطوة 3: أغلق الصفحة بالكامل
──────────────────────────────────────────────────────────────
- أغلق التبويب أو المتصفح
- حتى تتأكد من إغلاق الاتصال

الخطوة 4: افتح الصفحة مرة أخرى
──────────────────────────────────────────────────────────────

الخطوة 5: اضغط على "📂 تحميل الصور المحفوظة"
──────────────────────────────────────────────────────────────
يجب أن ترى الصور التي حملتها سابقاً ✓

الخطوة 6: اضغط على "📂 تحميل الأصوات المحفوظة"
──────────────────────────────────────────────────────────────
يجب أن ترى الأصوات التي حملتها سابقاً ✓

الخطوة 7: اضغط على "📂 تحميل الخلفيات المحفوظة"
──────────────────────────────────────────────────────────────
يجب أن ترى الخلفيات التي حملتها سابقاً ✓

═══════════════════════════════════════════════════════════════════════════════
⚠️ الاختبار 10: اختبار الأخطاء المحتملة
═══════════════════════════════════════════════════════════════════════════════

الحالة 1: ملف كبير جداً
──────────────────────────────────────────────────────────────
حاول تحميل صورة أكبر من 10MB

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
رسالة خطأ: "حجم الصورة يجب أن يكون أقل من 10MB"

الحالة 2: نوع ملف غير صحيح
──────────────────────────────────────────────────────────────
حاول تحميل ملف .txt كصورة

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
رسالة خطأ: "الملف يجب أن يكون صورة صحيحة"

الحالة 3: حذف ملف أثناء الاستخدام
──────────────────────────────────────────────────────────────
1. حمل صورة
2. اضغط على زر الحذف
3. أعد تحميل الصور

النتيجة المتوقعة:
────────────────────────────────────────────────────────────
الصورة المحذوفة لن تظهر في القائمة

═══════════════════════════════════════════════════════════════════════════════
📊 قائمة الفحوصات
═══════════════════════════════════════════════════════════════════════════════

استخدم هذه القائمة للتحقق من أن كل شيء يعمل:

☑ الملفات الثلاثة مضافة إلى index.html
☑ console.log(window.persistentStorageAPI) يعمل
☑ console.log(storage.db) يعمل
☑ saveAllSettings يحفظ البيانات
☑ loadAllSettings يستعيد البيانات
☑ البيانات تبقى بعد إغلاق وفتح الصفحة
☑ الحفظ التلقائي يعمل كل 30 ثانية
☑ حفظ رفع الملفات يعمل
☑ تحميل قائمة الملفات يعمل
☑ الإحصائيات تظهر بشكل صحيح
☑ حذف الملفات يعمل
☑ معالجة الأخطاء تعمل بشكل صحيح

═══════════════════════════════════════════════════════════════════════════════
🔍 استكشاف المشاكل
═══════════════════════════════════════════════════════════════════════════════

المشكلة: لا ترى أي شيء في Console
────────────────────────────────────────────────────────────────────────────
✓ تحقق: هل أضفت السطور الثلاثة قبل </head>؟
✓ تحقق: هل أعدت تحميل الصفحة (Ctrl+Shift+R)؟
✓ تحقق: هل الملفات موجودة؟

المشكلة: window.persistentStorageAPI غير معرّف
────────────────────────────────────────────────────────────────────────────
✓ تحقق: الملفات مضافة بشكل صحيح؟
✓ تحقق: المسارات صحيحة (src/storage.js إلخ)؟
✓ تحقق: لا توجد أخطاء جاوا سكريبت في Console؟

المشكلة: قاعدة البيانات لا تفتح
────────────────────────────────────────────────────────────────────────────
✓ جرب: مسح السجل والبيانات المؤقتة
✓ جرب: افتح الصفحة في متصفح آخر
✓ جرب: استخدم النسخة الخاصة من المتصفح (في حالة عدم التعارض)

═══════════════════════════════════════════════════════════════════════════════
📚 ملفات الاختبار المفيدة
═══════════════════════════════════════════════════════════════════════════════

الاختبار العملي الكامل:
✓ storage-demo.html

اختبارات Console:
✓ اكتبها يدوياً كما هو موضح أعلاه

═══════════════════════════════════════════════════════════════════════════════
✅ بعد النجاح في جميع الاختبارات
═══════════════════════════════════════════════════════════════════════════════

يمكنك الآن:
✓ دمج النظام مع تطبيقك
✓ استخدام الدوال في الكود الفعلي
✓ الاعتماد على الحفظ التلقائي
✓ عدم القلق من فقدان البيانات

═══════════════════════════════════════════════════════════════════════════════
